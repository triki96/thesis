	
\documentclass[11pt,a4paper,openright,oneside]{report}
\usepackage[swapnames]{frontespizio}
\usepackage[toc,page]{appendix}
\usepackage{epsfig}
\usepackage[paperheight=29.7cm,paperwidth=21cm,outer=3cm,inner=3cm,top=3cm,bottom=3cm]{geometry}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{dutchcal}
\usepackage{fancyhdr}
\usepackage{indentfirst}
\usepackage{graphicx}
\usepackage{newlfont}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mathrsfs}
\usepackage{latexsym}
\usepackage{amsthm}
\usepackage{array}
\usepackage{tikz-cd}
\usepackage{pst-plot}
\usepackage{pst-eucl}
\usepackage{chemarrow}
\oddsidemargin=10pt \evensidemargin=20pt
\hyphenation{}
\usepackage{booktabs}
\usepackage{xcolor}
\usepackage[hidelinks]{hyperref}
\usepackage{scalerel}
\usepackage{pgfplots}
\pgfplotsset{compat=1.12}
\usepackage{subcaption}
\setlength{\parindent}{0em}
\usepackage[thinlines]{easytable}
\usepackage{tikzit}

\theoremstyle{plain}  
\newtheorem{teo}{Theorem}[chapter]
\newtheorem{prop}[teo]{Proposition}    
\newtheorem{cor}[teo]{Corollary}       
\newtheorem{lem}[teo]{Lemma}            
\theoremstyle{definition}              
\newtheorem{defin}[teo]{Definition}
\newtheorem{example}[teo]{Example}               
\newtheorem{oss}[teo]{Remark}         

\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\Mod}[1]{\ (\mathrm{mod}\ #1)}

\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\End}{End} % endomorphism ring
\DeclareMathOperator{\Tr}{Tr} % finite field trace
\DeclareMathOperator{\Gal}{Gal} % Galois group
\DeclareMathOperator{\ord}{ord} % order of an element
\DeclareMathOperator{\lcm}{lcm} % least common multiple
\DeclareMathOperator{\norm}{N} % norm
\DeclareMathOperator{\loglog}{loglog}
\DeclareMathOperator{\im}{Im}
\DeclareMathOperator{\GL}{GL}
\DeclareMathOperator{\SL}{SL}
\DeclareMathOperator{\Cl}{Cl}
\DeclareMathOperator{\Ell}{Ell}

\def\A{\ensuremath{\mathbb{A}}}
\def\P{\ensuremath{\mathbb{P}}}
\def\F{\ensuremath{\mathbb{F}}}
\def\O{\ensuremath{\mathcal{O}}}
\def\tildO{\ensuremath{\tilde{O}}}
\def\euler{\ensuremath{\varphi}}
\def\a{\ensuremath{\mathfrak{a}}}
\def\b{\ensuremath{\mathfrak{b}}}
\def\mat#1{\left(\begin{smallmatrix}#1\end{smallmatrix}\right)}

\newcommand{\leg}[2]{\left(\frac{#1}{#2}\right)}
\newcommand{\bl}[1]{\textcolor{blue}{#1}}
\newcommand{\rd}[1]{\textcolor{red}{#1}}

\usetikzlibrary{arrows,matrix,decorations,decorations.text,decorations.pathmorphing,calc}
\pgfkeys{/triangle/.code=\tikzset{x={(-0.5cm,-0.866cm)},y={(1cm,0cm)}}}
\pgfkeys{/lattice/.code n args={4}{\tikzset{cm={#1,#2,#3,#4,(0,0)}}}}
\input{sample.tikzstyles}

\newcommand{\axes}[4]{
  \clip (#1,#3) rectangle (#2,#4);
  \draw [thin, gray, -latex] (#1,0) -- (#2,0);% Draw x axis
  \draw [thin, gray, -latex] (0,#3) -- (0,#4);% Draw y axis
}

\newcommand{\lattice}[3][2pt]{
  \draw[style=help lines,dashed] (#2-1,#2-1) grid[step=1] (#3+1,#3+1);
  \foreach \x in {#2,...,#3}{
    \foreach \y in {#2,...,#3}{
      \node[draw,circle,inner sep=#1,fill] at (\x,\y) {};
      % Places a dot at those points
    }
  }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{algorithmic}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\algsetup{linenodelimiter=.}

\usepackage{tikz}
\usetikzlibrary{arrows,matrix,decorations,decorations.text,decorations.pathmorphing,calc}
\pgfkeys{/triangle/.code=\tikzset{x={(-0.5cm,-0.866cm)},y={(1cm,0cm)}}}
\pgfkeys{/lattice/.code n args={4}{\tikzset{cm={#1,#2,#3,#4,(0,0)}}}}

\tikzset{
  symbol/.style={
    draw=none,
    every to/.append style={
      edge node={node [sloped, allow upside down, auto=false]{$#1$}}}
  }
}

\newcommand{\function}[5]{%
  \begin{tikzcd}[
    column sep=2em,
    row sep=0ex,
    ampersand replacement=\&
  ]
  #1\colon \&[-3em]
  #2\vphantom{#3} \arrow[r] \&
  #3\vphantom{#2} \\
  \&
  #4\vphantom{#5} \arrow[r,mapsto] \&
  #5\vphantom{#4}
  \end{tikzcd}%
}

\newcommand{\functionZero}[4]{%
  \begin{tikzcd}[
    column sep=2em,
    row sep=0ex,
    ampersand replacement=\&
  ]
  \&[-3em]
  #1\vphantom{#2} \arrow[r] \&
  #2\vphantom{#1} \\
  \&
  #3\vphantom{#4} \arrow[r,mapsto] \&
  #4\vphantom{#3}
  \end{tikzcd}%
}

\newcommand{\functionTwo}[7]{%
  \begin{tikzcd}[
    column sep=2em,
    row sep=0ex,
    ampersand replacement=\&
  ]
  #1\colon \&[-3em]
  #2\vphantom{#3} \arrow[r] \&
  #3\vphantom{#4} \arrow[r] \&
  #4\vphantom{#3} \\
  \&
  #5\vphantom{#6} \arrow[r,mapsto] \&
  #6\vphantom{#7} \arrow[r,mapsto] \&
  #7\vphantom{#6}
  \end{tikzcd}%
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\pagenumbering{gobble}

\tableofcontents

\clearpage\null\newpage

\chapter*{Introduction}

\addcontentsline{toc}{chapter}{Introduction}
In recent years, there has been a substantial amount of research
on quantum computers, machines that exploit quantum mechanical phenomena
to solve mathematical problems that are difficult or intractable for
conventional computers. If large-scale quantum computers are ever
built, they will be able to break many of the public-key cryptosystems
currently in use. This would seriously compromise the confidentiality and
integrity of digital communications on the Internet and elsewhere. The goal
of post-quantum cryptography (also called quantum-resistant cryptography)
is to develop cryptographic systems that are secure against both quantum
and classical computers, and can interoperate with existing
communications protocols and networks.
\\
\\
SPIEGARE PERCHÈ L'INTRODUZIONE È COSÌ LUNGA E COSI POCO INCENTRATA SULL E ISOGENIE

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\clearpage\null\newpage

\chapter{Post-Quantum Cryptography}

\pagenumbering{arabic}

Modern cryptography bases its security on some difficult math problems, such as
factoring large integers, the discrete logarithm in ${\Z_p^*}$ and
the discrete logarithm on the group of elliptic curves.
Up to now, for these problems there is no classical algorithm capable of breaking them in polynomial time.
The situation is different if we extend the analysis not only to algorithms implemented with a classical computer,
but we also include those designed for a quantum computer, which works over a different computational model.
In this chapter we introduce the threat represented by quantum computers,
with particular emphasis on Shor and Grover's algorithms,
and the implications that their implementation would have for modern forms of communication.
We will see how the cryptographic community and the NIST (National Institute of Standards and Technology) are moving
to create quantum resistant schemes, in order to replace those currently in use.
We will focus in particular on the Diffie-Hellman \textcolor{red}{key exchange},
given its importance and centrality within almost all cryptographic protocols,
and we will analyze how a post quantum analogue of this primitive can be found.
In particular we will show how isogeny-based cryptography is the only type of cryptography
up to now that provides a post quantum algorithm analogous to Diffie Hellman.
\textcolor{red}{For additional details, we refer to \cite{Nist}, \cite{Bernstein} and \cite{PrePostQuantum}.}

\section{The Quantum Threat}
\textcolor{red}{
	In 1996 Peter Shor, of Bell Laboratories, designs an algorithm for a quantum computer
	able to solve the integer factorization problem and discrete logarithm in polynomial time \cite{Shor}.
	Starting from Shor's work, in the same laboratories and in the same year, Lov Grover draws
	a quantum algorithm for attacking symmetric ciphers \cite{Grover}.}
In this case the time required is not polynomial in the input dimension
and only gives a quadratic speedup over the classical brute force method.
\\
\\
The impact that the implementation of these algorithms would have on all modern cryptography would be significant:
public key cryptography bases its security on problems that Shor's algorithm is able to solve easily;
the situation is different for private key cryptography:
since Grover provides a quadratic speedup over normal brute force,
the algorithm could force a 128-bit symmetric key
in about $2^{64}$ iterations, or a 256-bit key in about $2^{128}$ iterations. To make these ciphers also resistant to Grover's algorithm, it would therefore be sufficient to double the key length. In any case, it is still clear that a quantum computer would put many forms of modern communication in danger.
We refer to Table \ref{tabella:impact} for a summary of the large-scale impact
a quantum computer would have on common cryptographic algorithms, such as RSA and AES.

\begin{table}[h!]
	\begin{center}
		\begin{tabular}{c c | c}
			\toprule
			$Algorithm$  & $Purpose$                     & $Impact$ $from$ $quantum$ $computer$
			\\
			\midrule
			AES          & Encryption                    & Larger key sized needed              \\
			SHA-2, SHA-3 & Hash Function                 & Larger output needed                 \\
			ECDSA, ECDH  & Signatures, key exchange      & No longer secure                     \\
			RSA          & Signatures, key establishment & No longer secure                     \\
			DSA          & Signatures, key exchange      & No longer secure                     \\
			\bottomrule
		\end{tabular}
	\end{center}
	\caption{Impact of quantum computing on common cryptographic algorithms}
	\label{tabella:impact}
\end{table}

\newpage

To date there are only prototypes of this type of computer, that is machines that are not yet able to do
run the algorithms described above with numbers of cryptographic relevance, however, large companies are investing heavily for
make this happen.
When that happens, quantum computers will then have reached what is now only their potential ability
to solve the aforementioned problems, and will therefore be able to effectively break fragile ciphers.
This concept is called "quantum supremacy", or "quantum advantage",
to emphasize the fact that this technology allows to go beyond the normal limits of classical computers.
In computational-complexity-theoretic terms, this generally means providing a superpolynomial speedup
over the best known or possible classical algorithm.
\\
\\
Given the scale of the problem, it is useful at this point to outline the development of quantum computers over the last decade:
Google had already announced plans to demonstrate quantum supremacy by the end of 2017 by solving the problem
problem with a superconducting 49 qbits-array.
In October 2017, IBM demonstrated the 56 qbits simulation on a conventional supercomputer, increasing the
number of qbits needed for quantum supremacy.
In March 2018 Google announced Bristiecone, a new 72 qbits quantum computer processor, but it is still trying to make it work:
most qbits must be used to do error correction and routine operations of this type.
\\
\\
\textcolor{red}{
	It is not easy to predict how soon a large-scale quantum computer
	will be built, although it is very likely that within the next 20 years
	or so, quantum computers large enough to break all the public key encryption
	schemes currently in use will exist \cite{QuantumComputer}.
	The important fact is that, a priori of the exact year in which quantum
	computers will represent a real risk, we must ensure a secure migration
	to new cryptographic protocols, which guarantee us protection from these threats.
	Migrating to new protocols smoothly and securely is an inherently long process,
	just think that it took almost 20 years to implement our modern public key
	cryptographic infrastructure, so we have to start working in this direction right now.
}
\section{Quantum and Post-Quantum Cryptography}
There are basically two approaches for the creation of quantum resistant cryptosystems: quantum cryptography and post-quantum cryptography.
\textcolor{red}{
	\subsection*{Quantum Cryptography}
	Unlike conventional cryptography, which is based on number theory,
	quantum cryptography uses the laws of quantum physics to
	generate keys and transfer information.	However, this approach
	collides with the numerous physical	limitations of the case,
	as the quantum cryptography will affect	the whole cryptographic
	infrastructure,	which involves software, crypto-processors, hardware
	customization and communications infrastructure. Any changes
	to this infrastructure must be carefully planned and tested
	to ensure compatibility with existing components.
	\\
	\\
	Regarding crypto-processors, which are hardware
	chips carrying several crypto functions such as encryption, signature generation
	and hashing: they are embedded in many devices such as point-of-sale systems,
	automated teller machines and smartphones (SIM cards).
	These cryptosystems rely on the current cryptography standards, depending on the applications,
	for example, for lightweight applications with lower amounts of data
	these crypto-processors mostly rely on small crypto algorithms such as AES.
	Moving to quantum-resistant crypto primitives will affect the performance of these
	crypto-processors, since they involve more computations,
	and they could even render some processors obsolete.
	Therefore companies may be required to buy new hardwares to handle the increased workload.
	\\
	\\
	Regarding communications infrastructure: with quantum cryptography,
	we will need very direct channels, and we will also need to amplify them often:
	quantum key distribution is possible using optical fiber over few tens of kilometers
	but not more due to single photons (during quantum communication,
	information is encoded into photons) getting absorbed by the fiber.
	In addition, quantum cryptography require one technology that will force us
	to rebuild all various underground connections between servers.
	\\
	\\
	In addition, this technology does not have enough algorithms to perform
	the various routines needed in cryptography, for example up to now it
	is not possible to have an authentication scheme.
}

\subsection*{\textcolor{red}{Post Quantum Cryptography}}

Post quantum cryptography, on the other hand, involves the use of classical algorithms, which base their security
on problems that both normal and quantum computers can not break.
Compared to the first approach, the latter has the advantage of providing algorithms that work efficiently
on a classical computer, both in terms of time and memory.
\\
\\
We list below the most important families into which the various post-quantum algorithms are usually divided.
For each of these families we briefly state the mathematical problem on which they base their safety,
and we describe their strengths and weaknesses.

\begin{itemize}
	\item \textbf{Lattice-based cryptography}:
	      \textcolor{red}{
	      Lattice-based cryptosystems base their security on the well known \emph{shortest vector problem} (SVP), for which, given a lattice $\mathcal{L} \subseteq \Z^n$ we are asked to find the shortest non-zero vector $v$, i.e. such that
	      $${\displaystyle \| v \| = \min _{w\in \mathcal{L} \smallsetminus \{\mathbf {0} \}}\| w \|}$$
	      We briefly present the best known lattice-based algorithm,
	      the NTRUEncrypt public key cryptosystem, also known as the NTRU encryption algorithm.
	      Each NTRU's instance is specified by three integer parameters $(N, p, q)$
	      which represent the maximal degree $N-1$ for all polynomials in the truncated ring $R:={\mathbb{Z}}[X]/(X^{N}-1)$,
	      a small modulus and a large modulus, respectively, where it is assumed that
	      $N$ is prime, $q$ is always larger than $p$, and $p$ and $q$ are coprime;
	      and four sets of polynomials $\mathcal{L}_f, \mathcal{L}_g, \mathcal{L}_m$ and $\mathcal{L}_{\varphi}$
	      (a polynomial part of the private key, a polynomial for generation of the public key,
	      the message and a blinding value, respectively), all of degree at most $N-1$ .
	      Along with these parameters we add some additional constraints
	      that allow this cipher to work correctly. We refer to \cite{NTRU} for further details.
	      \\
	      \\
	      %GENERAZIONE CHIAVI
	      We start with the key generation.
	      The private key is a pair $(f,g)$ defined in the following way:
	      first we choose $f \in \mathcal{L}_f$ such that is is invertible modulo $p$ and $q$, i.e. over the rings
	      $$R_p:={\mathbb{Z}_p}[X]/(X^{N}-1) \;\; \; \; \;\;  R_q:={\mathbb{Z}_q}[X]/(X^{N}-1)$$
	      We denote with $f_p$, $f_q$ its inverses, respectively.
	      We also choose an element $g \in \mathcal{L}_g$.
	      The public key is $h$, obtained as $h := f_q \cdot g \pmod q$.
	      %CIFRATURA
	      The encryption of a message $m \in \mathcal{L}_m$ is done as follows:
	      chosen a random element $\varphi \in \mathcal{L}_{\varphi}$,
	      the encrypted message $c$ is computed as $c := p \varphi \cdot h + m \pmod q$.
	      %DECIFRATURA
	      For the decryption it is computed $a \equiv f \cdot c \pmod q$, choosing the representatives of $\Z_q$ in $(-q/2, q/2)$,
	      after which the original message $m$ is recovered as $m = f_p \cdot a \pmod p$, indeed
	      \begin{align*}
		      f_p \cdot a \pmod q & =  f_p \cdot (f \cdot c) \pmod q                 \\
		                          & = f_p \cdot ( f \cdot (p \varphi h + m)) \pmod q
	      \end{align*}
	      Since the coefficients of $a$ are chosen in the interval $[-q/2, q/2]$ the original message can be properly recovered:
	      the coefficients of the message $m$ has been chosen in the interval $[-p/2, p/2]$, and so all coefficients of $( f \cdot (p \varphi h + m))$ already lie within the interval $[-q/2, q/2]$ because the polynomials $h, f, f_p, m$ and prime $p$
	      all have coefficients that are small compared to $q$.
	      This means that all coefficients are left unchanged during reducing modulo $q$ and that
	      \begin{align*}
		      f_p \cdot a \pmod p & = f_p \cdot ( f \cdot (p \varphi h + m)) \pmod p \\
		                          & = f_p \cdot f \cdot m \pmod p                    \\
		                          & = m \pmod p
	      \end{align*}
	      In this cryptosystem, searching for the private key $f$ is equivalent to solve the SVP in the lattice defined by the matrix
	      $$
		      \begin{pmatrix}
			      \alpha & 0      & \cdots & 0      & h_0     & h_1    & \cdots & h_{N-1} \\
			      0      & \alpha & \cdots & 0      & h_{N-1} & h_0    & \cdots & h_{N-2} \\
			      \vdots & \vdots & \ddots & \vdots & \vdots  & \vdots & \ddots & \vdots  \\
			      0      & 0      & \cdots & \alpha & h_1     & h_2    & \cdots & h_0     \\
			      0      & 0      & \cdots & 0      & q       & 0      & \cdots & 0       \\
			      0      & 0      & \cdots & 0      & 0       & q      & \cdots & 0       \\
			      \vdots & \vdots & \ddots & \vdots & \vdots  & \vdots & \ddots & \vdots  \\
			      0      & 0      & \cdots & 0      & 0       & 0      & \cdots & q       \\
		      \end{pmatrix}
	      $$
	      }
	      \textcolor{red}{ where $h_0,h_1,...,h_{N-1}$ are the coefficients of $h$ and $\alpha$ is a suitable parameter.
	      \\
	      \\
	      NTRU, and more generally most lattice-based key creation algorithms, are
	      relatively simple, efficient, and highly parallelizable,
	      they also offer security proofs that are not possible in other algorithm families.
	      However, usually, in the implementation of these ciphers, more particularly in the parameters' choice,
	      these proofs are not taken into account, because if they were considered the parameters would become too large.
	      The problems of this family lie in the fact that the complexity of the attacks
	      is not yet well understood by the cryptographic community, and that attacks on these ciphers often experience dramatic improvements.
	      }
	\item \textbf{Code-based cryptography}:
	      This family provides cryptosystems in which the cryptographic primitive uses an error correcting code $\mathcal{C}$.
	      Code-based cryptosystems base their security on the difficulty of inverting a map such as
	      $$
		      \functionZero{\lbrace \text{Message Space} \rbrace}{\lbrace \text{Key Space} \rbrace}{m}{mG+e}
	      $$
	      where $G$ is \textcolor{red}{a generator matrix of a code where correction of errors is very slow}, and with $e$ an error vector.
	      \textcolor{red}{
		      The protocol requires $G$ to be of the form $S \cdot \hat{G} \cdot P$, for some invertible matrices $S,P$ and a secret matrix $\hat{G}$.
		      The decoding of a word $c+e$ can be done efficiently only knowing these three matrices.}
	      Since the structure of $G$ determines the type of code that is used by the scheme, by changing the structure of the private matrix we can use new codes,
	      which allow different trade-off in the size of the keys and in the efficiency of the scheme.
	      For example, the well-known MCEliece cryptographic scheme is based on Goppa's codes,
	      \textcolor{red}{so that
		      the private key is a random binary irreducible Goppa code and the public key is a random generator matrix
		      of a randomly permuted version of that code.}
	      First proposed in 1978, McEliece is a very efficient and safe scheme,
	      just think that it has received more than 40 years of studies by cryptologists,
	      without anyone ever being able to violate it.
	      Although fast, this scheme suffers from very large key sizes,
	      precisely due to the type of codes on which it is based.
	      To overcome the problem of large keys,
	      the more recent variants of this scheme have introduced a more articulated structure within the codes,
	      however, this added structure usually lead
	      to critical attacks on these ciphers, suggesting that McEliece is still the best choice.

	\item \textbf{Multivariate polynomial cryptography}:
	      These schemes are based on the difficulty of solving a system of multivariate polynomials
	      defined on a finite field and with degree greater than $1$.
	      Several multivariate cryptosystems have been proposed over the past few decades,
	      with many having been broken.
	      While there have been some proposals for multivariate encryption schemes,
	      multivariate cryptography has historically been more successful as an approach to signatures,
	      primarily because multivariate schemes provide the shortest signature among post-quantum algorithms.

	\item \textbf{Hash-based cryptography}:
	      \textcolor{red}{
		      Hash-based cryptography is an alternative post quantum cryptographic scheme
		      that is primarily focused on digital signatures which verify that the document or
		      message originated from the initial sender of the document.
		      There are currently no hash-based cryptographic schemes for encrypting and decrypting messages
		      using asymmetric public key exchange (PKE), so additional cryptographic methods
		      would be necessary for the remaining cryptographic services.
		      \\
		      \\
		      In this family, each cryptographic primitive bases its strength on the security of a given hash function.
		      The concept of security for a hash function is equivalent to make some assumptions about the properties that this map possesses.
		      In particular, for each secure hash function it is possible to create a new schema that uses it.
		      As a result, each suitable map produces a different corresponding hash-based signature scheme.
		      Even if a certain hash function becomes insecure, simply replace it with a different and safe one
		      to obtain a secure instance of the hash-based signature scheme under consideration.
		      Minimality of security assumptions is another feature of these signature schemes:
		      generally, they only require a secure cryptographic hash function to ensure the overall security of the scheme.
	      }
	\item \textbf{Isogeny-based cryptography}:
	      The last family contains algorithm\textcolor{red}{s} which get nourishment
	      from the deeper theory of elliptic curves.
	      The key idea in moving from conventional elliptic-curve cryptography to
	      isogeny-based cryptography is that points on curves are replaced with entire
	      curves, and relationships between points (scalars and discrete logarithms) are
	      replaced \textcolor{red}{by} relationships between curves (isogenies).
	      Curves that fullfill this relation are said to belong to the same isogeny class.
	      Isogeny classes have just enough algebraic structure to define efficient
	      asymmetric cryptosystems, but not enough to make them vulnerable to Shor’s algorithm.
	      \\
	      \\
	      The underlying problem of this family of algorithms is the so called isogeny
	      path problem, which can be stated as follows:
	      given two elliptic curves $E$,$E'$ defined over a finite field $\F_q$, and
	      such that $\#E = \#E'$, find an isogeny $\varphi$ of smooth degree that maps $E$ to $E'$.
	      This schemes use the well studied mathematics of supersingular elliptic curves
	      to create a Diffie-Hellman like key exchange that can serve as a straightforward
	      quantum computing resistant replacement for the DH and ECDH key exchange methods.
	      \textcolor{red}{
		      There are three main isogeny-based algorithms:
		      the CRS (Couveignes, Rostovtsev–Stolbunov),
		      SIDH (Supersingular Isogeny Key Exchange),
		      and CSIDH (Commutative Supersingular Isogeny Key Exchange).}
	      One of the advantages of this primitive family is to have very small keys compared to the others;
	      on the other hand, the computational cost required to run each scheme is very high,
	      and since this is a research field entirely new in cryptography,
	      there has not been enough analysis yet for the community to have too much confidence in his safety.

\end{itemize}

\section{Post-Quantum Cryptography Standardization}
To ensure information security against quantum attacks,
we will have to migrate to some of these new cryptographic schemes.
\\
\\
Previous transitions from weaker to stronger ciphers were based on the so called security bit paradigm,
which measures the security of an algorithm based on the time complexity of a
attack done by a classical computer,
for example an algorithm is said to have 128 bits of security if the
difficulty of attacking it with a classical computer is comparable to the time and resources
required to brute-force search for a 128-bit cryptographic key.
In January 2016, NIST classified the standardized algorithms into groups with 80, 112, 128, 192 and 256 bits of security \textcolor{red}{\cite{NistSP}}, and defined the guidelines for the transition to more secure ciphers as follows:
the family of ciphers with 80 bits of security is not considered secure enough,
furthermore, 112-bit security ciphers must be phased out gradually by 2031.
Unfortunately this type of paradigm does not take into account the security of algorithms against quantum cryptanalysis,
therefore it is an inadequate tool to guide the transition to quantum-resistant cryptography.
\\
\\
With these premises,
NIST in December 2016 began a process of standardization of post-quantum algorithms
announcing a call for proposals to universities and companies.
Since most symmetric primitives are relatively easy to modify in a way that makes them quantum resistant,
efforts have focused on public-key cryptography, namely digital signatures and key encapsulation mechanisms.
The competition is now in its third round out of expected four, where in each round some algorithms are discarded
and others are studied more carefully. NIST hopes to publish the standardization documents by 2024,
but may speed up the process if major breakthroughs in quantum computing are made.
Below is the list of proposals submitted to NIST in the first round, grouped by type.
The counting does not take into account candidates who have withdrawn,
and if more candidates have been merged into a single scheme, only the latter has been taken into account.
\\
\begin{table}[h!]
	\begin{center}
		\begin{tabular}{c | c c c}
			\toprule
			$Family$     & $Signature$ & $PKE/KEM$ & $Sum$
			\\
			\midrule
			Lattice      & 5           & 23        & 28    \\
			Codes        & 3           & 17        & 20    \\
			Multivariate & 7           & 3         & 10    \\
			Hash         & 2           & 0         & 2     \\
			Isogenies    & 0           & 1         & 1     \\
			Others       & 3           & 5         & 8     \\
			\bottomrule
		\end{tabular}
	\end{center}
	\caption{NIST candidates}
	\label{tabella:nistCandidates}
\end{table}

\textcolor{red}{
	We informally remember the difference between \emph{key encapsulation mechanism}
	(KEM) and \emph{public key encryption} (PKE). These notions define classes of
	encryption techniques, and are tightly related:	PKE’s encryption procedure,
	on input plaintext $m$ and receiver $R$’s public-key $pk_R$, outputs ciphertext $c$,
	while KEM’s encryption procedure, on input receiver $R$’s public-key $pk_R$,
	outputs ciphertext $c$ and key $k$,	where $c$ is sent to $R$, and $k$ is kept
	secret inside the sender, and employed in the subsequent process of data encryption.
	PKE’s decryption procedure, on input $c$ and secret-key $sk_R$, outputs plaintext $m$,
	while KEM’s decryption procedure, on input $c$ and secret-key $sk_R$, outputs key $k$
	\cite{PKEKEM}. It is possible to show that these algorithms can be turned one into
	the other, and for this reason in the table above they are grouped in a single column.
}
\\
\\
\textcolor{red}{
	One of the most important challenges for the NIST competition, and more generally for the post quantum world,
	is to find a suitable candidate to replace the Diffie-Hellman protocol, which is,
	both literally and figuratively, at the foundation of public-key cryptography.
	Nowadays this primitive is often an elementary component of some other more complicated protocol,
	for example, the TLS protocol, used to establish secure Internet connections,
	includes a temporary Diffie-Hellman protocol, or the X3DH protocol,
	used to establish connections in Signal and WhatsApp,
	includes four simple Diffie-Hellman between various short and long term key pairs.
	The common use of classical Diffie-Hellman therefore makes the search for a post-quantum substitute particularly relevant today.
	Ideally we do not want to limit ourselves to any substitute, which only achieves the same result, i.e. the exchange of a common key.
	We would like to have a \emph{drop-in} replacement instead,
	that is a protocol so suitable to replace the old one that a outside observer does not notice the difference.
	\\
	\\
	Although many promising post-quantum candidates have been developed
	for public key cryptography and signatures (see Table \ref{tabella:nistCandidates})
	finding a simple replacement for Diffie-Hellman, as opposed to a KEM, has proven to be surprisingly complicated.
	The only post-quantum protocol truly similar to Diffie-Hellman is CSIDH, from isogeny-based cryptography.
	Unfortunately, this scheme was not developed until later, when the NIST
	process was already underway, and therefore it could not take part in the competition.
	We will now provide the theoretical background to fully understand this scheme.
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Elliptic Curves}
We set out below the most relevant results regarding elliptic curves.
We start by stating some elementary results, after which we analyze
the principal type of maps between curves, dwelling on those that preserve
both their group and abelian variety structure. We will call these maps
\emph{isogenies}. With this new knowledge we will be able to understand
further results regarding elliptic curves, which we will state in the final section.

\section{Elementary Results}
We will initially provide the definition of an elliptic curve in
its general form. For our purposes this definition will turn out
not to be very practical, so we will replace it with a more usable one.
However, we will show that, limited to the cases of our interest,
these two definitions coincide. We will then define a group structure
over the set of points of a generic curve, and try to characterize
the elements of this group. For a more detailed description,
we refer to \cite{Galbraith}, \cite{Washington},
\cite{Silverman} and \cite{DeFeo1}.

\begin{defin}[Projective space]
	Given a field $\mathbb{K}$ and its algebraic closure
	$\bar{\mathbb{K}}$, the \emph{projective space of dimension $n$},
	denoted by $\P^n$ or $\P^n(\bar{\mathbb{K}})$, is the set of all $(n+1)$-tuples
	\[(x_0,\dots,x_n)  \in  \bar{\mathbb{K}}^{n+1}\] %
	such that $(x_0,\dots,x_n)  \neq  (0,\dots,0)$, taken modulo the
	equivalence relation
	\[(x_0,\dots,x_n) \sim (y_0,\dots,y_n)\] %
	if and only if there exists $ \lambda \in\bar{\mathbb{K}}$ such that
	$x_i= \lambda y_i$ for all $i$.
\end{defin}

The equivalence class of a projective point $(x_0,\dots,x_n)$ will
be denoted by $(X_0 : \cdots : X_n)$. The set of the \emph{$\mathbb{K}$-rational points},
denoted by $\P^n(\mathbb{K})$, is defined as
\[\P^n(\mathbb{K}) = \left\{(X_0 : \cdots : X_n) \in \P^n\;\middle|\; x_i  \in  \mathbb{K} \text{ for all $i$}\right\}.\]
By fixing arbitrarily the coordinate $x_n=0$, we define a projective
space of dimension $n-1$, which we call the \emph{hyperplane at infinity};
its points are called \emph{points at infinity}.

Formally, elliptic curves are projective curves of genus 1 with a distinguished point.
From now on we suppose that the field $\mathbb{K}$ has characteristic different
from $2$ and $3$. This has the merit of greatly simplifying the representation of an
elliptic curve.

\begin{defin}[Weierstrass equation]
	An \emph{elliptic curve} defined over $\mathbb{K}$ is the locus in
	$\P^2(\bar{\mathbb{K}})$ of an equation
	\begin{equation}
		\label{eq:weierstrass}
		Y^2Z = X^3 + AXZ^2 + BZ^3
	\end{equation}
	with $A,B \in \mathbb{K}$ and $4A^3+27B^2\ne0$.
	The point $O := (0:1:0)$ is the only point on the line $Z=0$; it is
	called the \emph{point at infinity} of the curve.
\end{defin}

In some ambiguous cases, to avoid confusion, we will also add to the point
at infinity the curve to which this element refers. For example, for two
elliptic curves $ E_1, E_2 $ the their points at infinity will be denoted
respectively as $ O_{E_1}, O_{E_2} $.
\\
\\
It is customary to write Eq. \eqref{eq:weierstrass} in \emph{affine form}. %
By defining the coordinates $x=X/Z$ and $y=Y/Z$, we equivalently
define the elliptic curve as the locus of the equation
\[y^2 = x^3 + Ax +B\]
plus the point at infinity $O$.
In characteristic different from $2$ and $3$, we can show that any
projective curve of genus $1$ with a distinguished point $O$ is
isomorphic to a Weierstrass equation by sending $O$ onto the point at infinity $(0:1:0)$.
\\
\\
If we want to consider points with coordinates in some extension field $\mathbb{K}' \supseteq \mathbb{K}$ we write $E(\mathbb{K}')$, referring to the following definition
$$E(\mathbb{K}') := \lbrace (x,y) \in \mathbb{K}' \times \mathbb{K}'  \; \vert \; y^2 = x^3+Ax+B \rbrace \cup \lbrace O \rbrace . $$
In order to count the number of points on a field $\mathbb{K}'$ that satisfy the relation defined by the elliptic curve, we clearly just have to compute the cardinality of $E(\mathbb{K}')$. For example, we can consider the elliptic curve $E / \mathbb{F}_{11}$ defined by the equation $y^2 = x^3-8x-1 $.  In this case $E(\mathbb{F}_{11})$ consists of the neutral element $O$ and all the points emphasized \textcolor{red}{in Figure \ref{Fig.Campofinito}.}
\\
\begin{figure}[!h]
	\centering
	\begin{tikzpicture}[scale = 0.5]
		\tikzset{help lines/.style={color=black!50}}
		\draw[thick,step=1cm,help lines, dashed] (0,0) grid (10,10);
		\draw[thick,step=1cm,help lines] (0,0) to (0,10);
		\draw[thick,step=1cm,help lines] (0,0) to (10,0);
		\draw[thick,step=1cm,help lines] (10,10) to (0,10);
		\draw[thick,step=1cm,help lines] (10,10) to (10,0);
		\foreach \x in {0,1,...,10} { \node [anchor=north] at (\x,-0.3) {\x}; }
		\foreach \y in {0,1,...,10} { \node [anchor=east] at (-0.3,\y) {\y}; }
		\draw[fill] (1,5) circle (4pt);
		\draw[fill] (1,6) circle (4pt);
		\draw[fill] (4,3) circle (4pt);
		\draw[fill] (4,8) circle (4pt);
		\draw[fill] (7,0) circle (4pt);
	\end{tikzpicture}
	\caption{$E(\mathbb{F}_{11}) \setminus \lbrace O \rbrace$, with $E / \mathbb{F}_{11} := \Big( y^2 = x^3-8x-1 \Big) $.}
	\label{Fig.Campofinito}
\end{figure}

It is possible to informally define a binary operation
on the points of an elliptic curve through the well-known
chord-tangent law, which we briefly recall for completeness.

\begin{defin}
	The chord-tangent composition of two points $P$ and $Q$ on an elliptic
	curve $E$ is denoted by $P+Q$ and is defined as the opposite of the
	third point of intersection of the line through $P$ and $Q$ with $E$.
	If $P$ and $Q$ are the same point, the line through them is given by
	the tangent to the curve at $P$.
\end{defin}

The point $P+Q$ determined by this definition is easily shown to exist and may
be determined through algebraic manipulations of the elliptic curve equation.
Its coordinates can be expressed in terms of the coordinates of $P$ and $Q$ and
the coefficients of $E$. It is useful to take note of a geometric special case.
When one of the points involved is $O$, which can not be represented graphically,
we just draw a vertical line through the other point, and check for intersection with $E$.
Consider in this regard the curve $ y^2 = x^3-8x-1 $ defined over $\R$.
The sum operation described above can be given geometrically as illustrated
in Figure \ref{Fig.Campoinfinito}.

\begin{figure} [!h]
	\centering
	\begin{tikzpicture}[scale = 0.8]
		\begin{axis}[
				xmin=-4,
				xmax=7,
				ymin=-5,
				ymax=5,
				xlabel={$x$},
				ylabel={$y$},
				scale only axis,
				axis lines=middle,
				domain=1:3.8,
				samples=200,
				smooth,
				clip=false,
				axis equal image=true,
			]
			\addplot [black, domain = 2.889:4] {sqrt(x^3-8*x-1)};
			\addplot [black, domain = 2.889:4] {-sqrt(x^3-8*x-1)};
			\addplot [black, domain = -2.7637:-0.125245] {sqrt(x^3-8*x-1)};
			\addplot [black, domain = -2.7637:-0.125245] {-sqrt(x^3-8*x-1)};
			\addplot [black, domain = -2.55:3.5] {(x/3 + 2.55)};
			\addplot[samples=50,domain=0:6] coordinates {(3.5,-3.7)(3.5,3.7)};
			\node[label={0:{$P+Q$}},circle,fill,inner sep=2pt] at (axis cs:3.5,-3.7) {};
			\node[label={90:{$P$}},circle,fill,inner sep=2pt] at (axis cs:-0.85,-2.55/3 + 3.1) {};
			\node[circle,fill, inner sep=2pt] at (axis cs:3.5,3.7) {};
			\node[label={180:{$Q$}},circle,fill,inner sep=2pt] at (axis cs:-2.55,-2.55/3 + 2.55) {};
		\end{axis}
	\end{tikzpicture}
	\caption{$E(\mathbb{R}) \setminus \lbrace O \rbrace$, with $E / \mathbb{R} := \Big( y^2 = x^3-8x-1 \Big) $. }
	\label{Fig.Campoinfinito}
\end{figure}

The transposition of this operation to curves defined over finite fields
remains the same at the level of definition, but the geometric intuition is faded.
In this regard, compare Figure \ref{Fig.Campofinito} and Figure \ref{Fig.Campoinfinito},
where the same curve, defined on different fields, takes a radically different appearance.
Figure \ref{Fig.CampofinitoSum} shows the chord-tangent construction in the finite field case.

	\begin{figure}[!h]
		\centering
		\begin{tikzpicture}[scale = 0.5]
			\tikzset{help lines/.style={color=black!50}}
			\draw[thick,step=1cm,help lines, dashed] (0,0) grid (10,10);
			\draw[thick,step=1cm,help lines] (0,0) to (0,10);
			\draw[thick,step=1cm,help lines] (0,0) to (10,0);
			\draw[thick,step=1cm,help lines] (10,10) to (0,10);
			\draw[thick,step=1cm,help lines] (10,10) to (10,0);
			\draw[thick,step=1cm,help lines] (0,4) to (6,10);
			\draw[thick,step=1cm,help lines] (7,0) to (10,3);
			\foreach \x in {0,1,...,10} { \node [anchor=north] at (\x,-0.3) {\x}; }
			\foreach \y in {0,1,...,10} { \node [anchor=east] at (-0.3,\y) {\y}; }
			\draw[fill] (1,5) circle (4pt);
			\draw[fill] (1,6) circle (4pt);
			\draw[fill] (4,3) circle (4pt);
			\draw[fill] (4,8) circle (4pt);
			\draw[fill] (7,0) circle (4pt);
		\end{tikzpicture}
		\caption{$E(\mathbb{F}_{11}) \setminus \lbrace O \rbrace$, with $E / \mathbb{F}_{11} := \Big( y^2 = x^3-8x-1 \Big) $.}
		\label{Fig.CampofinitoSum}
	\end{figure}

In the example just shown, we see how the sum of $ P: = (1,5) $ and $ Q: = (4,8) $ gives $(0,7)$ as a result.
This operation, defined in a purely intuitive and geometric way, finds in its algebraic formalization
the justification of all the properties it possesses, as shown hereafter.
\\
\\
Let $E/\mathbb{F}_q$ be an elliptic curve defined by $y^2 = x^3 + Ax + B$.
Let $P_1 = (x_1 , y_1 )$ and $P_2 = (x_2 , y_2 )$ be points on $E$ with
$P_1 , P_2 \neq O$. Define $P_1 + P_2 = P_3 = (x_3 , y_3 )$ as follows:
\begin{itemize}
	\item If $x_1 \neq x_2$ ,then
	      $$
		      (x_3,y_3) =  \Bigg( \bigg( \frac{y_2 - y_1}{x_2 - x_1} \bigg)^2 - x_1 - x_2 ,
		      \bigg( \frac{y_2 - y_1}{x_2 - x_1} \bigg) (x_1 - x_3 ) - y_1 \Bigg).
	      $$
	\item If $x_1 = x_2$ but $y_1 \neq y_2$ ,then $P_1 + P_2 = O$.
	\item If $P_1 = P_2$ and $y_1 \neq 0$, then
	      $$
		      (x_3,y_3) = \Bigg( \bigg( \frac{3x_1^2 + A}{2y_1} \bigg)^2 - 2x_1, \bigg( \frac{3x_1^2 + A}{2y_1} \bigg) (x_1 - x_3 ) - y_1 \Bigg).
	      $$
	\item If $P_1 = P_2$ and $y_1 = 0$, then $P_1 + P_2 = O$.
\end{itemize}
Moreover, define $$ P + O = O + P = P $$ for all points $P$ on $E$.
\\
\\
It is possible to prove that $ (E(\mathbb{K}), +, O) $ forms a group with respect to the sum previously defined, with $O$ as a neutral element.
\begin{oss}
	It is a known fact in literature that it is possible to define a group law not only on elliptic curves,
	but also on any irreducible cubic or on a conic.
	The way in which two points are added is slightly different from what happens with elliptic curves.
	We start by defining the sum of two points on a conic defined on an infinite field,
	more precisely the field  $\R$ of real numbers, however, the result we will obtain will also be valid for any other field.
	Let $ \Gamma $ be a non-degenerate conic. Since, unlike what happens with elliptic curves,
	we do not have an immediate candidate which plays the role of neutral element with respect to the sum,
	we fix a generic point $ N \in \Gamma $, which will fit the role.
	We then define the sum operator $ +: \Gamma \times \Gamma \to \Gamma $ in the following manner:
	given $ P, Q \in \Gamma $, we consider the line passing through these points,
	we then trace a straight line through $ N $, parallel to the one obtained above.
	This last line must intersect $ \Gamma $ at another point, called $ R $.
	We define $ R $ as the result of the operation.
	Figure \ref{Fig.Ellipse} illustrates the operation.
	\begin{figure} [!h]
		\centering
		\begin{tikzpicture}[scale = 0.8]
			\begin{axis}[
					xmin=-5,
					xmax=5,
					ymin=-2.7,
					ymax=2.7,
					xlabel={$x$},
					ylabel={$y$},
					scale only axis,
					axis lines=middle,
					domain=1:3.8,
					samples=200,
					smooth,
					clip=false,
					axis equal image=true,
				]
				\draw (0,0) ellipse (2.5cm and 1.3cm);
				\addplot [black, domain = -3:-1] {(x*(1.5/3)*1.5 + 2.2)};
				\node[label={120:{$P$}},circle,fill,inner sep=2pt] at (axis cs: -2.95,0) {};
				\node[label={90:{$Q$}},circle,fill,inner sep=2pt] at (axis cs: -1,1.45) {};
				\addplot [black, domain = -1.45:2] {(x*(1.5/3)*1.5 + 2.2 - 2.5)};
				\node[label={90:{$O$}},circle,fill,inner sep=2pt] at (axis cs: 1.95,1.15) {};
				\node[label={210:{$P+Q$}},circle,fill,inner sep=2pt] at (axis cs: -1.4,-1.35) {};
			\end{axis}
		\end{tikzpicture}
		\caption{$\Gamma(\mathbb{R})$, with $\Gamma / \mathbb{R} :=
					\Big( \big( \frac{2}{5} \big)^2 x^2 + \big( \frac{10}{13} \big)^2 y^2 = 1 \Big) $. }
		\label{Fig.Ellipse}
	\end{figure}
	\\
	As with elliptic curves, if $ P = Q $, then the line for these two points is the tangent to $ \Gamma $ in $ P $,
	and therefore to compute the sum $ P + P $, it is sufficient to draw the line passing through $ N $ and parallel to
	the tangent to $ \Gamma $ in $ P $; the second point of intersection with $ \Gamma $ will therefore be $ P + P $.
	Similarly, if the line for $ N $, parallel to that for $ P $ and $ Q $, is tangent to $ \Gamma $ in $ N $, we take as sum $ P + Q = N $.
	We also have $N + N = N$ and $P + N = P$ for all $P \in \Gamma$.
	We refer to \cite{conicOne} for further details.
	\\
	\\
	If the definition field of our conic is a finite field, the group associated with it is cyclic.
	This fact allows us to use this structure in cryptographic applications.
	The cases of application are typically limited to those protocols involving cyclic groups, more specifically
	those for which it is necessary to compute the product $ n \cdot P $ of an element $P$ of the group.
	Using conics we do not avoid this computation, however the computational cost may be significantly smaller,
	while maintaining the same resistance against external attacks.
	Unlike elliptic curves, the product $ n \cdot P $ is defined in the same way for all points of the curve,
	and the result of this operation is still a proper point of the latter.
	A sketch of an RSA-like cryptosystem on general conics is given in \cite{conicTwo}.
\end{oss}

The fact that points on an elliptic curve form an abelian group is
behind most of the interesting properties and applications. 
We will make extensive use of the group structure defined above.

\begin{defin}[$n$-torsion subgroup]
	Let $E$ be an elliptic curve over a field $\mathbb{K}$ and let $P \in E(\mathbb{K})$. For $n \in \N^{+}$ define $[n]P$ to be $P + \cdots + P$ where $P$ appears $n$ times. Define $[0]P := O$ and $[-n]P:=[n](-P)$. The \emph{$n$-torsion subgroup} is
	$$
		E[n] := \lbrace P \in E(\overline{\mathbb{K}}) : [n]P = O \rbrace
	$$
\end{defin}

\begin{example}
Let us consider again the elliptic curve defined in Figure \ref{Fig.Campofinito}. In Table \ref{tab:orderTable} we summarize the order of each point.

	\begin{table}[!h]
		\begin{center}
			\centering
			\def\arraystretch{1.3}
			\begin{tabular}{c | c}
				Point   & Order \\
				\midrule
				$O$     & $1$   \\
				$(1,5)$ & $3$   \\
				$(1,6)$ & $3$   \\
				$(4,3)$ & $6$   \\
				$(4,8)$ & $6$   \\
				$(7,0)$ & $2$   \\
			\end{tabular}
			\caption{Points (and respectively orders) of $E / \mathbb{F}_{11} := \Big( y^2 = x^3-8x-1 \Big) $.}
			\label{tab:orderTable}
		\end{center}
	\end{table}
	\vspace{-10px}
	It follows that the interesting torsion grubroups are given by
		\begin{align*}
			E[1] & =\{ O \}                                       \\
			E[2] & =\{ O, (7,0) \}                                \\
			E[3] & =\{ O,(1,5),(1,6) \}                           \\
			E[6] & =\{ O, (7,0),(1,5),(1,6),(4,3),(4,8) \}        \\
			E[0] & =E(11) =\{ O, (7,0),(1,5),(1,6),(4,3),(4,8) \}
		\end{align*}
		Clearly $E[n]= \varnothing$ for each $n \in \N \setminus \{ 0,1,2,3,6 \}$.
		More generally, for every elliptic curve $E$ we have that
		$E[0]= E $ and $E[1]=\{ O \}$.
\end{example}

\begin{prop}
	Let $E$ be an elliptic curve defined over an algebraically closed
	field $\mathbb{K}$ of characteristic $p$, and let $m \neq 0$ be an integer.
	The $m$-torsion group of $E$, denoted by $E[m]$, has the following
	structure:
	\begin{itemize}
		\item if $p$ does not divide $m$, then $E[m]  \cong  \Z_m \times \Z_m$.
		\item If $p$ divides $m$, then
		      \[E[p^n]  \cong
			      \begin{cases}
				      \Z_{p^n} & \text{for any $n \geq 0$, or} \\
				      \{O\}    & \text{for any $n \geq 0$.}
			      \end{cases}
		      \]
	\end{itemize}
\end{prop}
\begin{proof}
	See \cite[Cor.~6.4]{Silverman}.
\end{proof}

For curves defined over a field of positive characteristic $p$, the
case $E[p] \cong  \Z /p \Z $ is called \emph{ordinary}, while the case
$E[p] \cong \{O\}$ is called \emph{supersingular}. %
We shall see later some alternative characterizations of supersingular curves.

\section{Maps Between Elliptic Curves}
Finally, we focus on different type of maps between elliptic curves. %
As we said, we are mostly interested in isogenies.
We will give particular emphasis to isogenies defined from a 
curve to itself. These maps will be called endomorphisms.
We will study how this set of functions can be equipped with a ring 
structure, and we will characterize the structure of this ring.

\subsection{Morphisms}
\begin{defin}[Function field]
	Let $\mathbb{K}$ be a field and $C / \mathbb{K}$ a projective curve 
	defined by $f(x,y,z) = 0$, where $f \in \mathbb{K}[x,y,z]$ is 
	irreducible\footnote{It can not be factored into the product of two 
	non-constant polynomials with coefficients in $\overline{\mathbb{K}}$. } 
	in $\overline{\mathbb{K}}[x,y,z]$.  The \emph{function field}
	of $C$ consists of rational functions $g/h$ such that the following hold:
	\begin{itemize}
		\item $g$ and $h$ are homogenous elements of $\mathbb{K}[x,y,z]$ of the same degree.
		\item $h$ does not lie in the ideal $(f)$.
		\item the functions $g_1/h_1$ and $g_2/h_2$ are considerd equivalent whenever $g_1h_2-g_2h_1 \in (f)$.
	\end{itemize}
\end{defin}

The function field of $C$ is denoted $\mathbb{K}(C)$, which should not to be 
confused with $C(\mathbb{K})$, the set of $\mathbb{K}$-rational points on $C$.  
The fact that $f$ is irreducible and $\mathbb{K}[x,y,z]$ is a unique factorization 
domain (so every irreducible element is prime) makes it clear that $\mathbb{K}(C)$ 
is, in fact, a field.  The field $\overline{\mathbb{K}}(C)$ is defined analogously, 
with $g,h \in \overline{\mathbb{K}}[x,y,z]$. Alternatively, if $C$ is defined by an 
affine equation $f(x,y) = 0$,  one can define $\mathbb{K}(C)$ as the fraction field 
of the ring $\mathbb{K}[x,y]/(f)$. The degree of the rational function $r=g/h$ is 
$max\{\deg g,\deg h\}$. We can now define a rational map.

\begin{defin}[Rational map]
	Let $C_1$ and $C_2$ be projective curves defined over $\mathbb{K}$.  
	A \emph{rational  map} $\varphi:C_1(\overline{\mathbb{K}}) \to C_2(\overline{\mathbb{K}})$ 
	is a map of the form $(\varphi_x:\varphi_y:\varphi_z)$, with
	$\varphi_x,\varphi_y,\varphi_z \in \overline{\mathbb{K}}(C_1)$, such that for every 
	point $P \in C_1(\overline{\mathbb{K}})$ where $\varphi_x,\varphi_y$ and $\varphi_z$ 
	are all defined, the point $(\varphi_x(P) :\varphi_y(P) :\varphi_z(P))$ lies 
	in $C_2(\overline{\mathbb{K}})$.
\end{defin}

What exactly does it mean for a regular map, for example $ \varphi_x $, to be defined at a point?
The concept is clear when we consider functions in a space like $ \mathbb{K}[x] $, but we are now 
working in a quotient space. We observe in fact that $\varphi= (\varphi_x:\varphi_y:\varphi_z)$ is 
defined only up to scalar equivalence:  for any $\lambda \in \bar{\mathbb{K}}^*$ the triple 
$(\lambda\varphi_x:\lambda\varphi_y:\lambda\varphi_z)$ defines exactly the same rational map $\varphi$.
There may be points $P \in C_1(\bar{\mathbb{K}})$ where one of $\varphi_x,\varphi_y$, or $\varphi_z$ 
is not defined, but in this case it may still be possible to evaluate the map $\varphi$ at $P$ 
after rescaling $\varphi$ by an element of $\mathbb{K}(C)$.

\begin{defin}[Regularity at $P$]
	In the notation of the previous definition, we say that $\varphi:C_1 \to C_2$ is 
	\emph{defined} (or \emph{regular}) at a point $P \in C_1(\overline{\mathbb{K}})$ if 
	there exists a function $g \in  \overline{\mathbb{K}}(C_1)$ such that $g\varphi_x$, 
	$g\varphi_y$, $g\varphi_z$ are all defined at $P$ and at least one is nonzero at $P$.
	We use $g \varphi$ to denote the map $(g\varphi_x:g\varphi_y:g\varphi_z)$.
\end{defin}

There may be many choices of representative for the equivalence class of $\varphi_x$ ,
and only some of them may be defined at $P$, as the following example shows.

\begin{example}
	Let $\mathbb{K}$ be a field of characteristic not equal to $2$. Let 
	$C$ be the elliptic curve defined by the algebraic set
	$V(y^2 - x(x - 1)(x + 1)) \subseteq A^2(\mathbb{K})$. Consider the functions
	$$f_1 := \frac{x(x-1)}{y}
		\hspace{20px}
		\text{and}
		\hspace{20px}
		f_2 := \frac{y}{x+1}$$
	We can check that $f_1$ is equivalent to $f_2$ . Note that $f_1$ is not defined 
	at $(0, 0), (1, 0)$ or $(-1, 0)$ while $f_2$ is defined at $(0, 0)$ and $(1, 0)$ 
	but not at $(-1, 0)$. The equivalence class of $f_1$ is therefore regular at $(0, 0)$ and $(1, 0)$.
\end{example}

\begin{defin}[Morphism]
	A rational map that is defined everywhere is called a \emph{morphism}.
\end{defin}

For elliptic curves, distinguishing rational maps from morphisms is unnecessary; 
every rational map between elliptic curves is a morphism.  More generally, we have the following.

\begin{teo}
	If $C_1$ is  a  smooth  projective  curve  then  every  rational
	map from $C_1$ to a projective curve $C_2$ is a morphism.
\end{teo}
\begin{proof}
	See \cite[II, Prop. 2.1]{Silverman}.
\end{proof}

\begin{oss}
	We observe that in general a morphism between elliptic curves does not
	respect the group structure of these curves: suppose $ E $ an elliptic 
	curve over a field $ \mathbb{K} $, and take $ Q \in E(\mathbb{K}) $. 
	We define the translation map
	$$\function{\tau_Q}{E(\overline{\mathbb{K}})}{E(\overline{\mathbb{K}})}{P}{P+Q}$$
	Clearly, $\tau_Q$ is a rational map that is defined everywhere on $E$ and so 
	is a morphism. However, this map does not respect the group structure of its 
	domain and codomain, in fact, for example, $O \mapsto Q$.
	\label{Rem:traslation}
\end{oss}

\subsection{Isogenies}
Elliptic  curves  have  both  an  algebraic  structure,  as  an  abelian  group, 
and  a  geometric structure, as an algebraic curve.  We now introduce isogenies, 
which are maps that respect both the algebraic and the geometric structure of these curves.

\begin{defin}[Isogeny]
	Let $E$ and $E'$ be elliptic curves defined over a field $\mathbb{K}$.
	An \emph{isogeny} is a morphism $\varphi: E(\overline{\mathbb{K}}) \to E'(\overline{\mathbb{K}})$ 
	such that $\varphi(O_{E}) = O_{E'}$. We call the \emph{zero isogeny} the constant 
	map $\varphi: E(\overline{\mathbb{K}}) \to E'(\overline{\mathbb{K}})$ given by 
	$\varphi(P)=O_{E'}$ for all $P \in E(\overline{\mathbb{K}})$.
\end{defin}

Unless otherwise stated, we assume that the isogeny $\varphi$ is itself 
defined over $\mathbb{K}$ (meaning that it can be represented by a rational 
map whose coefficients lie in $\mathbb{K}$). Isogenies can be characterized 
in different ways, all of which are equivalent. We have defined them in the 
way that will be more natural to use later, but we also list other definitions 
that will come in handy in other situations.

\begin{teo}
	Let $E,E'$ be two elliptic curves, and let 
	$\varphi : E(\overline{\mathbb{K}}) \to E'(\overline{\mathbb{K}})$
	be a map between them. The following are equivalent:
	\begin{itemize}
		\item $\varphi$ is a non-constant isogeny.
		\item $\varphi$ is a surjective group morphism.
		\item $\varphi$ is a group morphism with finite kernel.
	\end{itemize}
\end{teo}
\begin{proof}
	See \cite[III]{Silverman}.
\end{proof}

Two curves are called \emph{isogenous} if there exists an isogeny
between them. %
We shall see later that this is an equivalence relation.
We now look more in detail at isogenies of elliptic curves. %
We start with some basic definitions.

\begin{defin}[Degree, separability]
	Let $ \varphi:E(\overline{\mathbb{K}}) \to E'(\overline{\mathbb{K}})$ 
	be an isogeny defined over a field $\mathbb{K}$, and let
	$\mathbb{K}(E),\mathbb{K}(E')$ be the function fields of $E,E'$.
	By composing $\varphi$ with the functions of $\mathbb{K}(E')$, we obtain a
	subfield of $\mathbb{K}(E)$ that we denote by $ \varphi^\ast(\mathbb{K}(E'))$.
	\begin{enumerate}
		\item The \emph{degree} of $ \varphi$ is defined as
		      $\deg  \varphi = [\mathbb{K}(E): \varphi^\ast(\mathbb{K}(E'))]$.
		\item $ \varphi$ is said to be \emph{separable}, \emph{inseparable}, or
		      \emph{purely inseparable} if the extension of function fields is.
	\end{enumerate}
\end{defin}

\begin{prop}
	\label{prop:isogdef}
	In the same notation as above
	\begin{enumerate}
		\item $deg \; \varphi$ is always finite.
		\item If $ \varphi$ is separable, then $\deg  \varphi = \#\ker  \varphi$.
		\item If $ \varphi$ is purely inseparable, then $\deg  \varphi$ is a power of the characteristic of $\mathbb{K}$.
		\item Any isogeny can be decomposed as a product of a separable and
		      a purely inseparable isogeny.
	\end{enumerate}
\end{prop}
\begin{proof}
	See \cite[II]{Silverman}.
\end{proof}

In practice, most of the time we will be considering separable
isogenies, and we can take $\deg  \varphi  =  \#\ker  \varphi$ as the definition of the degree.
Notice that in this case $\deg  \varphi$ is the size of any fiber of $ \varphi$.

\begin{example}
	Consider the map $ \varphi$ from $E : y^2=x^3+x$ to $E' : y^2=x^3-4x$ defined by
	\begin{equation}
		\label{eq:isog-example}
		\begin{aligned}
			\varphi(x,y) & = \left(\frac{x^2+1}{x},y\frac{x^2-1}{x^2}\right), \\
			\varphi(0,0) & =  \varphi(O_{E}) = O_{E'}.
		\end{aligned}
	\end{equation}
	This is a separable isogeny between curves defined over $ \Q $. %
	It has degree $2$, and its kernel is generated by the point
	$(0,0)$. %
	\newpage
	Plotting the isogeny~\eqref{eq:isog-example} over $ \R $ would be
	cumbersome, however, since the curves are defined by integer
	coefficients, we may reduce the equations modulo a prime $p$, then
	the isogeny descends to an isogeny of curves over $\F_p$. %
	Figure~\ref{fig:isog-example} plots the action of the isogeny after
	reduction modulo $11$. %

	\begin{figure}[!h]
		\centering
		\begin{tikzpicture}[scale = 0.52, =>]
			\begin{scope}
				\node[anchor=center] at (5,11) {$E \;:\; y^2 = x^3 + x$};
				\tikzset{help lines/.style={color=black!50}}
				\draw[thick,step=1cm,help lines, dotted] (0,0) grid (10,10);
				\draw[thick,step=1cm,help lines] (0,0) to (0,10);
				\draw[thick,step=1cm,help lines] (0,0) to (10,0);
				\draw[thick,step=1cm,help lines] (10,10) to (0,10);
				\draw[thick,step=1cm,help lines] (10,10) to (10,0);
				\foreach \x in {-5,-4,...,5} { \node [anchor=north] at (\x + 5,-0.3) {\x}; }
				\foreach \y in {-5,-4,...,5} { \node [anchor=east] at (-0.3,\y + 5) {\y}; }
				\draw[fill] (5,5) circle (4pt);
				\draw[fill] (10,8) circle (4pt);
				\draw[fill] (10,2) circle (4pt);
				\draw[fill] (4,8) circle (4pt);
				\draw[fill] (4,2) circle (4pt);
				\draw[fill] (3,6) circle (4pt);
				\draw[fill] (3,4) circle (4pt);
				\draw[fill] (2,10) circle (4pt);
				\draw[fill] (2,0) circle (4pt);
				\draw[fill] (1,8) circle (4pt);
				\draw[fill] (1,2) circle (4pt);
			\end{scope}
			\begin{scope}[shift={(14,0)}]
				\node at (5,11) {$E' \;:\; y^2 = x^3 - 4x$};
				\tikzset{help lines/.style={color=black!50}}
				\draw[thick,step=1cm,help lines, dotted] (0,0) grid (10,10);
				\draw[thick,step=1cm,help lines] (0,0) to (0,10);
				\draw[thick,step=1cm,help lines] (0,0) to (10,0);
				\draw[thick,step=1cm,help lines] (10,10) to (0,10);
				\draw[thick,step=1cm,help lines] (10,10) to (10,0);
				\foreach \x in {-5,-4,...,5} { \node [anchor=north] at (\x + 5,-0.3) {\x}; }
				\foreach \y in {-5,-4,...,5} { \node [anchor=east] at (-0.3 + 11.4,\y + 5) {\y}; }
				\draw[fill] (5,5) circle (4pt);
				\draw[fill] (4,10) circle (4pt);
				\draw[fill] (4,0) circle (4pt);
				\draw[fill] (3,5) circle (4pt);
				\draw[fill] (1,9) circle (4pt);
				\draw[fill] (1,1) circle (4pt);
				\draw[fill] (7,5) circle (4pt);
				\draw[fill] (8,7) circle (4pt);
				\draw[fill] (8,3) circle (4pt);
				\draw[fill] (9,7) circle (4pt);
				\draw[fill] (9,3) circle (4pt);
			\end{scope}
			\draw [dashed]
			(2,10) edge (23,7)
			(2,0) edge (23,3)
			(1,8) edge (23,3)
			(1,2) edge (23,7)
			(4,8) edge (17,5)
			(4,2) edge (17,5)
			(3,6) edge (22,3)
			(3,4) edge (22,7)
			(10,2) edge (22,3)
			(10,8) edge (22,7);
		\end{tikzpicture}
		\caption{The isogeny $(x,y) \mapsto \bigl((x^2+1)/x,\;y(x^2-1)/x^2\bigr)$,
			as a map between curves defined over $\F_{11}$.}
		\label{fig:isog-example}
	\end{figure}

	A dashed arrow indicates that a point of the left curve is sent onto a
	point on the right curve; the action on the point in $(0,0)$, going to
	the point at infinity, is not shown. %
	We observe a symmetry with respect to the $x$-axis, a consequence of
	the fact that $ \varphi$ is a group morphism. By looking closer, we may
	also notice that collinear points are sent to collinear points, also a
	necessity for a group morphism. %
	\\
	\\
	It is evident that the isogeny is $2$-to-$1$, however we are unable to
	see all fibers over $\F_p$, because the isogeny is only surjective
	over the algebraic closure. %
	This is not dissimilar from the way power-by-$n$ maps act on the
	multiplicative group $\mathbb{K}^{\times}$ of a field $\mathbb{K}$:
	the map $x \mapsto x^2$, for example, is a $2$-to-$1$ (algebraic) group 
	morphism on	$\F_{11}^\times$, and those elements that have no preimage, the
	non-squares, will have exactly two square roots in $\F_{11^2}$, and so
	on. %
\end{example}

The most unique property of separable isogenies is that they are
entirely determined by their kernel. %

\begin{prop}
	\label{prop:isoker}
	Let $E$ be an elliptic curve defined over an algebraically closed
	field, and let $G$ be a finite subgroup of $E$. %
	There is a curve $E'$, and a separable isogeny $ \varphi$, such that
	$\ker  \varphi=G$ and $ \varphi:E(\overline{\mathbb{K}}) \rightarrow E'(\overline{\mathbb{K}})$. %
	Furthermore, $E'$ and $ \varphi$ are unique up to composition with an isomorphism.%
\end{prop}
\begin{proof}
	See \cite[III, Prop. 4.12]{Silverman}.
\end{proof}

Said otherwise, for any finite subgroup $G \subseteq E$,
we have an exact sequence of algebraic groups

\begin{equation*}
	0  \rightarrow G  \rightarrow E \overset{ \varphi}{ \rightarrow} E'  \rightarrow 0.
\end{equation*}

Uniqueness up to isomorphisms justifies the notation $E/G$ for the
isomorphism class of the image curve $E'$. Conversely, since for Prop. 
\ref{prop:isogdef} any non-constant morphism of elliptic curves
necessarily has finite kernel, we have a bijection between the finite
subgroups of a curve $E$ and the isogenies with domain $E$ up to
isomorphisms. The computational counterpart to the kernel-isogeny
correspondence is given by Vélu's much celebrated formulas. %

\begin{prop}
	\label{th:velu}
	Let $E:y^2=x^3+ax+b$ be an elliptic curve defined over a field $\mathbb{K}$,
	and let $G \subseteq E(\bar{\mathbb{K}})$ be a finite subgroup. The separable isogeny 
	$ \varphi:E(\overline{\mathbb{K}}) \rightarrow E/G(\overline{\mathbb{K}})$,
	of kernel $G$, can be written as
	\begin{equation*}
		\varphi(P) = \left(
		x(P) + \sum_{Q \in G\setminus\{O\}}x(P+Q)-x(Q),\\
		y(P) + \sum_{Q \in G\setminus\{O\}}y(P+Q)-y(Q)
		\right);
	\end{equation*} %
	and the curve $E/G$ has equation $y^2=x^3+a'x+b'$, where
	\begin{align*}
		a' & = a - 5\sum_{Q \in G\setminus\{O\}}(3x(Q)^2+a),         \\
		b' & = b - 7\sum_{Q \in G\setminus\{O\}}(5x(Q)^3+3ax(Q)+2b).
	\end{align*}
\end{prop}
\begin{proof}
	See \cite{Velu}.
\end{proof}

This correspondence between kernels and isogenies is rich in consequences:
the following useful facts are fairly straightforward.

\begin{cor}
	\label{coro:isog-basic}
	Any isogeny of elliptic curves can be decomposed as a product
	of prime degree isogenies.
\end{cor}
\begin{cor}
	Let $E$ be defined over an algebraically closed field $\mathbb{K}$, let
	$ \l $ be a prime different from the characteristic of $\mathbb{K}$, then
	there are exactly $ \l +1$ isogenies of degree $ \l $ with domain $E$,
	up to isomorphism.
\end{cor}

In particular, the last result follows immediately from that relation $E[l] \cong Z_l \times Z_l$, which has exactly $l+1$ subgroups of order $l$, and they are all such subgroups.
Slightly more work is required to prove the following, fundamental,
theorem.

\begin{teo}[Dual isogeny theorem]
	Let $ \varphi:E(\overline{\mathbb{K}}) \rightarrow E'(\overline{\mathbb{K}})$
	be an isogeny of degree $m$. There is a unique isogeny $\hat{ \varphi}:E' \rightarrow E$ such that
	\[\hat{ \varphi} \circ  \varphi = [m]_E, \quad  \varphi \circ \hat{ \varphi} = [m]_{E'}.\] %
	$\hat{ \varphi}$ is called the \emph{dual isogeny of $ \varphi$}; it has the
	following properties:
	\begin{enumerate}
		\item $\hat{ \varphi}$ has degree $m$.
		\item $\hat{ \varphi}$ is defined over $\mathbb{K}$ if and only if $ \varphi$ is.
		\item $\widehat{ \psi \circ  \varphi} = \hat{ \varphi} \circ \hat{ \psi}$ for any isogeny $ \psi:E' \rightarrow E''$.
		\item $\widehat{ \psi+ \varphi} = \hat{ \psi} + \hat{ \varphi}$ for any isogeny $ \psi:E \rightarrow E'$.
		\item $\deg  \varphi = \deg\hat{ \varphi}$.
		\item $\hat{\hat{ \varphi}} =  \varphi$.
	\end{enumerate}
\end{teo}
\begin{proof}
	See \cite[III.6]{Silverman}.
\end{proof}

Note that being isogenous is an equivalence relation: reflexivity and transitivity are obvious, while symmetry is guaranteed by the dual isogeny theorem.

\subsection{Isomorphisms}
Two projective curves $C_1$ and $C_2$ are isomorphic if they are related 
by an invertible morphism $\varphi$; this means that there is a morphism 
$\varphi^{-1}$ such that $\varphi^{-1} \circ \varphi$ and $\varphi \circ \varphi^{-1}$ 
are the identity maps on $C_1(\overline{\mathbb{K}})$ and $C_2(\overline{\mathbb{K}})$, 
respectively. If we admit the same definition also for elliptic curves, we would have, 
for example, that the $ Q $-translation morphism $ \tau_Q: E \to E $ described by Remark 
\ref{Rem:traslation} would have as inverse $ \tau_{-Q} $ and would therefore be an isomorphism.
We would like these maps, which do not preserve the group structure, not to be said to be isomorphisms.
For elliptic curves we have a stronger notion of isomorphism, since we also require the 
corresponding abelian groups to be isomorphic through $\varphi$; this means that the 
identity element must be preserved.

\begin{defin}[Isomorphism]
	Let $(E,O_E)$ and $(E',O_{E'})$ be elliptic curves over $\mathbb{K}$.
	An \emph{isomorphism} of elliptic curves 
	$\varphi: E(\overline{\mathbb{K}}) \to E'(\overline{\mathbb{K}})$ is an 
	isomorphism over $\overline{\mathbb{K}}$ of algebraic varieties such 
	that $\varphi(O_E)=O_{E'}$. Equivalently, an isomorphism of elliptic 
	curves is an invertible isogeny. If there is an isomorphism from 
	$E$ to $E'$ then we write $E \cong E'$.
\end{defin}

Isomorphism classes are traditionally encoded by an invariant, whose
origins can be traced back to complex analysis.

\begin{prop}[$j$-invariant]
	\label{th:j}
	Let $E:y^2=x^3+ax+b$ be an elliptic curve, and define the
	\emph{$j$-invariant} of $E$ as
	\[j(E) = 1728\frac{4a^3}{4a^3+27b^2}.\] %
	Two curves are isomorphic over the algebraic closure $\overline{\mathbb{K}}$ if
	and only if they have the same $j$-invariant.
\end{prop}
\begin{proof}
	See [?].
\end{proof}

\begin{defin}[Automorphism]
	An automorphism of $E/\mathbb{K}$ is an isomorphism from $E$ to itself.
	The group of all auto-morphisms of $E$ that are defined over a field 
	$\mathbb{K}'$ is denoted by $\Aut_{\mathbb{K}'}(E)$.
\end{defin}

\subsection{Endomorphisms}
Finally, we note the special case of an isogeny 
$\alpha: E(\overline{\mathbb{K}}) \to E(\overline{\mathbb{K}})$ from an 
elliptic curve to itself; this is called an \emph{endomorphism}.
Since they are algebraic group morphisms, we can define addition of
endomorphisms by $( \varphi + \psi )(P) =  \varphi (P)+ \psi (P)$, 
and the resulting map is still an endomorphism. Thus, by identifying 
the constant map that sends every point to the point at infinity with 
the neutral element, the set of endomorphisms forms a group. Additionally,
we can equip this structure with a binary operation, the  composition of 
endomorphisms, and verify that it distributes over addition, hence the set 
of all endomorphisms from curve $E$ to itself forms a ring, denoted by $\End(E)$.

\begin{example}
	The prototypical endomorphism is the multiplication-by-$m$ endomorphism defined by
	$$\function{[m] \;}{\; E}{E}{P}{\lbrack m \rbrack P}$$
	This is obviously a group homomorphism, and it is also a rational map. 
	Its kernel is exactly the $m$-th torsion subgroup $E[m]$. %
	For convenience, in the following we describe the multiplication-by-2 and 
	multiplication-by-3 maps. We will use an elliptic curve written in Montgomery form.
	The arithmetic of the group $E(\mathbb{K})$ obviously readjusts to this definition.
	This form of writing is the one that is most frequently used in applications.
	The CSIDH protocol is no exception.	Consider the multiplication-by-$2$ or point 
	doubling map on a fixed Montgomery curve $E_A : y^2 = x^3 + Ax^2 + x$, written as
	$$\function{[2]}{E_A}{E_A}{x}{\frac{(x^2 - 1)^2}{4x(x^2 + Ax + 1)}}$$

	In the following we take into account only the $x$-coordinate of the map, since it
	is sufficient to study its behavior and discover which points are sent to $O$.
	Observe that the doubling map has a denominator that will create exceptional points.
	Viewing the curve equation, we see that these are the three points with $y = 0$, namely
	$(0, 0), (\alpha, 0)$ and $(1/\alpha, 0)$, where $\alpha^2 + A \alpha + 1 = 0$. Indeed,
	these are the three points of order	$2$ on $E_A$ , and together with the neutral element,
	$O$, they are the entire kernel of the doubling map. This kernel forms a subgroup of the 
	points in $E_A$ , with group structure $$\ker([2]) \cong \Z_2 \times \Z_2$$
	i.e. the $2$-torsion is precisely three cyclic subgroups of order $2$. Each subgroup
	has one of the three points of exact order $2$, together with the identity element $O$.
	This is depicted in Figure \ref{fig:ker[2]}. Now consider the multiplication-by-$3$ or 
	point tripling map on the curve	$E_A : y 2 = x^3 + Ax^2 + x$, written as
	$$\function{[3]}{E_A}{E_A}{x}{\frac{x(x^4 - 6x^2 - 4Ax^3 - 3)^2}{(3x^4 + 4Ax^3 + 6x^2 - 1)^2}}$$
	Again, the denominator will give rise to exceptional points to the tripling map.
	Suppose its four roots are $\beta, \gamma, \zeta, \theta $; each of these correspond 
	to $x$-coordinates of points of order $3$ in $E_A$ , and this time there are two (non-zero)
	$y$-coordinates for	each such $x$. Together with $O$, there are then $9$ points that are sent 
	to $O$ under $[3]$, and this time we have $$\ker([3]) \cong \Z_3 \times \Z_3$$ i.e. the $3$-torsion
	is precisely four cyclic subgroups of order $3$. This is depicted in Figure \ref{fig:ker[3]}.

	\begin{figure}[!h]
		\begin{minipage}{0.45\textwidth}
			\centering
			\begin{tikzpicture}[scale=0.53]
				\begin{pgfonlayer}{nodelayer}
					\node [style=white] (0) at (0, 0) {};
					\node [style=none, scale=0.7] (1) at (0, 0) {$O$};
					\node [style=none] (4) at (2, -3.25) {};
					\node [style=none] (5) at (-4, 0) {};
					\node [style=none] (6) at (2, 3.25) {};
					\node [style=none, scale=0.7] (8) at (-2.75, 0) {$(\alpha^{-1},0)$};
					\node [style=none, scale=0.7] (9) at (1.4, 2.25) {$(\alpha,0)$};
					\node [style=none, scale=0.7] (12) at (1.5, -2.5) {$(0,0)$};
				\end{pgfonlayer}
				\begin{pgfonlayer}{edgelayer}
					\draw [in=-150, out=-90, looseness=1.25] (5.center) to (1);
					\draw [in=-30, out=30, looseness=1.25] (1) to (6.center);
					\draw [in=-150, out=-90, looseness=1.25] (1) to (4.center);
					\draw [in=150, out=90, looseness=1.25] (5.center) to (1);
					\draw [in=-30, out=30, looseness=1.25] (4.center) to (1);
					\draw [in=150, out=90, looseness=1.25] (1) to (6.center);
				\end{pgfonlayer}
			\end{tikzpicture}
			\caption{$\ker([2]) \cong \Z_2 \times Z_2$. Three cyclic subgroups of order $2$.}
			\label{fig:ker[2]}
		\end{minipage}
		\hfill
		\begin{minipage}{0.45\textwidth}
			\centering
			\begin{tikzpicture}[scale=0.4]
				\begin{pgfonlayer}{nodelayer}
					\node [style=none] (4) at (4, -4) {};
					\node [style=none] (5) at (-4, 4) {};
					\node [style=none] (6) at (4, 4) {};
					\node [style=white] (13) at (0, 0) {};
					\node [style=none] (14) at (0, 0) {};
					\node [style=none, scale=0.7] (15) at (0, 0) {$O$};
					\node [style=none] (16) at (-4, -4) {};
					\node [style=none, scale=0.7] (17) at (-2.75, 2.75) {$(\beta,-\gamma)$};
					\node [style=none, scale=0.7] (18) at (2.75, 2.75) {$(\delta,-\epsilon)$};
					\node [style=none, scale=0.7] (19) at (-3, -3) {$(\zeta,-\eta)$};
					\node [style=none, scale=0.7] (20) at (3, -3) {$(\theta,-\iota)$};
					\node [style=none, scale=0.7] (21) at (-1.75, 1.75) {$(\beta,\gamma)$};
					\node [style=none, scale=0.7] (22) at (1.75, 1.75) {$(\delta,\epsilon)$};
					\node [style=none, scale=0.7] (23) at (-2.25, -2) {$(\zeta,\eta)$};
					\node [style=none, scale=0.7] (24) at (2.25, -2) {$(\theta,\iota)$};
				\end{pgfonlayer}
				\begin{pgfonlayer}{edgelayer}
					\draw [in=45, out=105] (15.center) to (5.center);
					\draw [in=-105, out=-45] (16.center) to (15.center);
					\draw [in=-45, out=15] (15.center) to (6.center);
					\draw [in=-15, out=45] (4.center) to (15.center);
					\draw [in=-135, out=-75] (15.center) to (4.center);
					\draw [in=-165, out=135] (16.center) to (15.center);
					\draw [in=-135, out=165] (15.center) to (5.center);
					\draw [in=135, out=75] (15.center) to (6.center);
				\end{pgfonlayer}
			\end{tikzpicture}
			\caption{$\ker([3]) \cong \Z_3 \times \Z_3$. Four cyclic subgroups of order $3$.}
			\label{fig:ker[3]}
		\end{minipage}
	\end{figure}
\end{example}

\begin{example}
	Given an elliptic curve $ E / \mathbb{F}_q $, we consider the set of points 
	defined by $ E (\overline{\mathbb{F}_q}) $. The Frobenius endomorphism of the 
	extension $E(\overline{\mathbb{F}_q}) / E(\mathbb{F}_q)$ is the map 
	$$ \varphi: {E (\overline {\mathbb{F}_q})} \rightarrow {E (\overline{ \mathbb{F}_q})} $$ 
	defined by
	$$
		\begin{cases}
			(x,y)           & \longmapsto (x^q,y^q)       \\
			\hspace{10px} O & \longmapsto \hspace{15px} O
		\end{cases}
	$$
	\\
	It is immediate to verify that this map is an endomorphism, so that its name is justified.
	Furthermore, since this is a morphism, it can be shown easily that it preserves the order 
	of the points, that is $\vert \, P \, \vert =  \vert \, \varphi(P) \, \vert$.
\end{example}

Frobenius endomorphism plays a very important role in the theory of elliptic curves, as we will see in the next section.

\begin{prop}
	Let $E$ and $E'$ be elliptic curves over $\mathbb{K}$. If 
	$n \in \N \setminus \lbrace 0 \rbrace$ then $[n]$ is not the zero isogeny.
	Furthermore, $Hom(E,E')$ is a torsion-free $\Z$-module (i.e. if $
		\varphi \in Hom(E,E')$ is non-zero then $[n] \circ \varphi$ is non-zero
	for all $n \in \Z \setminus \lbrace 0 \rbrace$), and $\End(E)$ has no zero divisors.
\end{prop}
\begin{proof}
	See \cite[Lem. 9.6.11]{Galbraith}.
\end{proof}

We shall now give a complete characterization of the endomorphism ring
for any elliptic curve. Since $\End(E)$ is a torsion-free $\Z$-module, 
each $m \in  \Z $ defines a different multiplication-by-$m$ endomorphism, 
indeed suppose $[n]=[m]$ for some $n,m \in \N$. Then $[n]-[m]=[0]$, so 
that $[n-m]=[0]$. Since we have no torsion point on $\End(E)$ we conclude 
that $n-m=0$, i.e. $n=m$. It follows that the map $\Z \to \End(E)$ sending 
$n$ to $[n]$ is injective and we can simply view $\Z$ as a subring of
$\End(E)$. But could $\End(E)$ be larger? %

\begin{defin}[Algebra]
	An \emph{algebra} $A$ over a field $\mathbb{K}$ (equivantely, 
	a $\mathbb{K}$-algebra $A$) is a vector space over $\mathbb{K}$ 
	equipped with an additional binary bilinear operation 
	$\cdot : A \times A \to A$.
\end{defin}

\begin{defin}[Order]
	\label{def:order}
	Let $K$ be a finitely generated $ \Q $-algebra. %
	An \emph{order} $\O \subseteq K$ is a subring of $K$ that is a finitely
	generated $ \Z $-module, and that contains a $ \Q $-basis for $K$.
\end{defin}

\begin{defin}[Quadratic number field]
	A \emph{quadratic number field} is a quadratic extension $K$ of the rationals; it is called \emph{real} if there exists an embedding
	$K \subseteq   \R $, \emph{imaginary} otherwise. %
\end{defin}

All such fields can be expressed as $ \Q (\sqrt{d})$ for some square-free integer $d$.
The field of \emph{Gaussian numbers} $\Q(\sqrt{-1}) = \Q(i)$,
whose ring of integers is $\Z[i]$ (also called the ring of Gaussian
integers), is an example of an imaginary one.

\begin{defin}[Quaternion algebra]
	A \emph{quaternion algebra} is an algebra of the form
	\[K =  \Q  +  \alpha  \Q  +  \beta  \Q  +  \alpha  \beta  \Q ,\]
	where the generators satisfy the relations
	\[ \alpha ^2, \beta ^2 \in  \Q , \quad  \alpha ^2<0, \quad  \beta ^2 < 0, \quad  \beta  \alpha = - \alpha  \beta .\]
\end{defin}

Now we have all the necessary bases to state and understand the 
following important result, which highlights the structure of 
the endomorphism ring of an elliptic curve.

\begin{teo}[Deuring]
	\label{Deuring}
	Let $E$ be an elliptic curve defined over a field $\mathbb{K}$ of
	characteristic $p$. %
	The ring $\End(E)$ is isomorphic to one of the following:
	\begin{itemize}
		\item The integer ring $\Z $.
		\item An order $\O$ in a quadratic imaginary field (a number field
		      of the form $ \Q (\sqrt{-D})$ for some $D>0$).
		      in this case we say that $E$ has \emph{complex multiplication} by $\O $;
		\item A maximal order in a quaternion algebra
		      ramified at $p$ and $\infty $.
	\end{itemize}
\end{teo}
\begin{proof}
	See \cite[III, Cor. 9.4]{Silverman} and \cite{Kohel}.
\end{proof}

We will observe how regular elliptic curves always have complex complication, 
while supersingular ones can have both complex or quaternionic multiplication, 
depending on the field on which their endomorphisms are defined, and so they are 
generally not covered by the theory of complex multiplication.
In general we know that the endomorphism ring of an elliptic curve over $\F_q$ 
is an order in a division algebra $A$. Depending on the number of $\F_q$-rational 
points there are some more precise results about this as can be seen in the next theorem.

\begin{teo}
	\label{thm:supersingular}
	Let $p>3,q=p^n$ and $E$ be a supersingular elliptic curve over 
	$\F_q$ with $E(\F_q) = q+1-t$ where $\mid t \mid \leq 2\sqrt{q}$. 
	Then one of the following cases must be true:
	\begin{enumerate}
		\item $n$ is even and $t=\pm 2 \sqrt{q}$.
		\item $n$ is even, $p \not\equiv 1 \pmod{3}$ and $t=\pm \sqrt{q}$.
		\item $n$ is even, $p \not\equiv 1 \pmod{4}$ and $t= 0$.
		\item $n$ is odd and $t=0$.
	\end{enumerate}
	In this situation the corresponding division algebra $A$ is also 
	determined by the cases. Let $\pi_q$ be the $q$-th power Frobenius 
	endomorphism. In the first case $A$ is a quaternion algebra over $\Q$, 
	$\pi_q$ is a rational integer and $\End_{\F_q}(E)$ is a maximal order 
	in $A$. In the other three cases $A = \Q(\pi_q)$ is an imaginary 
	quadratic field over $\Q$ and $\End_{\F_q}(E)$ is an order in $A$ 
	with conductor prime to $p$.
\end{teo}
\begin{proof}
	See \cite{Wat}.
\end{proof}

\subsection*{Twist}
An important tool we will use is given in the following. 
We will assume that $\F_q$ is a field of characteristic different from $2$.

\begin{defin}
	Let $\F_q$ be a field and $E_1, E_2$ be elliptic curves 
	over $\F_q$. Suppose that they are isomorphic over $\F_{q^d}$ 
	for some $d > 1$, but are not  isomorphic over any smaller extension 
	of $\F_q$. $E_1$ and $E_2$ are said to be \emph{degree-$d$ twists} of 
	each other (or, simply, a \emph{twist}). In particular, a degree-$2$ 
	twist is called a \emph{quadratic} twist. Degree-$3$ and $4$ twists 
	will be called, respectively, \emph{cubic} and \emph{quartic} twists.
\end{defin}

\begin{prop}
	Let $E : y^2=x^3+Ax+B$ be an elliptic curve over $\F_q$. $E$ has a quadratic
	twist given by $$E^d : dy^2=x^3+Ax+B$$ where $d \in \F_q^{\times}$ is a non-square.
\end{prop}
\begin{proof}
	See \cite[II]{Washington}.
\end{proof}

\begin{prop}
	Let $E$ and $E^d$ be a quadradic twist one of the other. Then
	$$\vert E(\F_q) \vert + \vert E^d(\F_q) \vert = 2q + 2$$
	Equivalentely, $t_E = -t_{E^d}$, where $t_{E}$ is the trace of 
	the Frobenius endomorphism of the curve.
\end{prop}
\begin{proof}
	Consider the curve $E := y^2=f(x)$ and its quadratic $d$-twist 
	$E^d:= dy^2=f(x)$. Denote with $\chi : \F_q \to \{ -1,0,1 \}$ the map defined by
	\[
		\chi(x) =
		\begin{cases}
			0  & \text{if $x=0$}                              \\
			1  & \text{if $x$ is a non-zero qadratic residue} \\
			-1 & \text{otherwise}
		\end{cases}
	\]
	We immediately obtain that
	$$
		\begin{cases}
			\#E(\F_q) = 1 + q - t \\
			\#E(\F_q) = 1 + \sum_{x \in \F_q}(1+\chi(f(x))
		\end{cases}
	$$
	The first equation will be discussed later. We conclude that 
	$t_E = -\sum{\chi(f(x))}$ and $t_{E^d}=-\sum{\chi(f(x)/d)}=-t_E$, 
	where the last equality is justified by the fact that $d$ is not 
	a quadratic residue modulo $q$.
\end{proof}

Note that a generic curve and its twists always have the same j-invariant. Furthermore:
\begin{itemize}
	\item If $j(E) \neq 0,1728$, then $\Aut_{\F_q}(E)$ has order $2$ with generator $(x,y) \mapsto (x,-y)$.
	\item If $j(E) = 1728$, then $\Aut_{\F_q}$ is cyclic of order $4$ with generator $\psi: (x,y) \mapsto (-x,iy)$
	      where $i \in {\F_q}$ is a primitive fourth root of unity.
	\item If $j(E) = 0$,  then $\Aut_{\F_q}$ is cyclic of order $6$ with generator $\rho : (x,y) \to (\nu x,-y)$
	      where $\nu \in {\F_q}$ is a primitive third root of unity.
\end{itemize}


\section{Nontrivial Results}
Let's see now how to use the morphisms described above to enrich our knowledge about elliptic curves.

\subsection*{Cardinality of $E/\F_q$}
Every endomorphism on an elliptic curve satisfies a quadratic characteristic polynomial with integer coefficients.

\begin{teo}
	Let $E$ be an elliptic curve over $\mathbb{K}$ and $\varphi \in End(E)$ be a non-zero endomorphism. Let $d = \deg(\varphi)$. Then there is an integer $t$ such that $\varphi^2 - t\varphi + d = 0$ in $End(E)$.
	In other words, for all $P \in E(\mathbb{K})$,
	$$\varphi(\varphi(P )) - [t]\varphi(P) + [d]P = O$$
	The integer $t$ is called the trace of the endomorphism.
\end{teo}
\begin{proof}
	See \cite[Th. 9.9.3]{Galbraith}.
\end{proof}

In particular, if we are given a finite field $\F_q$, the Frobenius satisfies 
the aforementioned relation for all $P \in E(\mathbb{F}_q)$. In other words, 
for every point $P = (x,y) \in E(\overline{\mathbb{F}_q})$ the following equation holds:
$$ (x^{{q^{{2}}}},y^{{q^{{2}}}})+q(x,y)=t(x^{{q}},y^{{q}}).$$
The integer $t$ in equation above is naturally called the trace of Frobenius. 
This object is strongly related to the cardinality of $E/\F_q$, as the following result points out.

\begin{teo}
	Let $E$ be an elliptic curve over $\F_q$ and let $P(T)$ be the characteristic polynomial of Frobenius. Then
	$\#E(\F_q) = P(1) = 1 + q - t$.
\end{teo}
\begin{proof}
	See \cite[Th. 9.10.3]{Galbraith}.
\end{proof}

From the previous result it is clear that, if we were able to limit the value of $ t $, 
we would also have a bound for the value $ \#E/ \F_q$. Hasse's theorem on elliptic curves, 
also referred to as the Hasse bound, exploit exactly this fact and provides an estimate 
of the number of points of an elliptic curve over a finite field, bounding the value both 
from above and below.

\begin{teo}[Hasse]
	\label{Hasse}
	Let $E$ be an elliptic curve over $\F_q$ and denote
	by $t$ the trace of the $q$-power Frobenius map.
	Then $\vert t \vert \leq 2 \sqrt{q}$.
\end{teo}
\begin{proof}
	See \cite[Th. 9.10.7]{Galbraith}.
\end{proof}

Since we know that $t = 1 + q - \#E(\F_q)$, Hasse's theorem states that, 
given an elliptic curve $E / \mathbb{F}_q$, the number of elements of $E(\mathbb{F}_q)$ 
satisfies the following relation $$ \#E ( F_q ) \in \lceil q+1- 2 \sqrt{q} \; , \; q+1+ 2 \sqrt{q} \rfloor$$

\subsection*{Division Polynomials}
A useful tool to investigate the group structure of $E(\mathbb{F}_q)$ is a 
familiy of multivariate polynomials of $\mathbb{F}_q[x,y]$ called the division 
polynomials of $E$. They play a central role in the study of counting points on 
elliptic curves and are defined recursively as following.

\begin{align*}
	\psi_0(x,y)      & = 0                                                                                            \\
	\psi_1(x,y)      & = 1                                                                                            \\
	\psi_2(x,y)      & = 2y                                                                                           \\
	\psi_3(x,y)      & = 3x^4+6Ax^2+12Bx - A^2                                                                        \\
	\psi_4(x,y)      & = 4y(x^6+5Ax^4+20Bx^3-5A^2x^2 - 4ABx - 8B^2 - A^3)                                             \\
	\vdots                                                                                                            \\
	\psi_{2m+1}(x,y) & = \psi_{m+2}(x,y)\psi_{m}^3(x,y) - \psi_{m-1}(x,y)\psi_{m+1}^3(x,y)                            \\
	\psi_{2m}(x,y)   & = (2y)^{-1}\psi_{m}(x,y)(\psi_{m+2}(x,y)\psi_{m-1}^2(x,y) - \psi_{m-2}(x,y) \psi_{m+1}^2(x,y))
\end{align*}
\\
Observe that a generic division polynomial depends on the parameters $ A, B $ that define the elliptic curve.
\\
\\
The roots of a generic $l$-th division polynomial are closely related to 
the $l$-torsion subgroup of an elliptic curve, in particular it is possible 
to show that the roots of $\psi_{2n+1}$ are the $x$ coordinates of the points 
of $E[2n+1] \setminus \{ \O \}$, where $E [ 2 n + 1 ]$ is the $( 2 n + 1 )$-$th$ torsion 
subgroup of $E$. Similarly, the roots of ${\psi_{2n}} / {y}$ are the $x$-coordinates 
of the points of $E [ 2 n ] \setminus E [ 2 ]$ .
\\
\\
An application that is very useful for our purposes is the use of these polynomials 
to compute the multiplication of a given point $P$ by a scalar $t$. To compute $tP$ 
for a large integer $t$, it is inefficient to add $P$ to itself repeatedly.
Instead of doing this, $ tP $ could be evaluated in another way using the $t$-th 
division polynomial: given $ P \in E (\mathbb{F}_q) $ the following important relation holds.

\begin{equation}\label{ScalarMultiplication}
	t(x,y) =: (x_t,y_t) =  \bigg( x - \frac{\psi_{t-1}\psi_{t+1}}{2 \psi_{t}^2}, \frac{\psi_{2t}}{2 \psi_{t}^4}  \bigg).
\end{equation}


\subsection*{Isogeny classes}
We have learned previously that being isogenous is an equivalence
relation, it thus makes sens to speak of the \emph{isogeny class} of an elliptic
curve. %
Here, we are interested in characterizing these isogeny classes, and
their connectivity structure. %
We will mostly focus on isogeny classes over finite fields, however we
will occasionally mention the complex case.
We start with a theorem that links isogeny classes with the theory we previously learned about.

\begin{defin}[Endomorphism algebra]
	Let $\mathbb{K}$ be a field and $E$ an elliptic curve over $\mathbb{K}$. 
	Denote with $\pi$ the Frobenius endomorphism of $E$ and with $t$ its trace.
	Define then $D_\pi := t - 4q$ and observe that $D_{\pi} < 0$,
	thanks to Theorem \ref{Hasse}. $\Q[\sqrt{D_{\pi}}]$ is called 
	the \emph{endomorphism algebra} of $E$.
\end{defin}

It is possibile to verify that $\pi \in \Q[D_{\pi}]$; so, at 
least in the ordinary case, remembering Theorem \ref{Deuring}, 
we can affirm that $$\Z[\pi] \subseteq \End(E) \subseteq \Q[ \sqrt{D_{\pi}} ]$$

\begin{teo}[Serre-Tate]
	Two elliptic curves $E,E'$ with complex or quaternionic
	multiplication are isogenous if and only if their \emph{endomorphism
		algebras} are isomorphic.
\end{teo}

In layman terms, this theorem is telling us that:
\begin{itemize}
	\item Two curves with complex multiplications by $\O$ and $\O'$
	      respectively are isogenous if and only if $\O \subseteq \O'$ or $\O' \subseteq \O$; or
	      equivalently if and only if $\O$ and $\O'$ have the same field of
	      fractions.
	\item Any two supersingular curves defined over a field of characteristic $p$ are isogenous (see Teorem \ref{thm:supersingular}).
\end{itemize}

An easy consequence for the finite field is case is the following.

\begin{cor}
	\label{coro:serre-tate}
	Two elliptic curves $E,E'$ defined over a finite field $\mathbb{K}$ are
	isogenous over $\mathbb{K}$ if and only if $\#E(\mathbb{K})=\#E'(\mathbb{K})$.
\end{cor}

\chapter{Isogeny Graphs}
In this section we explain some aspects of elliptic curves with complex and quaternionic multiplication.
In this way we will provide the theoretical basis
to understand isogeny graphs, a very useful tool for the post quantum algorithms we want to analyze.
Later we will restrict this graph by basically imposing two limitations:
\begin{itemize}
	\item We limit ourselves to consider as vertices of the graph only the elliptic curves having as endomorphism ring (an algebraic structure isomorphic to) a fixed order $\O$. We will denote this set with $ \Ell(\O) $.
	\item We will consider as edges only the isogenies defined on $ \F_q $, the base field of the curve, that is, we will ignore the isogenies defined on the algebraic closure $\overline{\F}_q$.
\end{itemize}

\section{Complex Multiplication}
We now present one of the most powerful tools for the study of isogeny graphs: the theory of \emph{complex multiplication}.
We start by introducing lattices $\Lambda$ over the complex space, and the complex tori family $ \lbrace \C / \Lambda \rbrace _{\Lambda} $. We will therefore show that there is a bijection
$$
	\lbrace \C / \Lambda \rbrace_{\Lambda}
	\stackrel{\mathrm{1:1}}{\longleftrightarrow}
	\lbrace \text{Elliptic curves} \rbrace
$$
We start with some preliminary notions.

\subsection{Complex Tori}
\begin{defin}[Complex lattice]
	A \emph{complex lattice} $ \Lambda $ is a discrete subgroup of $ \C  $ that
	contains an $ \R $-basis of $ \C  $.
\end{defin}

Explicitly, a complex lattice is generated by a \emph{basis}
$( \omega _1, \omega _2)$, such that $ \omega _1 \neq  \lambda  \omega _2$ for any $ \lambda  \in    \R $, as
\[ \Lambda  =  \omega _1 \Z  +  \omega _2 \Z .\] %
Up to exchanging $ \omega _1$ and $ \omega _2$, we can assume that $\im( \omega _1/ \omega _2)>0$;
we then say that the basis has \emph{positive orientation}. %
A positively oriented basis is obviously not unique.

\begin{prop}
	\label{th:basis-change}
	Let $ \Lambda $ be a complex lattice, and let $( \omega _1, \omega _2)$ be a positively
	oriented basis, then any other positively oriented basis
	$( \omega _1', \omega _2')$ is of the form
	\begin{align*}
		\omega _1' & = a \omega _1 + b \omega _2, \\
		\omega _2' & = c \omega _1 + d \omega _2,
	\end{align*}
	for some matrix
	$\left(\begin{smallmatrix}a&b\\c&d\end{smallmatrix}\right) \in   \SL_2( \Z )$.
\end{prop}
\begin{proof}
	See~\cite[I, Lem.~2.4]{silverman:advanced}.
\end{proof}

\begin{defin}[Complex torus]
	Let $ \Lambda $ be a complex lattice, the quotient $ \C  / \Lambda $ is called a
	\emph{complex torus}.
\end{defin}

A convex set of class representatives of $ \C  / \Lambda $ is called a
\emph{fundamental parallelogram}. %
The additive group structure of $ \C  $ carries over to $ \C  / \Lambda $, and can be
graphically represented as operations on points inside a fundamental
parallelogram. %


\begin{defin}[Homothetic lattices]
	Two complex lattices $ \Lambda $ and $ \Lambda '$ are said to be \emph{homothetic}
	if there is a complex number $ \alpha  \in    \C  ^{ \times }$ such that $ \Lambda = \alpha  \Lambda '$.
\end{defin}

Geometrically, applying a homothety to a lattice corresponds to zooms
and rotations around the origin. %
We are only interested in complex tori up to homothety; to classify
them, we introduce the \emph{Eisenstein series of weight $2k$},
defined as
\[G_{2k}( \Lambda ) := \sum_{ \omega  \in    \Lambda \setminus\{0\}} \omega ^{-2k}.\]
It is customary to set
\[g_2( \Lambda ) := 60G_4( \Lambda ), \quad g_3( \Lambda ) := 140G_6( \Lambda );\] %

\begin{teo}[Modular $j$-invariant]
	The \emph{modular $j$-invariant} is the function on complex lattices
	defined by
	\[j( \Lambda ) = 1728 \frac{g_2( \Lambda )^3}{g_2( \Lambda )^3 - 27g_3( \Lambda )^2}.\] %
	Two lattices are homothetic if and only if they have the same
	modular $j$-invariant.
\end{teo}
\begin{proof}
	See~\cite[I, Th.~4.1]{silverman:advanced}.
\end{proof}

It is no chance that the invariants classifying elliptic curves and
complex tori look very similar. %
Indeed, it is a known result of complex analysis that there is a one-to-one correspondence between these two sets.
\\
\\
Using the correspondence between elliptic curves and complex tori, we
now have a new perspective on their group structure. %
Looking at complex tori, it becomes immediately evident why the
torsion part has rank $2$, i.e. why $E[m] \cong ( \Z /m \Z )^2$. %
\\
\\
We can define operations between tori: we define the multiplication-by-$m$ map as
\begin{align*}
	[m] :  \C  / \Lambda & \to  \C  / \Lambda ',       \\
	z                    & \mapsto z \bmod  \Lambda ';
\end{align*}
where $m \Lambda '= \Lambda $. Equivalently, we could have defined
\begin{align*}
	[m] :  \C  / \Lambda & \to  \C  / \Lambda ,       \\
	z                    & \mapsto mz \bmod  \Lambda;
\end{align*}

In general, whenever two lattices $ \Lambda , \Lambda '$ verify $ \alpha  \Lambda  \subseteq   \Lambda '$, there is a well defined map
\begin{align*}
	\varphi   _ \alpha  :  \C  / \Lambda & \to  \C  / \Lambda ',              \\
	z                                    & \mapsto  \alpha z \bmod  \Lambda '
\end{align*}
%that is holomorphic and also a group morphism. %
It turns out that these maps are exactly the isogenies of the
corresponding elliptic curves.

\begin{teo}
	Let $E,E'$ be elliptic curves over $ \C  $, with corresponding lattices
	$ \Lambda , \Lambda '$. %
	There is a bijection between the set of isogenies from $E$ to $E'$
	and the set of maps $ \varphi_ \alpha $ for all $ \alpha $ such that $ \alpha  \Lambda  \subseteq   \Lambda '$.
\end{teo}
\begin{proof}
	See~\cite[VI, Th.~4.1]{silverman:elliptic}.
\end{proof}

\begin{oss}
	Within this new perspective, isogenies are a mild generalization of
	scalar multiplications. %
	Under which conditions does an isogeny become an endomorphism? By
	virtue of the last theorem, there is a one-to-one correspondence
	between the endomorphisms $E \to E$ and the complex numbers $ \alpha $ such
	that $ \alpha  \Lambda  \subseteq   \Lambda $. %
	In general, the only possible choices are given by $ \alpha $ an integer,
	corresponding to scalar multiplications. %
	For some lattices, however, something "special" happens.
	These special cases reflect the nature of the structure of $\End(E)$ that we have described in the previous chapter. In this regard, we refer to Theorem [?].
\end{oss}


\subsection{The Ideal Class Group}
Given a lattice $ \O $ in an imaginary quadratic field,
we would like to study the set of elliptic curves $ \Ell(\O)$. To do this we introduce a new object, the ideal class group $ \Cl(\O) $. We will show that these two sets are in one-to-one relation, so that
$$
	\Ell(\O)
	\stackrel{\mathrm{1:1}}{\longleftrightarrow}
	\Cl(\O)
$$
and we will find out that $\Cl(\O)$ acts on $ \Ell(\O) $ freely and transitively.
This last result is of fundamental importance for the CSIDH protocol.
Before defining the ideal class group, we still need to recall some basic definitions from algebraic number theory; for a more detailed treatment, see [?]. %~\cite{langANT}


\begin{defin}[Discriminant]
	Let $d$ be a square free integer, the \emph{discriminant} of the
	quadratic number field $\Q(\sqrt{d})$ is $d$ if $d=1\bmod 4$, and
	$4d$ otherwise.
\end{defin}

The discriminant is an object that can be defined more generically,
and what we have provided above is a specific definition where the field extension has degree $2$. In this case the discriminant
is also called the \emph{fundamental discriminant}.

\begin{defin}[Ring of integers]
	Let $K$ be a number field, an \emph{algebraic integer} of $K$ is an
	element $ \alpha  \in K$ that is root of an irreducible monic polynomial with
	integer coefficients. %
	The algebraic integers of $K$ form a ring, called the \emph{ring of
		integers} of $K$.
\end{defin}

For example, $ \Z [i]$ is the ring of integers of $\Q(i)$; more generally,
if $ \Delta $ is a fundamental discriminant, the ring of integers of a generic imaginary quadratic field
$\Q(\sqrt{ \Delta })$ is $ \Z [ \delta ]$, where $ \delta =( \Delta +\sqrt{ \Delta })/2$. %
By Definition~\ref{def:order}, an order of a quadratic field $K$ is a
subring of $K$ that is a $ \Z $-module of rank $2$. %
The ring of integers $\O_K$ of $K$ fits the bill: it always has
$(1, \delta )$ as \emph{integral basis}, i.e., as a set of $ \Z $-module
generators. %
Furthermore, it is easy to prove that any other order is contained in
$\O_K$; for this reason we will some times call it the \emph{maximal
	order} of $K$. %
More precisely, we can prove the following.

\begin{prop}
	Let $K$ be a quadratic number field, and let $\O_K$ be its ring of
	integers. %
	Any order $\O \subseteq K$ can be written as $\O= \Z +f\O_K$ for an integer $f$,
	called the \emph{conductor} of $\O$. %
	If $ \Delta _K$ is the discriminant of $K$, the \emph{discriminant} of $\O$
	is $f^2 \Delta _K$.
	If $\O,\O'$ are two orders of discriminants $ \Delta , \Delta '$, then $\O \subseteq \O'$ if
	and only if $ \Delta '| \Delta $.
\end{prop}

It can be shown that the integer $f$ in the previous theorem, that is the conductor of the order $\O=\Z+f\O_K$, is equal to the index $[\O_K:\O]$, which is necessarily finite.
\\
\\
When $K$ is imaginary quadratic, any order $\O \subseteq K \subseteq  \C $ is a complex
lattice by definition. %
We now define a broader class of algebraic lattices.

\begin{defin}[Fractional ideal]
	Let $\O$ be an order in a number field $K$. A \emph{fractional ideal} of
	$\O$ (equivalentely, an $\O$-fractional ideal) is a non-zero subgroup $I \subseteq K$ such that
	\begin{itemize}
		\item $xI \subseteq I$ for all $x \in \O$.
		\item there exists a non-zero $x \in \O$ such that $xI \subseteq \O$.
	\end{itemize}
	If $\a$ is generated by a single element, then it is called
	\emph{principal}. %
	If $\a \subseteq \O$, then it is called an \emph{integral} ideal.
	The norm of an $\O$-ideal  $\a \subseteq \O$ is defined as $N(\a) = \mid\O/\a\mid$.
\end{defin}

Note that the ideals of $\O$ are exactly the fractional ideals contained in $\O$; since we usually use fractional ideals in this discussion, we will often refer to these objects simply as ideals (or, of course, fractional ideals), and we will use the name integral ideal for ordinary ones.

\begin{example}
	A basic exampe of fractional ideal we can take $K := \Q(\sqrt{-1})$ and $\O := \langle 1,2i \rangle$ over $\Q$. We then define $I := \{ \frac{x}{2i} \; \vert \; x \in \O \}$.
	It is immediate to verify that $xI \subseteq I$ for all $x \in \O$ and $2i \cdot I \subseteq \O$, so that the request of Definition [?] are satisfied and $I$ is a fractional ideal.
\end{example}

We define the product of two fractional ideal $\a,\b$ as
$$\a\b := \{xy \mid x \in \a, y \in \b\}$$

\begin{defin}[Invertible fractional ideal]
	An $\O$-ideal $\a$ is \emph{invertible} if there exists another
	ideal $\a^{-1}$ such that $\a\a^{-1}=\a^{-1}\a=\O$. %
\end{defin}

Invertible ideals form an Abelian group, written multiplicatively, under the operation defined above, where $\O$ is the neutral element. It is immediate to verify that principal ideals form a subgroup of it. Furthermore, if $\O$ is the maximal order of $K$, it is possible to prove that any $\O$-ideal is invertible.

\begin{example}
	Given a field $\mathbb{K}$, we consider two elliptic curves $E_1,E_2$ with complex multiplication.
	We can imagine these curves as complex tori $\Lambda_1,\Lambda_2$.
	The respective endomorphism rings will therefore be isomorphic to
	\begin{align*}
		\O_{\Lambda_1} := \{ \alpha \in \mathbb{K} \;\mid\;  \alpha  \Lambda_1   \subseteq   \Lambda_1  \} \\
		\O_{\Lambda_2} := \{  \alpha   \in  \mathbb{K} \;\mid\;  \alpha  \Lambda_2   \subseteq   \Lambda_2  \}
	\end{align*}
	We now assume that $\Lambda_1$ and $\Lambda_2$ are homothetic lattices, i.e. there exists $\alpha \in \mathbb{K}$ such that $\Lambda_1 = \alpha \Lambda'_2$. Observe that they define isomorphic elliptic curves, and so the same order:
	\begin{align*}
		\O_{\Lambda_1} & = \{  \beta   \in  K \;\mid\;  \beta  \Lambda_1   \subseteq   \Lambda_1  \}                   \\
		               & = \{  \beta   \in  K \;\mid\;  \beta \alpha  \Lambda_2   \subseteq \alpha  \Lambda_2  \}      \\
		               & = \{  \beta   \in  K \;\mid\;  \alpha^{-1} \beta \alpha  \Lambda_2   \subseteq  \Lambda_2  \} \\
		               & = \{  \gamma   \in  K \;\mid\;  \gamma  \Lambda_2   \subseteq   \Lambda_2  \}                 \\
		               & = \O_{\Lambda'}
	\end{align*}

	Because homothetic lattices give rise to isomorphic curves, fractional
	ideals $\a$ and $c\a$ (which are lattices) will be associated to isomorphic curves $E_\a$
	and $E_{c\a}$ as long as $c \neq 0$. %
	This justifies looking at fractional ideals modulo principal ideals.
\end{example}


\begin{defin}[Ideal class group]
	Let $\O$ be an order of a number field $K$. %
	Let $\mathcal{I}(\O)$ be the group of invertible fractional
	$\O$-ideals, and let $\mathcal{P}(\O)$ be the group of principal
	ideals. %
	The \emph{ideal class group} of $\O$ is the quotient group
	\[\Cl(\O) = \mathcal{I}(\O)/\mathcal{P}(\O).\]
	Its order is called the \emph{class
		number} of $\O$, and denoted by $h(\O)$.
	When $\O$ is the maximal order, $\Cl(\O)$ is also called the class
	group of $K$. %
\end{defin}

It is well known that the class group is a finite abelian group, so that its order is finite. What is relevant to us is that each element of $\Cl(\O)$ acts on $\Ell(\O)$ in a very particular way, as shown in the following.


\begin{defin}[$\a$-torsion]
	Let $E$ be an elliptic curve defined over a finite field $\F_q$. %
	Let $\O$ be the endomorphism ring of $E$, and let $\a \subseteq \O$
	be an integral invertible ideal of norm coprime to $q$. %
	We define the \emph{$\a$-torsion subgroup} of $E$ as
	\[E[\a] = \{P \in E \;|\; \alpha(P) = 0 \text{ for all } \alpha \in \a\}.\] %
\end{defin}

Given an ideal $\a \subseteq \O$ as above, it is natural to define the
(separable) isogeny $\varphi_{\a}:E\to E_{\a}$, where $E_{\a}=E/E[\a]$ %
This definition can be readily extended to inseparable isogenies. %
The following theorem points out some important results about relation between the ideal class group and the set of elliptic curves with complex multiplication by a fixed order.

\begin{teo}
	Let $\F_q$ be a finite field, and let $\O \subseteq \Q [\sqrt{-D}]$ be an order
	in a quadratic imaginary field. %
	Denote by $\Ell_q(\O)$ the set of elliptic curves defined over
	$\F_q$ with complex multiplication by $\O$.
	Assume that $\Ell_q(\O)$ is non-empty, then the class group
	$\Cl(\O)$ acts \emph{freely} and \emph{transitively} on it; i.e.,
	there is a map
	\begin{align*}
		\Cl(\O) \times \Ell_q(\O) & \to \Ell_q(\O)     \\
		(\a,E)                    & \mapsto \a \cdot E
	\end{align*}
	such that $\a \cdot (\mathfrak{b} \cdot E)=(\a\mathfrak{b}) \cdot E$ for all
	$\a,\mathfrak{b} \in \Cl(\O)$ and $E \in \Ell_q(\O)$, and such that for any
	$E,E' \in \Ell_q(\O)$ there is a unique $\a \cdot \Cl(\O)$ such that
	$E'=\a \cdot E$. %
\end{teo}

Said otherwise, since $\a$ is invertible, $\End(E) \cong \End(E_\a) \cong \O$,
$E_\a$ only depends on the class of $\a$ in $\Cl(\O)$, and
the map $(\a,E)\mapsto E_\a$ defines a group action of $\Cl(\O)$ on
the set of elliptic curves with complex multiplication by $\O$,
\\
\\
A set that is acted upon freely and transitively by a group $G$, is
also called a \emph{principal homogeneous space} or a \emph{torsor}
for $G$. %
An immediate consequence of the theorem above is that that, for any fixed base point $E{\in}\Ell_q(\O)$,
there is a bijection
\[
	\begin{aligned}
		\Cl(\O)                  & \longrightarrow \Ell_q(\O)                         \\
		\text{Ideal class of }\a & \longmapsto \text{Isomorphism class of }\a\cdot E.
	\end{aligned}
\]
and so the torsor $\Ell_q(\O)$ has cardinality equal to the class number $h(\O)$. %



\section{Quaternionic Multiplication}
In this thesis we will always deal with elliptic curves define over $\F_p$ or $\F_{p^2}$: it is a well known result in literature that every supersingular elliptic curve defined over $\overline{\F}_p$ is isomorphic to one defined over $\F_{p^2}$.
When $E$ is defined over $\F_p$ we fall in case (4) of the previous Proposition, and $\End_{\F_p}(E)$, the ring of $\F_p$-rational endomorphisms, is isomorphic to an order in $\Q(\sqrt{-p})$.
When $E$ is defined over $\F_{p^2}$, however,  $t \in \{0, \pm p, \pm 2p \}$. The cases $t \in \{0, \pm p\}$ only happen for a very limited number of curves with $j$-invariant $0$ or $1728$; we are thus mostly interested in case (1) of Prop. [?], where
$t = \pm 2p$, i.e., $\pi = \pm p$. In this case the full endomorphism ring $\End(E)$ (i.e., not restricted to $\F_p$-rational endomorphisms) is isomorphic to a maximal order the quaternion algebra $B_{p,\infty}$ ramified at $p$ and at infinity.

\begin{example}
	The elliptic curve $y^2=x^3+x$ has supersingular reduction at all
	primes $p=3\bmod 4$. %
	Its ring of $\F_p$-rational endomorphisms is generated by
	${\pi}=\sqrt{-p}$, and it is not maximal in ${\Q}(\sqrt{-p})$.
	The automorphism $\iota: (x,y) \mapsto (-x,iy)$ is only defined over $\F_{p^2}$,
	and does not commute with ${\pi}$. %
	The full endomorphism ring is isomorphic to the order generated by
	${\pi}$ and $ \iota $ inside the quaternion algebra $B_{p, \infty }$.
\end{example}

Let us first consider curves over $\F_{p^2}$.
The following discussion is not necessary for CSIDH to work, in fact the protocol just make use of supersingular curves for which the endomorphism ring is isomorphic to an order in an imaginary quadratic field. We will however briefly exaplain the theory of quaternionic multiplication, since it forms the basis of another important isogeny-based protocol, SIDH.
\\
\\
Given a maximal order $ \O $ in a quaternion algebra,
we would like to study the set of supersingular elliptic curves $ \Ell(\O)$. As before, we introduce the (left) class set $ \Cl(\O) $, and we show that the two sets are in one-to-one relation:
$$
	\Ell(\O)
	\stackrel{\mathrm{1:1}}{\longleftrightarrow}
	\Cl(\O)
$$
%For most of them, indeed, the Frobenius endomorphism acts like an element of ${\Z}$, instead of acting like a "complex multiplier". %
% Theorem [?], which defines the structure of the endomorphism ring of a given elliptic curve, works under the assumption that these maps are defined over a field of the form $\overline{\F}_p$. However, we will see later that if we change the definition field of these endomorphisms, we obtain a very particular result.

%In any case, recalling Theorem [?], given a supersingular curve $E$ the \emph{full} endomorphism ring $\End(E)$ (i.e., not restricted to $\F_p$-rational endomorphisms) is isomorphic to a maximal order the quaternion algebra $B_{p,\infty}$ ramified at $p$ and at infinity. %

Like the CM case, isogenies are in correspondence with (left) ideals
of $\O$. %
More precisely, let $\a \subseteq B_{p, \infty }$ a lattice,
the \emph{left order} of $\a$ is
the ring $\O(\a)=\{x{\in}B_{p, \infty } \mid x \a \subseteq \a\}$. %
Two lattices $\a,\frak b$ are said to be \emph{right isomorphic} if
$\a=\frak b x$ for some $x{\in}B_{p, \infty }$. %
If $\O \subseteq B_{p, \infty }$ is an order, $\a$ is called a \emph{left ideal} of $\O$ if
$\O \subseteq \O (\a)$; the \emph{left class set} $\Cl(\O)$ is the set of right
ideal classes of left ideals of $\O$. %
The order $\#\Cl(\O)$ only depends on the quaternion algebra, and is
called the \emph{class number} of $B_{p, \infty }$. %
Analogous definitions can be given by swapping left and right; we
refer to~\cite[Chapter~42]{Voight2018} for more properties and
definitions. %
Like in the CM case, the set $\Cl(\O)$ is in bijection with the vertex
set of a supersingular graph. %

\begin{teo}
	Let $B_{p, \infty }$ be the quaternion algebra ramified at $p$ and
	infinity, and consider a maximal order $\O\subseteq B_{p, \infty }$. Let $E_0/\F_{p^2}$ be a supersingular elliptic curve with
	$\End(E_0) \cong \O$. %
	\begin{enumerate}
		\item The number of isomorphism classes of supersingular elliptic
		      curves is equal to the class number of $B_{p, \infty }$.
		\item There is a one-to-one correspondence $\a \mapsto \a \cdot E_0$ between
		      $\Cl(\O)$ and the set of isomorphism classes of supersingular
		      elliptic curves, such that $\End(\a \cdot E_0)$ is isomorphic to the
		      right order of $\a$.
	\end{enumerate}
\end{teo}

%In the next section we will learn that this kind of supersingular isogeny graph has a unique connected component.
%Imponiamo ora delle limitazioni ulteriori al grafo considerando unicamente le curve e le isogenie su $\F_p$.
%When $E$ is defined over $\F_p$, e ci limitiamo a considerare gli endomorfismi definiti su questo campo,
%we can still use what we know about complex multiplication. %
%Indeed, these curves have trace $0$, and thus the Frobenius endomorphism has two distinct eigenvalue $\pm\sqrt{-p}$, and with this we can show that $\End_{\F_p}(E)$, the ring of $\F_p$-rational endomorphisms, is isomorphic to an order in ${\Q}(\sqrt{-p})$.
\section{Graphs}
In this section we will set out some elementary results regarding graph theory, with particular attention to those properties that are useful in cryptography.
In particular we focus on those graphs that have good pseudo-randomness properties, i.e. those graphs for which a sufficiently large random walk ends on each vertex with probability close to the uniform. We will describe these properties formally, and see how to deterministically construct graphs that satisfy this property.
The aim of this exposition is to provide the basis to fully understand the deeper theory behind isogeny graphs.
We first recall some basic concepts; for simplicity, we will
restrict to undirected graphs. %
In the following, given the considerable amount of notions and definitions necessary for the discussion, we prefer a less formal approach. We refer to [?] for further details.
\\
\\
An undirected graph $G$ is a pair $(V,E)$ where $V$ is a finite set of
\emph{vertices} and $E \subseteq V \times V$ is a set of unordered pairs called
\emph{edges}. %
Two vertices $v,v'$ are said to be \emph{connected by an edge} if
$\{v,v'\} \in E$. %
The \emph{neighbors} of a vertex $v$ are the vertices of $V$ connected
to it by an edge. %
A \emph{path} between two vertices $v,v'$ is a sequence of vertices
$$v\to v_1\to\cdots\to v'$$ such that each vertex is connected to the
next by an edge. %
The \emph{distance} between two vertices is the length of the shortest
path between them; if there is no such path, the vertices are said to
be at infinite distance. %
A graph is called \emph{connected} if any two vertices have a path
connecting them; it is called \emph{disconnected} otherwise. %
The \emph{diameter} of a connected graph is the largest of all
distances between its vertices. %
The \emph{degree} of a vertex is the number of edges pointing to (or
from) it; a graph where every edge has degree $k$ is called
\emph{$k$-regular}. %
The \emph{adjacency matrix} of a graph $G$ with vertex set
$V=\{v_1,\dots,v_n\}$ and edge set $E$, is the $n \times n$ matrix where the
$(i,j)$-th entry is $1$ if there is an edge between $v_i$ and $v_j$,
and $0$ otherwise. %

Because our graphs are undirected, the adjacency matrix is symmetric,
thus it has $n$ real eigenvalues
\[\lambda_1 \geq \cdots \geq \lambda_n.\]
and, if the graph is $k$-regular, it can be proven
that $k={\lambda}_1 \geq{\lambda}_n \geq-k$. %
Because of this equality, ${\lambda}_1$ is called the \emph{trivial
	eigenvalue}. %
An \emph{expander graph} is a $k$-regular graph such that its
non-trivial eigenvalues are bounded away, in absolute value,
in a way we'll see soon.
The random-like properties of graphs are typically expressed
in terms of \emph{expansion}. %
We recall here some basic facts about expanders; for an in depth
review, see~\cite{Goldreich2011,tao2011expander}.

\begin{defin}[Expander graph]
	Let $\varepsilon >0$ and $k \geq 1$. A $k$-regular graph is called a (one-sided)
	\emph{$\varepsilon $-expander} if
	\[{\lambda}_2 \leq  (1-\varepsilon )k;\]
	and a \emph{two-sided $\varepsilon $-expander} if it also satisfies
	\[{\lambda}_n \geq-(1-\varepsilon )k.\] %
	A sequence $G_i=(V_i,E_i)$ of $k$-regular graphs with $\#V_i{\rightarrow} \infty $ is
	said to be a one-sided (resp. two-sided) \emph{expander family} if
	there is an $\varepsilon >0$ such that $G_i$ is a one-sided (resp. two-sided)
	$\varepsilon $-expander for all sufficiently large $i$.
\end{defin}

\begin{teo}
	For  any  infinite  family  of $k$-regular  graphs  on $n$ nodes,  denoted $\{G_n\}_n$,  we  have
	\[ \lambda (G_n) := \max(|{\lambda}_2|,|{\lambda}_n|)  \geq 2\sqrt{k-1} - o(1)\]
	where the last term is some number that goes to zero as $n$ gets large.
\end{teo}
\begin{proof}
	See [?]
\end{proof}

\begin{defin}[Ramanujan graph]
	A graph such that $|{\lambda}_j| \leq  2\sqrt{k-1}$ for any ${\lambda}_j$ except ${\lambda}_1$ is
	called a \emph{Ramanujan graph}.
\end{defin}

Ramanujan graphs as expander graphs: The constant $2\sqrt{k-1}$ in the definition of Ramanujan graphs is the best possible constant for each $k$ and for large graphs: thanks to Theorem [?], for every $k$ and $\epsilon > 0$, there exists $n$ such that all $k$-regular graphs $G$ with at least $n$ vertices satisfy ${\displaystyle \lambda (G)>2{\sqrt {k-1}}-\epsilon }$. This means that Ramanujan graphs are essentially the best possible expander graphs. This type of graphs naturally arise in isogeny graphs of supersingular elliptic curves\footnote{They play a fundamental role in the SIDH protocol.}.
\\
\\
\emph{Edge expansion} quantifies how well subsets of vertices are
connected to the whole graph, or, said otherwise, how far the graph is
from being disconnected.

\begin{defin}[Edge expansion]
	Let $F\subseteq V$ be a subset of the vertices of $G$. %
	The \emph{boundary of $F$}, denoted by $ \partial F\subseteq E$, is the subset of the
	edges of $G$ that go from $F$ to $V\setminus F$. %
	The \emph{edge expansion ratio} of $G$, denoted by $h(G)$ is the
	quantity
	\[h(G) = \min_{\substack{F\subseteq V,\\ \#F \leq  \#V/2}}\frac{\# \partial F}{\#F}.\]
\end{defin}

Note that $h(G)=0$ if and only if $G$ is disconnected. %
Edge expansion is strongly tied to expander graphs, as the
following theorem shows.

\begin{teo}[Discrete Cheeger inequality]
	Let $G$ be a $k$-regular one-sided $\varepsilon $-expander, then
	\[\frac{\varepsilon }{2}k \leq  h(G) \leq  \sqrt{2\varepsilon }k.\]
\end{teo}
\begin{proof}
	See ???
\end{proof}

Expander families of graphs have many applications in theoretical
computer science, thanks to their \emph{pseudo-randomness} properties:
they are useful to construct \emph{pseudo-random number generators},
\emph{error-correcting codes}, \emph{probabilistic checkable proofs},
and, most interesting to us, \emph{cryptographic primitives}. %
Qualitatively, we can describe them as having \emph{short diameter}
and \emph{rapidly mixing walks}.
Another reason for which these graphs are important in cryptography is that finding paths in these graphs, i.e. routing, is hard: there are no known subexponential algorithms to solve this problem, either classically or on a quantum computer.

\begin{prop}
	Let $G$ be a $k$-regular one sided $\varepsilon $-expander. %
	For any vertex $v$ and any radius $r>0$, let $B(v,r)$ be the
	\emph{ball} of vertices at distance at most $r$ from $v$. %
	Then, there is a constant $c>0$, depending only on $k$ and $\varepsilon $, such
	that
	\[\#B(v,r) \geq\ (1+c)^r\]
\end{prop}
\begin{proof}
	See ???
\end{proof}
In particular, this shows that the diameter of an expander is bounded
by $O(\log n)$, where $n := \#G$, indeed
if we consider $\#B(v,\log n)$, the number of nodes reacheable from $v$ in $\log n$ steps,
we have that this number is greater than $(1+c)^{\log n} \in O(n)$, so
we are able to reach each node of $G$.
A \emph{random walk} of length $i$ is a path $v_1\to\cdots\to v_i$,
defined by the random process that selects $v_i$ uniformly at random
among the neighbors of $v_{i-1}$. %
Loosely speaking, the next proposition says that, in an expander
graph, random walks of length close to its diameter terminate on any
vertex with probability close to uniform. %

\begin{prop}[Mixing theorem~(\cite{jao+miller+venkatesan09})]
	Let $G=(V,E)$ be a $k$-regular two-sided $\varepsilon $-expander. %
	Let $F\subseteq V$ be any subset of the vertices of $G$, and let $v$ be any
	vertex in $V$. %
	Then a random walk of length at least
	\[\frac{\log(\#F^{1/2}/(2\#V))}{\log(1-\varepsilon )}\] %
	starting from $v$ will land in $F$ with probability at least
	$\#F/(2\#V)$.
\end{prop}
\begin{proof}
	See [?].
\end{proof}

The walk length in the mixing theorem is also called the \emph{mixing length} of the expander graph. %
Random regular graphs typically make good expanders, but only a
handful of deterministic constructions is known, most of them based on Cayley and Schreirer graphs~\cite{LubPS,chung1989diameters,Goldreich2011}, which we are going to define in the following.%

\begin{defin}[Cayley graph]
	\label{def:cayley}
	Let $G$ be a group and $S \subseteq G$ be a symmetric subset,
	i.e. one not containing $1$ and closed under inversion. %
	The \emph{Cayley graph} of $(G,S)$ is the undirected graph whose
	vertices are the elements of $G$, and such that there is an edge
	between $g$ and $sg$ if and only if $s{\in}S$. %
\end{defin}

An immediate generalization of Cayley graphs are Shreirer graphs, where the standard multiplication between elements of the same group is replaced by the action of a group $G$ on a given set $X$, as the following definition shows:

\begin{defin}[Schreier graph]
	Let $G$ be a group \emph{acting freely} on a set $X$, in the sense
	that there is a map
	\begin{align*}
		G \times X   & \to X                    \\
		( \sigma ,x) & \mapsto  \sigma  \cdot x
	\end{align*}
	such that $ \sigma  \cdot x=x$ if and only if $ \sigma =1$, and $ \sigma  \cdot ( \tau   \cdot x)=( \sigma  \tau  ) \cdot x$, for
	all $ \sigma , \tau   \in G$ and $x \in X$. %
	Let $S \subseteq  G$ be a \emph{symmetric} subset.
	The \emph{Schreier graph} of $(S,X)$ is the graph which vertices are
	the elements of $X$, and such that $x,x' \in X$ are connected by an edge
	if and only if $ \sigma  \cdot x=x'$ for some $ \sigma  \in S$.
\end{defin}

\begin{figure}[!h]
	\centering
	\begin{tikzpicture}[scale=1]
		\begin{scope}
			\def\crater{12}
			\def\jumpa{-8}
			\def\jumpb{9}
			\def\diam{2.5cm}

			\foreach \i in {1,...,\crater} {
					\draw[black, dashed] (360/\crater*\i : \diam) to[bend right] (360/\crater*\i+360/\crater : \diam);
					\draw[black] (360/\crater*\i : \diam) to[bend right] (360/\crater*\i+\jumpa*360/\crater : \diam);
					\draw[black, dotted] (360/\crater*\i : \diam) to[bend right=50] (360/\crater*\i+\jumpb*360/\crater : \diam);
				}
			\foreach \i in {1,...,\crater} {
					\pgfmathparse{int(mod(2^\i,13))}
					\let\exp\pgfmathresult
					\draw[fill] (360/\crater*\i: \diam) circle (2pt) +(360/\crater*\i: 0.4) node{$g^{\exp}$};
				}
		\end{scope}
		\begin{scope}[xshift=4cm,yshift=1cm]
			\draw[black, dashed] (0,0) -- (0.5,0) (0.5,0) node[black,anchor=west] {$x \mapsto x^{2}$};
			\draw[black] (0,-1) -- (0.5,-1) (0.5,-1) node[black,anchor=west] {$x \mapsto x^{3}$};
			\draw[black, dotted] (0,-2) -- (0.5,-2) (0.5,-2) node[black,anchor=west] {$x \mapsto x^{5}$};
		\end{scope}
	\end{tikzpicture}
	\caption{Schreier graph of $(\{2,3,5,2^{-1},3^{-1},5^{-1}\},\Z_{13}^{\times}$).}
	\label{fig:schreier}
\end{figure}

Because of the constraints on the group action and the set $S$,
Schreier graphs are undirected and regular, and they usually make good
expanders. Note that Cayley graphs are the Schreier graphs of the (left) action
of a group on itself.

\begin{example}
	As an example, take as a set a cyclic group $G$ of order $n$, then the group $( \Z /n \Z )^{ \times }$
	acts naturally on $G$ by the law $ \sigma  \cdot g=g^ \sigma $ for any $g \in G$ and
	$ \sigma  \in ( \Z /n \Z )^{ \times }$. %
	This action is not free on $G$, but it is so on the subset $P$ of all
	generators of $G$; we can thus build the Schreier graph $(S,P)$, where
	$S$ is a symmetric subset that generates $( \Z /n \Z )^{ \times }$.
	An example of such graph for the case $n=13$ is shown in
	Figure~\ref{fig:schreier}, where the set $S \subseteq  ( \Z /13 \Z )^{ \times }$ has been
	chosen to contain $2,3,5$ and their inverses.

\end{example}

\section{$\l$-Isogeny Graphs}
This is a key section: here we combine the theory of elliptic curves and the graphs theory.
We will show how it is possible to construct a graph whose vertices are isomorphism classes of elliptic curves and whose
edges represent set of isogenies defined between these curves.
We are interesting to graphs in which both elliptic curves and isogenies between them are defined over a field $\F_p$.
In this graph we will observe that some connected components admit a subgraph isomorphic to a Cayley graph.
We will study these components in order to define a cryptographic protocol above.
We proceed in order with the discussion, starting from the basic definitions.

\begin{defin}[Isogeny graph]
	Let $L$ be a non-empty set of
	small primes $L$. Let $\mathbb{K}$ be a field. An isogeny
	graph $X(\mathbb{K}, L)$ is a directed graph where its vertices are $\mathbb{K}$-isomorphism classes
	of supersingular elliptic curves over $\mathbb{K}$ and its edges are equivalence classes of
	$\l$-isogenies defined over $\mathbb{K}$ between such curves for $l \in L$. (Two isogenies are
	equivalent if they have the same kernel.) If we only consider $L = \{\l\}$, we write
	$X(\mathbb{K}, \l)$, In this case we say that this is an $\l$-isogeny graph and that two curves are $\l$-isogenous.
\end{defin}

\begin{oss}
	Usually vertices are represented by $j$-invariants, but
	this choice is appropriate only if we are considering regular curves: an ordinary
	elliptic curve over $\F_p$ is never isogenous to its non-trivial quadratic
	twist since they have a different number of $F_p$-rational points, so we never have to
	care about twists when considering isogenies between ordinary elliptic curves over
	$\F_p$ . If the curves are supersingular though, this is not the case.
	Let $p > 3$. A supersingular elliptic curve over $\F_p$ has $p + 1$ points and so all
	quadratic twists have the same number of points. Thus the twists are isogenous but
	lie in different $\F_p$-isomorphism classes. Therefore it is not very precise to represent
	the vertices in the supersingular isogeny graph over $\F_p$ with $j$-invariants, since then
	the different isomorphism classes would collapse to only one vertex and the picture of in-
	and outgoing isogenies would be distorted. So if we want to differentiate between twists,
	we have to store more information than just the $j$-invariants of the elliptic curves.
\end{oss}

\begin{oss}
	A priori an isogeny graph is a directed graph, but given two elliptic curves $E_1$
	and $E_2$ whose $j$-invariants are not in $\{0, 1728\}$, there are exactly as many edges
	$(E_2 , E_1 )$ as $(E_1 , E_2 )$, obtained by taking dual isogenies. Annoyingly, the nodes
	with $j$-invariants $0$ and $1728$ are more complicated, since these are exactly the
	curves with extra automorphisms: an elliptic curve $E$ has fewer incoming
	than outgoing edges if and only if either
	$j(E)=0$ and $\sqrt{-3} \in \mathbb{K}$, or if $j(E) = 1728$ and $-1 \in \mathbb{K}$.
	Throughout this discussion, we will assume for simplicity that $\sqrt{-1},\sqrt{-3} \notin \mathbb{K}$,
	so that neither of these automorphisms are defined over $\mathbb{K}$ and
	we may view the graph as an undirected graph. In the case of a finite prime field
	$\mathbb{K}$ = $\F_p$ , it suffices to restrict to $p \equiv 11 \pmod{12}$,
	which will be satisfied in the CSIDH parameters choice.
\end{oss}


With these premises, isogeny graphs are usually drawn undirected. %
\\
\\
Traditionally, for regular curves we study the graph whose isogenies are defined on the same field $ \F_q $ of the curves, while for the supersingular ones we study the graph whose isogenies are defined on the algebraic closure $ \overline{\F}_q $.
We will follow this approach, but since we are interested in graphs in which curves and isogenies are defined over $\F_p$,
we will have to do some additional work on the supersingular isogeny graph.
\\
\\
Observe that, depending on the constraints we put, we will get graphs with different structures.
The most important ones will be \emph{isogeny volcanoes}, \emph{Cayley graphs}, and \emph{supersingular graphs}.
The constraints that are usually imposed are the definition field of the curve ($\C$ or $\F_p$),
the definition field of isogenies, in the case we are working in a finite field,
or the degree $ \l $ of the isogenies to which we want to restrict.
We will focus our attention on isogenies of fixed degree $ \l $,
distinguishing the case in which the curves are defined on the complex field or on a finite field $ \F_q $.
In the latter case, we will treat the ordinary and supersingular curves separately.
For each case we will answer the most natural questions about it:
given a curve $ E $ we will show how many isogenies of degree $ \l $ admit $ E $ as a domain,
what is the global structure of the graph,
how many are the connected components,
and if they share the same structure.


\subsection{Complex Case}
The first case we deal with is those of curves defined on the complex field.
Let us start from the local structure: given an elliptic curve $E$ and a prime $\l$, how many isogenies of degree $\l$ have $E$ as domain? %
Thanks to Proposition~\ref{prop:isoker}, we know this is equivalent to
ask how many subgroups of order $\l$ the curve has; but then we immediately know there are exactly $\l+1$ isogenies whenever $\l \neq p$.
For example, let us consider a curve $E/\C$ \emph{without}
complex multiplication, i.e., such that $\End(E)=\Z$.  %
Its $\l$-isogeny graph, i.e., the connected component of the graph of
$\l$-isogenies containing $E$, is $(\l+1)$-regular, and cannot have
loops, otherwise that would provide a non-trivial endomorphism of $E$ of degree a power of $\l$.
Hence, the $\l$-isogeny graph of $E$ is an infinite $(\l+1)$-tree, as
pictured in Figure~\ref{fig:infinite-tree}. %

\begin{figure}[!h]
	\centering
	\begin{tikzpicture}[scale=0.5]
		\def\levels{6}
		\draw[fill] (0:0) circle (2pt);
		\foreach \i in {1,...,\levels} {
				\pgfmathparse{3*2^\i}
				\let\nodes\pgfmathresult
				\foreach \j in {1,3,...,\nodes} {
						\pgfmathparse{\j + (-1)^div(\j,2)}
						\let\lower\pgfmathresult
						\ifthenelse{\i = \levels}{
							\draw[dotted] (360/\nodes*\j : \i) --
							(360/\nodes*\lower : \i - 1);
						}{
							\draw[fill] (360/\nodes*\j : \i) circle (2pt) --
							(360/\nodes*\lower : \i - 1);
						}
					}
			}
	\end{tikzpicture}

	\caption{Infinite $2$-isogeny graph of elliptic curves without
		complex multiplication.}
	\label{fig:infinite-tree}
\end{figure}

\subsection{Ordinary Case}
Exaclty as in the complex case, and for the same reason,
there are $\l+1$ isogenies defined over $\overline{\F}_q$ with domain $E$,
whenever $\l \neq p$.
However, when we think about curves over finite fields, some
isogenies may only be defined on the algebraic closure $\overline{\F}_q$, and we would
like to restrict our graphs to those isogenies that are defined over $\F_q$. %
The Frobenius morphism is a very useful tool in this search.
Formally, the following result holds:
\begin{prop}
	Let $\varphi:E(\overline{\mathbb{K}}) \rightarrow E/G(\overline{\mathbb{K}})$ be an isogeny. Then $\varphi$ is $\F_q$-rational if and only if $\pi(G)=G$.
\end{prop}
Since we are considering separable isogenies of degree $ \l $, also the kernel of the map, that is the subgroup $ G $ will have order $ \l $,
from which it immediately follows $G \subseteq E[\l]$.
In order to computer for how many subgroups $G \subseteq E[\l]$ of order $\l$ we have $\pi(G)=G$,
we restrict the domain of the Frobenius to $E[\l]$.
Since $E[\l] \cong \Z_{\l} \times \Z_{\l}$ we can imagine $\pi$ as an element of $GL_2(\F_{\l})$, up to conjugation.
Since all subgroups of $E[\l]$ are cyclic, in particular our subgroups $G$ will be of the form $G = \langle v \rangle$,
for some $v \in E[\l]$ of order $\l$. Note that every non zero element of $E[\l]$ has order $\l$.
So let us look for how many elements $v \in E[\l]$ we have $\pi(v)=\lambda \cdot v$.
In this way $G := \langle v \rangle$ define an isogeny over $\F_q$ with domain $E$.
To answer this question it is sufficient to diagonalize the Frobenius matrix.
We thus are in one of the following four cases:
\begin{itemize}
	\item $\pi$ is not diagonalizable in $\F_{\l}$, then $E$ has no
	      $\l$-isogenies.
	\item $\pi$ has one eigenvalue of (geometric) multiplicity one,
	      i.e., it is conjugate to a non-diagonal matrix
	      $\mat{\lambda &*\\0& \lambda}$; then
	      $E$ has one $\l$-isogeny.
	\item $\pi$ has one eigenvalue of multiplicity two, i.e., it acts
	      like a scalar matrix
	      $\mat{\lambda &0\\0& \lambda}$; then
	      $E$ has $\l+1$ isogenies of degree $\l$.
	\item $\pi$ has two distinct eigenvalues, i.e., it is conjugate to
	      a diagonal matrix
	      $\mat{\lambda &0\\0& \mu}$ with
	      $\lambda\neq\mu$; then $E$ has two $\ell$-isogenies.
\end{itemize}

Naturally, the number of eigenvalues of $\pi$ depends on the
factorization of its characteristic polynomial $x^2-tx+q$ over $\F_{\l}$,
or equivalently on whether $\Delta_\pi=t^2-4q$ is a square modulo $\l$. %
We can sum up the results found in the following proposition.

\begin{prop}
	\label{th:isog-count}
	Let $E:y^2=x^3+ax+b$ be an elliptic curve defined over a finite
	field $\mathbb{K}$ of characteristic $p$, and let $\l \neq p$ be a prime.
	\begin{enumerate}
		\item There are $\l+1$ distinct isogenies of degree $\l$ with domain
		      $E$ defined over the algebraic closure $\bar{\mathbb{K}}$.
		\item There are $0,1,2$ or $\l+1$ isogenies of degree $\l$ with domain
		      $E$ defined over $\mathbb{K}$.
	\end{enumerate}
\end{prop}

In this way we manage to answer the first question we asked ourselves,
namely how many isogenies defined over $ \F_q $ have $ E $ as a domain.
But what about the global structure? %
Any curve $E/\F_q$ can be seen as the reduction modulo $p$ of some
curve $E/\bar{\C}$; thus it must inherit the connectivity structure of
the isogeny graph of $E/\bar{\C}$. %
However, there is only a finite number of curves defined over $\F_q$,
and not all isogenies will be $\F_q$-rational. %
Thus, the infinite tree must somehow ``fold'' or ``be pruned'' to
fit inside $\F_q$. %
Let $E/\F_q$ have complex multiplication by an order $\O$ in a number
field $K=\Q(\pi)$. %
Write $\O_K$ for the maximal order of $K$, then we know that
$\Z[\pi] \subseteq \O \subseteq \O_K$. %
We have already seen that two elliptic curves are isogenous if and
only if they have the same endomorphism algebra $K$; Kohel refined
this as follows.


\begin{prop}[Horizontal and vertical isogenies]
	Let $\varphi:E(\overline{\mathbb{K}}) \to E'(\overline{\mathbb{K}})$ be an isogeny of prime degree $\l$, and let $\O,\O'$
	be the orders corresponding to $E,E'$. %
	Then, either $\O \subseteq \O'$ or $\O' \subseteq \O$, and one of the following is true:
	\begin{itemize}
		\item $\O=\O'$, in this case $\varphi$ is said to \emph{horizontal}.
		\item $[\O':\O]=\l$, in this case $\varphi$ is said to be \emph{ascending}.
		\item $[\O:\O']=\l$, in this case $\varphi$ is said to be \emph{descending}.
	\end{itemize}
\end{prop}
\begin{proof}
	See~\cite[Prop.~21]{kohel}.
\end{proof}

This result introduces the concept of depth in isogeny graphs of regular curves.
To formalize it we introduce the following definition.

\begin{defin}[$p$-adic valuation]
	Let $p$ be a prime number, the \emph{$p$-adic order} or \emph{$p$-adic valuation} of a non-zero integer $n$ is the highest exponent $v$ such that ${\displaystyle p^{v }}$ divides $n$. The $p$-adic valuation of $0$ is defined to be infinity. The $p$-adic valuation is commonly denoted with $v_{p}(n)$.
\end{defin}

For a fixed prime $\l$, Kohel defines a curve $E$ to be \emph{at the surface}
if $v_{\l}([\O_K:\End(E)])=0$, where $v_{\l}$ is the $\l$-adic
valuation. %
$E$ is said to be \emph{at depth $d$} if $v_{\l}([\O_K:\End(E)])=d$; the
maximal depth being $d_{\max}=v_{\l}([\O_K:\Z[\pi]])$, curves at depth
$d_{\max}$ are said to be \emph{at the floor (of rationality)}, and
$d_{\max}$ is called the \emph{height} of the graph of $E$. %
In this view an $\l$-isogeny is said to be
\emph{horizontal} if it goes to a curve at the same depth,
\emph{descending} if it goes to a curve at greater depth,
\emph{ascending} if it goes to a curve at lesser depth. %
\\
\\
Observe that vertical isogenies can only exist for primes that divide
the conductor of $\Z[ \pi ]$, so the horizontal case is the generic one. %
But how many horizontal and vertical $\l$-isogenies does a given curve have?  %
To answer this question, let us first recall the Legendre symbol,
with which we will be able to state the proposition that answers our question.

\begin{defin}[Legendre symbol]
	Let $p$ be an odd prime number and $a$ be an integer.
	The \emph{Legendre symbol} is a function of $a$ and $p$ defined as
	$${\displaystyle \left({\frac {a}{p}}\right)\equiv a^{\frac {p-1}{2}}{\pmod {p}}\quad}$$
\end{defin}

An integer $a$ is a quadratic residue modulo $p$ if it is congruent
to a perfect square modulo $p$ and is a quadratic non residue modulo $p$ otherwise.
It is customary to refine the previous definition as follows.
$$
	{\displaystyle
	\left({\frac {a}{p}}\right)=
	{\begin{cases}
		1  & {\text{if }}a{\text{ is a quadratic residue modulo }}p{\text{ and }}a\not \equiv 0{\pmod {p}}, \\
		-1 & {\text{if }}a{\text{ is a non-quadratic residue modulo }}p,                                    \\
		0  & {\text{if }}a\equiv 0{\pmod {p}}.
	\end{cases}}}
$$

\begin{prop}
	Let $E$ be an elliptic curve over a finite field $\mathbb{K}$. %
	Let $\O$ be its endomorphism ring, $f$ its conductor, $D$ its
	discriminant, $ \pi $ the Frobenius endormphism, $f_ \pi $ the conductor of
	$ \Z [ \pi ]$. %
	Let $ \l $ be a prime different from the characteristic of $\mathbb{K}$, then
	the types of degree $ \l $ isogenies with domain $E$ are as follows:
	\begin{itemize}
		\item If $ \l |f$ and $ \l \nmid(f_ \pi /f)$, there is one ascending isogeny.
		\item If $ \l |f$ and $ \l |(f_ \pi /f)$, there is one ascending isogeny and
		      $ \l $ descending ones.
		\item If $ \l \nmid f$ and $ \l \nmid(f_ \pi /f)$, there are
		      $1+\left(\frac{D}{ \l }\right)$ horizontal isogenies, where
		      $\left(\frac{D}{ \l }\right)$ represents the Legendre symbol.
		\item If $ \l \nmid f$ and  $ \l |(f_ \pi /f)$ there are $1+\left(\frac{D}{ \l }\right)$
		      horizontal isogenies and $ \l -\left(\frac{D}{ \l }\right)$
		      descending isogenies.
	\end{itemize}
\end{prop}
\begin{proof}
	See~\cite[Prop.~21]{kohel}.
\end{proof}

We refer to the following table for a summary of the result obtained.
The third column describes the types of isogenies which can occur:
horizontal, ascending and descending, respectively.

\begin{table}[!h]
	\begin{center}
		\centering
		\def\arraystretch{1.3}
		\begin{tabular}{c | c | c c c}
			%\multicolumn{2}{c|}{} & \multicolumn{3}{c}{Isogeny types}\\
			\multicolumn{2}{c|}{}                 & $\rightarrow $                                        & $\uparrow$                 & $\downarrow$                                 \\[3px]
			\midrule
			$v_{\l}({\Delta}_{\pi}/{\Delta}_K)=0$ & ${\l}\nmid[\O_K:\O]] \land {\l}\nmid[\O:{\Z}[{\pi}]]$ & $1+\leg{{\Delta}_K}{{\l}}$ &              &                               \\
			\midrule
			                                      & ${\l}\nmid[\O_K:\O]] \land {\l}\mid[\O:{\Z}[{\pi}]]$  & $1+\leg{{\Delta}_K}{{\l}}$ &              & ${\l}-\leg{{\Delta}_K}{{\l}}$ \\
			$v_{\l}({\Delta}_{\pi}/{\Delta}_K)>1$ & ${\l}\mid[\O_K:\O]] \land {\l}\mid[\O:{\Z}[{\pi}]]$   &                            & $1$          & ${\l}$                        \\
			                                      & ${\l}\mid[\O_K:\O]] \land {\l}\nmid[\O:{\Z}[{\pi}]]$  &                            & $1$          &
		\end{tabular}
		\caption{Number and types of ${\l}$-isogenies}
		\label{tab:periodic-table}
	\end{center}
\end{table}

The table above summarizes Proposition [?] in much easier terms
and clarifies once and for all the structure of the isogeny graph
associated with a regular elliptic curve (more generally, with an elliptic curve with complex multiplication).
To explain that, let us distinguish the cases:

\begin{itemize}
	\item If $v_{\l}({\Delta}_{\pi}/{\Delta}_K)=0$
	      then, since $\Delta_{\pi} = f_{\pi}^2\Delta_K$, we have
	      \begin{align*}
		      v_{\l}({\Delta}_{\pi}/{\Delta}_K)=0 & \Longleftrightarrow v_{\l}(f_{\pi}^2 \Delta_K/{\Delta}_K)=0 \\
		                                          & \Longleftrightarrow v_{\l}(f_{\pi}^2)=0                     \\
		                                          & \Longleftrightarrow f_{\pi}^2=1                             \\
		                                          & \Longleftrightarrow \Z[\pi] = \O_K                          \\
	      \end{align*}
	      Given a quadratic field $ K $, we have already shown that $ \Z[\pi] \subseteq \End(E) \subseteq \O_K$,
	      so in this case every elliptic curve with $\End(E) \subseteq \O_K$ is forced to have $\End(E) \cong \O_K$,
	      and therefore there will be only horizontal isogenies.
	\item If $v_{\l}({\Delta}_{\pi}/{\Delta}_K) > 1$, or, equivalently, if  $\Z[\pi] \subsetneq \O_K$, there will also be vertical isogenies, in particular if $E$ is not at the floor, there are ${\l}+1$ isogenies of
	      degree ${\l}$ from~$E$, in total. If $E$ is at the floor, there are no descending ${\l}$-isogenies
	      from~$E$. If $E$ is at the surface, then there are
	      $\left(\frac{{\Delta}_K}{{\l}}\right)+1$~horizontal ${\l}$-isogenies from~$E$
	      (and no ascending ${\l}$-isogenies). If $E$ is not at the surface, there are no horizontal
	      ${\l}$-isogenies from~$E$, and one ascending ${\l}$-isogeny.
\end{itemize}

This theorem shows that, away from the surface, isogeny graphs just
look like ${\l}$-regular complete trees of bounded height, with ${\l}$
descending isogenies at every level except the floor. %

Putting the pieces together, we see that graphs of ordinary curves
have a very rigid structure: a cycle of horizontal isogenies
and a tree of descending isogenies of height
$v_{\l}(f_{\pi})$ (have a look at Figure~\ref{fig:volcano}).

\begin{figure}[!h]
	\centering
	\begin{tikzpicture}
		\begin{scope}[xshift=6cm]
			\def\crater{7}
			\foreach \i in {1,...,\crater} {
					\draw[fill] (360/\crater*\i:1cm) circle (5pt);
					\draw (360/\crater*\i : 1cm) -- (360/\crater*\i+360/\crater : 1cm);
					\foreach \j in {-1,1} {
							\draw[fill] (360/\crater*\i : 1cm) -- (360/\crater*\i + \j*360/\crater/4 : 2cm) circle (3pt);
							\foreach \k in {-1,0,1} {
									\draw[fill] (360/\crater*\i + \j*360/\crater/4 : 2cm) --
									(360/\crater*\i + + \j*360/\crater/4 + \k*360/\crater/6 : 2.5cm) circle (1pt);
								}
						}
				}
		\end{scope}
		\begin{scope}[xshift=12cm]
			\node at (0,2) {$\End(E)$};
			\draw[fill] (0,1) circle(5pt) node[xshift=0.7cm]{$\O_K$} --
			(0,0) circle(3pt) --
			(0,-1) circle(1pt) node[xshift=0.7cm]{$\Z[\pi]$};
		\end{scope}
	\end{tikzpicture}

	\caption{A volcano of $3$-isogenies (ordinary elliptic curves), and the corresponding tower of orders inside the
		endomorphism algebra.}
	\label{fig:volcano}
\end{figure}

The surface is the component of the graph that has a more varied structure:
\begin{itemize}
	\item[(0)] If $\leg{{\Delta}_K}{{\l}}=-1$, there are no horizontal isogenies:
	      the isogeny graph is just a complete tree of degree ${\l}+1$ (in the
	      graph theoretic sense) at each level but the last. %
	      We call this the \emph{Atkin case}.
	\item[(1)] If $\leg{{\Delta}_K}{{\l}}=0$, there is exactly one horizontal
	      isogeny ${\varphi}:E{\rightarrow}E'$ at the surface. %
	      Since $E'$ also has one horizontal isogeny, it necessarily is
	      $\hat{{\varphi}}$, so the surface only contains two elliptic curves, each
	      the root of a complete tree. %
	      We call this the \emph{ramified case}.
	\item[(2)] The case $\leg{{\Delta}_K}{{\l}}=1$ is arguably the most interesting one. %
	      Each curve at the surface has exactly two horizontal isogenies, thus
	      the subgraph made by curves on the surface is two-regular and finite, i.e., a cycle. %
	      Below each curve of the surface there are ${\l}-1$ curves, each the root of a complete tree. %
	      We call this the \emph{Elkies case}.
\end{itemize}

\begin{figure}[!h]
	\centering
	\begin{tikzpicture}
		\begin{scope}
			\draw[fill] (0,0) circle (2pt)
			-- (-1,-1) circle (2pt)
			(0,0) -- (0,-1) circle (2pt)
			(0,0) -- (1,-1) circle (2pt);
			\node at (0,-2) {Atkin: $\left(\frac{{\Delta}_K}{{\l}}\right) = -1$};
		\end{scope}

		\begin{scope}[xshift=3.5cm]
			\draw[fill] (0,0) circle (2pt)
			-- (-0.5,-1) circle (2pt)
			(0,0) -- (0.5,-1) circle (2pt)
			(0,0) -- (2,0) circle (2pt)
			-- (1.5,-1) circle (2pt)
			(2,0) -- (2.5,-1) circle (2pt);
			\node at (1,-2) {ramified: $\left(\frac{{\Delta}_K}{{\l}}\right) = 0$};
		\end{scope}

		\begin{scope}[xshift=9cm]
			\draw[fill] (-0.8,0) node[coordinate] (A) {} circle (2pt)
			-- +(0,-1) circle (2pt)
			(0,-0.3) node[coordinate] (B) {} circle (2pt)
			-- +(0,-1) circle (2pt)
			(0.8,0) node[coordinate] (C) {} circle (2pt)
			-- +(0,-1) circle (2pt);
			\draw[bend right=20]
			(A) edge (B)
			(B) edge (C)
			(C) edge[dashed,bend right=90] (A);
			\node at (0,-2) {Elkies: $\left(\frac{{\Delta}_K}{{\l}}\right) = +1$};
		\end{scope}
	\end{tikzpicture}
	\caption{The three shapes of volcanoes of $2$-isogenies of height 1.}
	\label{fig:volcanology}
\end{figure}

The three cases are summarized in Figure~\ref{fig:volcanology}. %
Their looks have justified the name \emph{isogeny volcanoes} for
them~\cite{fouquet+morain02}; in the Elkies case, we call
\emph{crater} the cycle at the surface.

%\newpage

We are left with one last question: how large are these graphs?
We know from the theory of complex multiplication  that there is a bijection
\[
	\begin{aligned}
		\Cl(\O)                  & \longrightarrow \Ell_q(\O)                         \\
		\text{Ideal class of }\a & \longmapsto \text{Isomorphism class of }\a\cdot E.
	\end{aligned}
\]

This confirms what we already knew, that $\#\Ell_q(\O)=h(\O)$, but
also lays the bases for showing the following proposition, which
answers our question on the size of ${\l}$-isogeny volcanoes.

\begin{prop}
	Let $\O$ be a quadratic imaginary order, and assume that
	$\Ell_q(\O)$ is non-empty. %
	Let ${\l}$ be a prime such that $\O$ is ${\l}$-maximal, i.e., such that
	${\l}$ does not divide the conductor of $\O$. %
	All ${\l}$-isogeny volcanoes of curves in $\Ell_q(\O)$ are
	isomorphic. %
	Furthermore, one of the following is true.
	\begin{enumerate}
		\item[(0)] If the ideal $({\l})$ is prime in $\O$, then there are
		      $h(\O)$ distinct ${\l}$-isogeny volcanoes of Atkin type, with surface
		      in $\Ell_q(\O)$.
		\item[(1)] If $({\l})$ is ramified in $\O$, i.e., if it decomposes as a
		      square $\frak l^2$, then there are $h(\O)/2$ distinct ${\l}$-isogeny
		      volcanoes of ramified type, with surface in $\Ell_q(\O)$.
		\item[(2)] If $({\l})$ splits as a product $\frak l \cdot \hat{\frak l}$ of
		      two distinct prime ideals, then there are $h(\O)/n$ distinct
		      ${\l}$-isogeny volcanoes of Elkies type, with craters in $\Ell_q(\O)$
		      of size $n$, where $n$ is the order of $\frak l$ in $\Cl(\O)$.
	\end{enumerate}
\end{prop}

But we can extract even more information from the group action. %
Note that $(\l)$ splits in $\O$ if and only if $\Delta$ is a non-zero square modulo $\l$.
This is equivalent to require that the Frobenius endomorphism splits modulo ${\l}$, i.e., that
\[{\pi}^2 - t{\pi} + q = ({\pi} - {\lambda})({\pi} - {\mu}) \mod\ell\] %
for two distinct eigenvalues ${\lambda},{\mu}$. %
It is immediate to verify that the eigenspaces associated to
these eigenvalues are
$E[(\pi - \lambda, \l)]$ and $E[(\pi - \mu, \l)]$, therefore ideals
$\frak l := (\pi - \lambda, \l)$ and $\hat{\frak l} := (\pi - \mu, \l)$ define two subgroup of $E$ to which we can associated two $ \F_q $-rational isogenies.
\begin{align*}
	 & {\varphi}_{\frak l}:E \hspace{3px} {\to} \hspace{3px} \frak l \cdot E              \\
	 & {\varphi}_{\hat{\frak l}}: E \hspace{3px} {\to} \hspace{3px} \hat{\frak l} \cdot E
\end{align*}
Since $\frak l \hat{\frak l} = \hat{\frak l} \frak l = (\l)$, these classes are the inverse one of the other in $\Cl(\O)$,
therefore $\varphi_{\frak l}$ and $\varphi_{\hat{\frak l}}$ are dual isogenies, up to isomorphisms.

\begin{figure}[!h]
	\begin{minipage}{0.45\textwidth}
		\centering
		\begin{tikzpicture}
			\def\crater{7}
			\foreach \i in {1,...,\crater} {
					\begin{scope}[shorten >=0.1cm,->]
						\draw[black!60!black] (360/\crater*\i : 1.95cm) -- (360/\crater*\i+360/\crater : 1.95cm);
						\draw[black!60!white] (360/\crater*\i+360/\crater : 2.05cm) -- (360/\crater*\i : 2.05cm);
					\end{scope}
					\draw[black!60!black] (360/\crater*\i+180/\crater:1.6cm) node {\small{$\lambda$}};
					\draw[black!60!white] (360/\crater*\i+180/\crater:2cm) node {\small{$\mu$}};
				}
			\foreach \i in {1,...,\crater} {
					\draw[fill] (360/\crater*\i:2cm) circle (2pt);
				}
		\end{tikzpicture}
		\caption{An isogeny cycle for an Elkies prime ${\l}$, with edge directions
			associated with the Frobenius eigenvalues ${\lambda}$ and ${\mu}$.}
		\label{fig:cycle}
	\end{minipage}
	\hfill
	\begin{minipage}{0.45\textwidth}
		\centering
		\begin{tikzpicture}
			\def\crater{12}
			\def\jumpa{-8}
			\def\jumpb{9}
			\def\diam{2cm}

			\foreach \i in {1,...,\crater} {
					\draw[dashed] (360/\crater*\i : \diam) to[bend right] (360/\crater*\i+360/\crater : \diam);
					\draw[black] (360/\crater*\i : \diam) to[bend right] (360/\crater*\i+\jumpa*360/\crater : \diam);
					\draw[dotted] (360/\crater*\i : \diam) to[bend right=50] (360/\crater*\i+\jumpb*360/\crater : \diam);
				}
			\foreach \i in {1,...,\crater} {
					\pgfmathparse{int(mod(2^\i,13))}
					\let\exp\pgfmathresult
					\draw[fill] (360/\crater*\i: \diam) circle (2pt);% +(360/\crater*\i: 0.4) node{$x^{\exp}$};
				}
		\end{tikzpicture}
		\caption{Graph of horizontal isogenies on 12 curves, with isogenies of three different degrees}
		\label{fig:cayley}
	\end{minipage}
\end{figure}

We have already seen with Thm. [?] how invertible elements in $ \Cl(\O) $ preserve the endomorphisms structure of the curve, and therefore define horizontal isogenies in $ \Ell(\O) $.
Hence, we see that the eigenvalues ${\lambda}$ and ${\mu}$ define two opposite
directions on the $\ell$-isogeny crater, independent of the starting
curve, as shown in Figure~\ref{fig:cycle}. %
The size of the crater is the order of $({\pi}-{\lambda},{\l})$ in $\Cl(\O)$, and the
set $\Ell_q(\O)$ is partitioned into craters of equal size. %
In this way we have just built a basic Shreirer graph with parameters
$(\Cl(\O),S,\Ell_q(\O))$, where $S:=\lbrace \frak l , \hat{\frak l} \rbrace$.
In the sequel, we shall work with a larger edge set $S$,
which will amount to "glue many isogeny craters together", as shown in Figure~\ref{fig:cayley}.

We just introduced Cayley graphs constructed from isogeny craters
and, unsurprisingly, they turn out to
be expanders, provided we add enough edges to them.

\begin{teo}
	\label{th:ord-exp}
	Let $\O$ be a quadratic imaginary order, and assume that
	$\Ell_q(\O)$ is non-empty. %
	Let ${\Delta}>0$, and define the graph $G$ on $\Ell_q(\O)$ where two
	vertices are connected whenever there is a horizontal isogeny
	between them of prime degree bounded by $O((\log q)^{2+{\Delta}})$.

	Then $G$ is a regular graph and, under the generalized Riemann
	hypothesis for the characters of $\Cl(\O)$, there exists an $\varepsilon $
	independent of $\O$ and $q$ such that $G$ is a two-sided
	$\varepsilon $-expander.
\end{teo}
\begin{proof}
	See [?]
\end{proof}

The theorem is readily generalized to supersingular
curves and isogenies defined over $\F_p$, and more generally, to each elliptic curve with complex multiplication. %

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\subsection{Supersingular Case}
In the case of finite fields and supersingular curves we study the isogeny graph of elliptic curves defined over
$ \F_{p^2} $, in fact every supersingular curve is isomorphic to one defined over this field.
We stress that isogenies between these kind of curves are not necessarily defined over $ \F_{p^2} $.
For these graphs we will give below a bound to the number of nodes and show that,
once fixed the definition field, there is only one connected component.
This will turn out to be a Ramanujan graph, therefore with excellent expansion properties.
If we restrict the study domain only to supersingular curves defined over $\F_p $,
and we only consider isogenies over $ \F_p $, then the resulting graph can be proved to be an isogeny volcano.
Now let us explain in detail all these facts.
\\
\\
From the theory of quaternionic multiplication we immediately obtain a bound for the size of an isogeny graph of supersingular curves
defined over $ \F_{p ^ 2} $. Thanks to Theorem [?] and to the Eichler mass formula, which quantify the class number of $B_{p,\infty}$, we obtain the exact size of the isogeny class. %

\begin{cor}
	Let $S_{p^2}$ the set of all supersingular $j$-invariants in $\F_{p^2}$. For a prime $p>3$ we have
	\begin{equation*}
		\#S_{p^2} =
		\left\lfloor\frac{p}{12}\right\rfloor +
		\begin{cases}
			0 & \text{if $p \equiv 1\mod 12$,}   \\
			1 & \text{if $p \equiv 5,7\mod 12$,} \\
			2 & \text{if $p \equiv 11\mod 12$.}
		\end{cases}
	\end{equation*}
\end{cor}
\begin{proof}
	See [?]
	%Computing isogenies between supersingular elliptic curve over F_p
\end{proof}

Since isogeny graphs have isomorphism classes of elliptic curves as vertex,
with this result just stated we have a bound on the size of a supersingular isogeny graph over $\F_{p^2}$.
We can even say more about the global structure of the graph, as the following result shows:
%If we restrict to consider the set of $j$-invariants that strictly lie in $\F_{p}$
%(so in particular they do not lie in $\F_{p^2}$), we clarly obtain less classes.
%The exact number is specified in the following result.
%When we work over a finite field $\F_p$, we can use what we know about complex multiplication.
%The following result quantifies how many isomorphism classes of elliptic curves over $\F_p$ we have.
%\begin{prop}
%Let $p>3$ be a prime, let $S_p$ the set of all supersingular $j$-invariants in $\F_p$. Then
%\begin{equation*}
%  	\#S_{p} = 
%    \begin{cases}
%      \frac{1}{2}h(-4p) &\text{if $p \equiv 1\mod 4$,}\\
%      h(-p) &\text{if $p \equiv 7\mod 8$,}\\
%      2h(-p) &\text{if $p \equiv 3\mod 8$.}
%    \end{cases}
%  \end{equation*}
%Where $h(d)$ is the class number of the imaginary quadratic field $\Q(\sqrt{d})$
%\end{prop}
%\begin{proof}
%See [?] %Computing isogenies between supersingular elliptic curve over F_p
%\end{proof}

\begin{teo}[{Mestre~\cite{mestre86}, Pizer~\cite{pizer1,pizer2}}]
	\label{th:ss-exp}
	Let $\ell \neq p$ be two primes. %
	The ${\l}$-isogeny graph of supersingular curves in $\bar\F_p$, is
	connected, $({\l}+1)$-regular, and has the Ramanujan property.
\end{teo}
\begin{proof}
	See [?].
\end{proof}

So, graphs of supersingular curves \emph{defined over $\F_{p^2}$} with
${\l}$-isogenies, for a \emph{single} prime ${\l} \neq p$, define expander graphs;
two examples of such graphs are shown in Figure~\ref{fig:sup-97-2-3}.
These graphs are called \emph{supersingular isogeny graphs} and in general they are not isomorphic to a Cayley graph. %

\begin{figure}[!h]
	\centering
	\begin{tikzpicture}
		\def\graph{
			\begin{scope}[every node/.style={fill,black,circle,inner sep=2pt}]
				\node at (0,0)  (1){};
				\node at (0,4) (20){};
				\node at (2,1)  (16z){};
				\node at (-2,1)  (81z){};
				\node at (-1,2) (77z){};
				\node at (1,2)  (20z){};
				\node at (-2,3)  (85z){};
				\node at (2,3)  (12z){};
			\end{scope}
		}
		\graph

		\begin{scope}[black,every loop/.style={looseness=50}]
			\path (1) edge (20) edge (16z) edge (81z);
			\path (20) edge[loop left] (20) edge[loop right] (20);
			\path (16z) edge (81z) edge (77z);
			\path (81z) edge (20z);
			\path (77z) edge (20z) edge (85z);
			\path (20z) edge (12z);
			\path (12z) edge[bend right=10] (85z) edge[bend left=10] (85z);
		\end{scope}

		\begin{scope}[xshift=6cm]
			\graph
			\begin{scope}[black]
				\path (1) edge (85z) edge (81z) edge (12z) edge (16z);
				\path (20) edge (85z) edge (77z) edge (20z) edge (12z);
				\path (81z) edge (85z) edge (77z) edge (16z);
				\path (85z) edge (12z);
				\path (12z) edge (16z);
				\path (16z) edge (20z);
				\path (20z) edge[bend right=10] (77z) edge[bend left=10] (77z);
			\end{scope}
		\end{scope}
	\end{tikzpicture}
	\caption{Supersingular isogeny graphs of degree 2 (left) and 3
		(right) on $\F_{97^2}$.}
	\label{fig:sup-97-2-3}
\end{figure}

Delfs and Galbraith [?] showed that if we limit to consider isogenies over $\F_p$, then all connected components are volcanoes, even in the supersingular case (where the depth is at most $1$ at $\l = 2$ and $0$ otherwise): if we take a supersingular elliptic curve $E$ over $\F_p$ with $p > 3$, we end up
in Case $4$ of Theorem [?]. Thus we know according to the theorem that $\End_{\F_p}(E)$
is an order in $K := \Q(\pi_p)$ and its conductor is prime to $p$.
Since $\pi_p^2+p=0$ holds, we get $K = \Q(\sqrt{-p})$. Furthermore,
$$
	\Z[\pi_p] = \Z[\sqrt{-p}] = \Z[\frac{d+\sqrt{d}}{2}] \subseteq
	\End_{\F_p}(E) \subseteq \Z[\frac{d_K+\sqrt{d_K}}{2}] = \O_K
$$
has to hold where the discriminant of $\End_{\F_p}(E)$ is $d = -4p$, $\O_K$
is the maximal order and $d_K$ the fundamental discriminant of $K$.
Due to the properties of the fundamental discriminant, we have
$d = c^2 \cdot d_K$ where $c$ is the conductor of $\Z[\pi_p]$ in $\O_K$ .
From these observations we can conclude:

\begin{itemize}
	\item If $p \equiv 1 \pmod{4}$, remembering Def. [?] we always get $d_K = d = -4p$, $\Z[\pi_p] = \O_K$
	      and hence $\End_{\F_p}(E) = \Z [-p]$ for a supersingular elliptic curve $E$ over $\F_p$.
	\item If $p \equiv 3 \pmod{4}$, we get $d_K = -p$. Thus $\Z[\pi_p] = \Z[-p]$ has conductor
	      $c = 2$ in $\O_K = \Z[\frac{1+\sqrt{-p}}{2}]$ and $\End_{\F_p}(E)$ must be one of those two orders.
\end{itemize}

In terms of isogeny-volcanoes we can say that we have at most two levels and we say $E$ is on the surface (resp. $E$ is on the floor )
if $\End_{\F_p}(E) = \O_K$ (resp. $\End_{\F_p}(E) = \Z[-p]$).
Note that for $p \equiv 1 \pmod{4}$ surface and floor coincide.

In the supersingular case there are fewer possibilities for $\l$-isogenies up and down than for ordinary volcanoes (though, even in the ordinary case tall volcanoes are quite rare). The following statement makes it clear:

\begin{prop}
	Let $\varphi$ be a non-horizontal isogeny between supersingular elliptic curves over $\F_p$. Then the degree of $\varphi$ is divisible by $2$.
\end{prop}
\begin{proof}
	See [?].
\end{proof}

Therefore we have no isogenies of odd prime degree going up or down in this graph.
To determine how many isogenies and how many nodes there are we need some theory
about the ideal class group. We recall the relevant results in the following statements.
For further detail we refer to [?].
First we can make an observation about the number of $\F_p$-isomorphism classes
of supersingular elliptic curves over $\F_p$ with a given $j$-invariant, based on
the following proposition which follows directly from [?]. %[Brö06, Theorem 2.2].

\begin{prop}
	Let $p > 3$ be a prime and $j \in \F_p$ . Define $C_{p,j}$ as the set of $\F_p$-isomorphism classes of elliptic curves defined over $\F_p$ with $j$-invariant $j$. Then we get
	\begin{equation*}
		\#C_{p,j} =
		\begin{cases}
			6 & \text{if $j=0$ and $p \equiv 1 \pmod{3}$}    \\
			4 & \text{if $j=1728$ and $p \equiv 1 \pmod{4}$} \\
			2 & \text{otherwise}
		\end{cases}
	\end{equation*}
\end{prop}
\begin{proof}
	See [?].
\end{proof}

Since we know that for an elliptic curve $E$ over $\F_p$, with
\begin{align*}
	j(E)=0:\hspace{20pt} E \text{ is supersingular }    & \Longleftrightarrow p \equiv 2 \pmod{3} \\
	j(E)=1728:\hspace{20pt} E \text{ is supersingular } & \Longleftrightarrow p \equiv 3 \pmod{4}
\end{align*}
holds, we can deduce from Proposition [?] that given a supersingular $j$-invariant $j$ there are always exactly two $\F_p$-isomorphism classes of elliptic curves over $\F_p$ with this $j$-invariant.

The following result states more precisely the whole structure of a supersingular isogeny graph.

\begin{teo}
	Let $p > 3$ be a prime.
	\begin{enumerate}
		\item $p \equiv 1 \Mod{4}$: There are $h(-4p)$ $\F_p$-isomorphism classes of supersingular elliptic curves over $\F_p$, all having the same endomorphism ring $\Z[\sqrt{-p}]$. From every one there is one outgoing $\F_p$-rational horizontal $2$-isogeny as well as two horizontal $\l$-isogenies for every prime $\l > 2$ with $(\frac{-p}{l})= 1$.
		\item $p \equiv 3 \Mod{4}$: There are two levels in the supersingular isogeny graph. From each vertex there are two horizontal $\l$-isogenies for every prime $\l > 2$ with $(\frac{-p}{l})= 1$.
		      \begin{itemize}
			      \item If $p \equiv 7 \Mod{8}$, on each level $h(-p)$ vertices are situated. Surfaceand floor are connected $1:1$ with $2$-isogenies and on the surface we alsohave two horizontal $2$-isogenies from each vertex.
			      \item If $p \equiv 3 \Mod{8}$, we have $h(-p)$ vertices on the surface and $3h(-p)$ on the floor. Surface and floor are connected $1:3$ with $2$-isogenies, andthere are no horizontal $2$-isogenies.
		      \end{itemize}
	\end{enumerate}
\end{teo}
\begin{proof}
	See [?]
\end{proof}

This provides a structure similar to that of the ordinary isogenesis volcano,
except that in our case we have no more than two levels and for $\l > 2$ only exactly
two outgoing isogenies from each elliptic curve (if any).
This result can be used to adapt the algorithms from the ordinary case that rely on the volcano structure.
\\
\\
We present a few small examples of the irregular structure of the full supersingular isogeny graph $X( \F_{p^2} , \l)$. After that we display, for the same examples, the graphs $X(\F_p , \l)$ which have a much more regular structure. For the examples we use the primes $p = 101, 103$ and $83$, one for each of the different cases that occur, respectively. To demonstrate the two occurring structures we build the graphs for isogeny degrees $\l = 2$ and the smallest prime $\l > 2$ in each case for that isogenies exist. We refer to [?] for further details.

\begin{oss}[Edge representation]
	Until now we have never encountered isogeny graphs in which a curve $ E $ has $ j $-invariant $ j \in \{0, 1728 \} $.
	This allowed us to simplify the treatment by drawing the graphs as undirected,
	and in fact in the application cases we will find a way to exclude this from happening.
	However, limited to the examples below, we will encounter isogeny graphs in which inevitably $ j \in \{0,1728 \} $.
	Note that for $j(E) = 0$ resp. $j(E) \equiv 1728 \pmod{p}$ there are three resp.
	two non-equivalent isogenies mapping from $E$ to another curve $E$ but their dual isogenies are all equivalent.
	This is due to the fact that $\# \Aut(E) = 6$ resp. $\# Aut(E) = 4$. If $\varphi : E(\overline{\mathbb{K}}) \to E'(\overline{\mathbb{K}})$ is an isogeny
	and $\rho \in \Aut(E)$, then $\varphi \circ \rho$ may not be equivalent (i.e., have the same kernel) as $\psi$,
	whereas the dual of $\varphi \circ \rho$ is $\hat{\rho} \circ \hat{\varphi}$, so this is equivalent to the dual
	of $\varphi$ (they have the same kernel).
	For these reasons in the following examples we will denote all edges by specifying their direction and emphasizing
	these multiple isogenies using a single arrow together with an integer to indicate the multiplicity.
\end{oss}

\begin{oss}[Node representation]
	In the previous examples we have always depicted an isogeny graph not giving importance to its vertices, that is
	ignoring the class of elliptic curves that a given vertex represented. This reason was due to the fact
	that we were interested to catch the overall structure of the graph, rather than the nature of individual nodes.
	In the examples that follow we will instead focus on nodes, and on how these ones change as we narrow the
	base field from $\F_{p^2}$ to $\F_{p}$.
	For this reason we will denote each node in the following examples with the associated $j$-invariant.
	We have already seen that this way of representing the graph is wrong.
	We will fix the representation in the following way: in the case where two curves are isomorphic over an extension of greater degree
	with respect to the one under analysis, we will in any case label their vertices with their $j$-invariant,
	and we will represent this vertex several times.
\end{oss}

\begin{example}
	For the first example we take $p = 101$, so that $p \equiv 1 \pmod{4}$.
	Thanks to Theorem [?], we expect $\lfloor \frac{101}{12} \rfloor + 1 = 9$ supersingular $j$-invariants in $\F_p$.
	In the next figure we show how they are connected using $2$-isogenies. The nodes
	labeled $\alpha$ and $\overline{\alpha}$ represent $j$-invariants in $\F_{p^2} \setminus \F_p$ where $\overline{\alpha}$ is the conjugate of $\alpha$.
	The graph can be easily computed with help of modular polynomials.

	\begin{figure}[!h]
		\centering
		\begin{tikzpicture}[scale=0.35]
			\begin{pgfonlayer}{nodelayer}
				\node [style=new style 0] (0) at (-14.75, 0) {$0$};
				\node [style=new style 0] (1) at (-9.75, 0) {$66$};
				\node [style=new style 0] (2) at (-4.75, 0) {$21$};
				\node [style=new style 0] (3) at (0, 0) {$57$};
				\node [style=new style 0] (4) at (5.25, 0) {$64$};
				\node [style=new style 0] (5) at (10.25, 0) {$3$};
				\node [style=new style 0] (6) at (15.25, 0) {$59$};
				\node [style=new style 0] (7) at (-4.75, 7) {$\alpha$};
				\node [style=new style 0] (8) at (-4.75, -6.75) {$\overline{\alpha}$};
				\node [scale=0.7] at (-12.25,0.75) {$3$};
			\end{pgfonlayer}
			\begin{pgfonlayer}{edgelayer}
				\draw [style=Classic, bend left=15, looseness=0.50] (0) to (1);
				\draw [style=Classic, bend left=15, looseness=0.50] (1) to (2);
				\draw [style=Classic, bend left=15, looseness=0.50] (3) to (4);
				\draw [style=Classic, bend left=15, looseness=0.50] (4) to (5);
				\draw [style=Classic, bend left=15, looseness=0.50] (5) to (6);
				\draw [style=Classic, in=-135, out=-45, loop] (6) to ();
				\draw [style=Classic, in=-135, out=-45, loop] (2) to ();
				\draw [style=Classic, bend right=15, looseness=0.50] (1) to (8);
				\draw [style=Classic, bend left=15, looseness=0.75] (1) to (7);
				\draw [style=Classic, bend right=15, looseness=0.50] (7) to (3);
				\draw [style=Classic, bend left=15, looseness=0.50] (8) to (3);
				\draw [style=Classic, in=135, out=45, loop] (2) to ();
				\draw [style=Classic, bend left=15, looseness=0.50] (2) to (1);
				\draw [style=Classic, bend left=15, looseness=0.50] (1) to (0);
				\draw [style=Classic, bend left=15, looseness=0.50] (7) to (1);
				\draw [style=Classic, bend right=15, looseness=0.50] (8) to (1);
				\draw [style=Classic, bend left=15, looseness=0.50] (3) to (8);
				\draw [style=Classic, bend right=15, looseness=0.50] (3) to (7);
				\draw [style=Classic, bend left=15, looseness=0.50] (4) to (3);
				\draw [style=Classic, bend left, looseness=0.75] (4) to (5);
				\draw [style=Classic, bend left=15, looseness=0.50] (5) to (4);
				\draw [style=Classic, bend left, looseness=0.75] (5) to (4);
				\draw [style=Classic, in=135, out=45, loop] (6) to ();
				\draw [style=Classic, bend left=15, looseness=0.50] (6) to (5);
			\end{pgfonlayer}
		\end{tikzpicture}
		\caption{Supersingular 2-Isogeny Graph over $\overline{\F}_{101}$}
	\end{figure}

	In $X(\F_p , \l)$ we will have $h(-4p) = 14$ nodes which are supersingular elliptic
	curves over $\F_p$ with endomorphism ring $\Z[\sqrt{-101}]$. There will be only one outgoing
	$2$-isogeny from each curve, so naturally the graph can not be connected. It can be seen in the following figure.

	\begin{figure}[!h]
		\centering
		\begin{tikzpicture}[scale=0.4]
			\begin{pgfonlayer}{nodelayer}
				\node [style=new style 0] (0) at (-10, 2) {$0$};
				\node [style=new style 0] (1) at (-6, 2) {$66$};
				\node [style=new style 0] (2) at (-10, -2) {$0$};
				\node [style=new style 0] (3) at (-6, -2) {$66$};
				\node [style=new style 0] (4) at (-2, 0) {$21$};
				\node [style=new style 0] (5) at (1.75, 0) {$21$};
				\node [style=new style 0] (6) at (6, 2) {$57$};
				\node [style=new style 0] (7) at (10, 2) {$64$};
				\node [style=new style 0] (8) at (14, 2) {$3$};
				\node [style=new style 0] (9) at (18, 2) {$59$};
				\node [style=new style 0] (10) at (6, -2) {$57$};
				\node [style=new style 0] (11) at (10, -2) {$64$};
				\node [style=new style 0] (12) at (14, -2) {$3$};
				\node [style=new style 0] (13) at (18, -2) {$59$};
			\end{pgfonlayer}
			\begin{pgfonlayer}{edgelayer}
				\draw [style=leftRight] (0) to (1);
				\draw [style=leftRight] (2) to (3);
				\draw [style=leftRight] (4) to (5);
				\draw [style=leftRight] (6) to (7);
				\draw [style=leftRight] (10) to (11);
				\draw [style=leftRight] (8) to (9);
				\draw [style=leftRight] (12) to (13);
			\end{pgfonlayer}
		\end{tikzpicture}
		\caption{$\F_p$-Rational Supersingular Isogeny Graph $X(\F_{101} , 2)$}
	\end{figure}

	It is notable that in this graph there are fewer connecting isogenies than in the full graph before.
	For example, in the first graph we have two isogenies going from the node $64$ to the node $3$ and two ones back,
	which are all missing in the new graph.
	This is due to the fact that those isogenies are not defined over $\F_p$ , so they
	are not computed as edges in $X(\F_p , 2)$. Likewise the two loops from $59$ to itself are
	isogenies over $\F_{p^2}$ that are dual to each other, whereas the loop at $21$ is a $\F_p$-rational isogeny that is its own dual.
	We also observe that all nodes are duplicated. This is due to the fact that in the graph described by Figure [?],
	each node associated with a $ j $-invariant encloses elliptic curves which are isomorphic over an extension of $\F_{101}$,
	therefore it is correct to represent them as a single vertex in this figure, but it is not correct to do the same in Fig. [?]
\end{example}

\begin{example}
	For higher isogeny degree the number of outgoing isogenies from each vertex grows, so the graph becomes complicated to draw. Here we take $\l=3$, as $\big( \frac{-p}{3} \big) = 1$.

	\begin{figure}[!h]
		\centering
		%\vspace{-30pt}
		\begin{tikzpicture}[scale=0.5]
			\begin{pgfonlayer}{nodelayer}
				\node [style=new style 0] (0) at (1.75, 3) {59};
				\node [style=new style 0] (1) at (1.75, 0) {21};
				\node [style=new style 0] (2) at (1.75, -3) {3};
				\node [style=new style 0] (3) at (-1.25, 0) {$\alpha$};
				\node [style=new style 0] (4) at (-4.25, 3) {$\overline{\alpha}$};
				\node [style=new style 0] (5) at (-4.25, -3) {$64$};
				\node [style=new style 0] (6) at (-9.25, -3) {$0$};
				\node [style=new style 0] (7) at (5.75, 3) {57};
				\node [style=new style 0] (8) at (9.5, 3) {66};
				\node [scale=0.7] at (-6.75,-2.25) {$3$};
			\end{pgfonlayer}
			\begin{pgfonlayer}{edgelayer}
				\draw [style=Classic, in=-135, out=135, loop] (6) to ();
				\draw [style=Classic, bend left=15] (6) to (5);
				\draw [style=Classic, bend left=15] (5) to (4);
				\draw [style=Classic, bend left=15] (4) to (0);
				\draw [style=Classic, bend left=15] (0) to (7);
				\draw [style=Classic, bend left=15] (7) to (8);
				\draw [style=Classic, bend left=15] (5) to (2);
				\draw [style=Classic, bend left=15] (2) to (1);
				\draw [style=Classic, bend left=15] (1) to (0);
				\draw [style=Classic, bend left=15] (5) to (3);
				\draw [style=Classic, bend left=15] (3) to (0);
				\draw [style=Classic, bend left=15] (3) to (4);
				\draw [style=Classic, bend left=15] (5) to (6);
				\draw [style=Classic, bend left=15] (4) to (5);
				\draw [style=Classic, bend left=15] (2) to (5);
				\draw [style=Classic, bend left=15] (3) to (5);
				\draw [style=Classic, bend left=15] (4) to (3);
				\draw [style=Classic, bend left=15] (0) to (4);
				\draw [style=Classic, bend left=15] (0) to (3);
				\draw [style=Classic, bend left=15] (0) to (1);
				\draw [style=Classic, bend left=15] (1) to (2);
				\draw [style=Classic, bend left=15] (7) to (0);
				\draw [style=Classic, bend left=15] (8) to (7);
				\draw [style=Classic, bend left] (3) to (4);
				\draw [style=Classic, bend left] (4) to (3);
				\draw [style=Classic, in=-135, out=135, loop] (1) to ();
				\draw [style=Classic, in=45, out=-45, loop] (1) to ();
				\draw [style=Classic, in=135, out=45, loop] (7) to ();
				\draw [style=Classic, in=135, out=45, loop] (8) to ();
				\draw [style=Classic, in=-45, out=-135, loop] (8) to ();
				\draw [style=Classic, in=-45, out=-135, loop] (7) to ();
			\end{pgfonlayer}
		\end{tikzpicture}
		%\vspace{-20pt}
		\caption{Supersingular Isogeny Graph $X( \overline{\F}_{101} , 3)$}
	\end{figure}

	Despite the complicated picture of the full graph, the graph over $\F_p$ becomes just a big circle. In particular,
	it is already fully connected. This is because the ideal class group of $\Q(\sqrt{-101})$ is generated by a prime ideal of norm $3$.

	\begin{figure}[!h]
		\centering
		\begin{tikzpicture}[scale=0.4]
			\begin{pgfonlayer}{nodelayer}
				\node [style=new style 0] (0) at (0, 3) {$21$};
				\node [style=new style 0] (1) at (0, 0) {$21$};
				\node [style=new style 0] (2) at (-4, 3) {$3$};
				\node [style=new style 0] (3) at (-4, 0) {$3$};
				\node [style=new style 0] (4) at (-8, 3) {$64$};
				\node [style=new style 0] (5) at (-8, 0) {$64$};
				\node [style=new style 0] (6) at (-12, 0) {$0$};
				\node [style=new style 0] (7) at (-12, 3) {$0$};
				\node [style=new style 0] (8) at (4, 3) {$59$};
				\node [style=new style 0] (9) at (4, 0) {$59$};
				\node [style=new style 0] (10) at (8, 3) {$57$};
				\node [style=new style 0] (11) at (8, 0) {$57$};
				\node [style=new style 0] (12) at (12, 3) {$66$};
				\node [style=new style 0] (13) at (12, 0) {$66$};
			\end{pgfonlayer}
			\begin{pgfonlayer}{edgelayer}
				\draw [style=leftRight] (7) to (6);
				\draw [style=leftRight] (6) to (5);
				\draw [style=leftRight] (5) to (3);
				\draw [style=leftRight] (3) to (1);
				\draw [style=leftRight] (1) to (9);
				\draw [style=leftRight, in=180, out=0] (9) to (11);
				\draw [style=leftRight] (11) to (13);
				\draw [style=leftRight] (12) to (13);
				\draw [style=leftRight] (12) to (10);
				\draw [style=leftRight] (10) to (8);
				\draw [style=leftRight] (8) to (0);
				\draw [style=leftRight] (0) to (2);
				\draw [style=leftRight] (2) to (4);
				\draw [style=leftRight] (4) to (7);
			\end{pgfonlayer}
		\end{tikzpicture}
		\caption{Rational Supersingular Isogeny Graph $X(\F_{101} , 3)$}
	\end{figure}

	Again you can see how the isogenies from the full graph that are defined over $\F_{p^2}$
	vanish in the rational graph, and the single loops become isogenies from an elliptic
	curve to its quadratic twist.
\end{example}


\begin{example}
	Let $p = 83$, so that $p \equiv 3	\pmod{4}$ and $p \equiv 3\pmod{8}$. The full graph will have $\lfloor \frac{83}{12} \rfloor + 2 = 8$ vertices.
	Again we have two $j$-invariants $\alpha, \overline{\alpha} \in \F_{p^2} \setminus \F_p$. The full $2$-isogeny graph has the
	following structure.
	\begin{figure}[!h]
		\centering
		\begin{tikzpicture}[scale=0.4]
			\begin{pgfonlayer}{nodelayer}
				\node [style=new style 0] (0) at (-7, 4) {$0$};
				\node [style=new style 0] (1) at (-7, -4) {$28$};
				\node [style=new style 0] (2) at (-3, 0) {$50$};
				\node [style=new style 0] (3) at (1, 0) {$17$};
				\node [style=new style 0] (4) at (5, 4) {$\alpha$};
				\node [style=new style 0] (5) at (5, -4) {$\overline{\alpha}$};
				\node [style=new style 0] (6) at (9, 0) {$67$};
				\node [style=new style 0] (7) at (13, 0) {$68$};
				\node [scale=0.7] at (-4.5,2.7) {$3$};
				\node [scale=0.7] at (11,0.75) {$2$};
			\end{pgfonlayer}
			\begin{pgfonlayer}{edgelayer}
				\draw [style=Classic, bend left=15] (0) to (2);
				\draw [style=Classic, bend left=15] (2) to (0);
				\draw [style=Classic, bend left=15] (1) to (2);
				\draw [style=Classic, bend left=15] (2) to (1);
				\draw [style=Classic, in=-180, out=105, loop] (1) to ();
				\draw [style=Classic, in=-75, out=0, loop] (1) to ();
				\draw [style=Classic, bend left=15] (2) to (3);
				\draw [style=Classic, bend left=15] (3) to (2);
				\draw [style=Classic, bend left=15] (3) to (4);
				\draw [style=Classic, bend left=15] (4) to (3);
				\draw [style=Classic, bend left=15] (3) to (5);
				\draw [style=Classic, bend left=15] (5) to (3);
				\draw [style=Classic, bend left=15] (5) to (4);
				\draw [style=Classic, bend left=15] (4) to (5);
				\draw [style=Classic, bend left=15] (5) to (6);
				\draw [style=Classic, bend left=15] (6) to (5);
				\draw [style=Classic, bend left=15] (4) to (6);
				\draw [style=Classic, in=300, out=150] (6) to (4);
				\draw [style=Classic, bend left=15] (6) to (7);
				\draw [style=Classic, bend left=15] (7) to (6);
				\draw [style=Classic, in=135, out=45, loop] (7) to ();
			\end{pgfonlayer}
		\end{tikzpicture}
		\vspace{-20pt}
		\caption{Supersingular Isogeny Graph $X(\overline{\F}_{83} , 2)$}
	\end{figure}

	In the graph over $\F_p$ we get $h(-p) = 3$ supersingular elliptic curves on the surface and $h(-4p) = 9$ ones on the floor. In the next figure we can see how $2$-isogenies connect floor and surface as explained in the last case of Theorem [?].

	\begin{figure}[!h]
		\centering
		\begin{tikzpicture}[scale=0.4]
			\begin{pgfonlayer}{nodelayer}
				\node [style=new style 0] (0) at (0, 3) {$50$};
				\node [style=new style 0] (1) at (0, 0) {$17$};
				\node [style=new style 0] (2) at (3, 0) {$28$};
				\node [style=new style 0] (3) at (-3, 0) {$0$};
				\node [style=new style 0] (4) at (10, 3) {$68$};
				\node [style=new style 0] (5) at (10, 0) {$67$};
				\node [style=new style 0] (6) at (13, 0) {$68$};
				\node [style=new style 0] (7) at (7, 0) {$67$};
				\node [style=new style 0] (8) at (-10, 3) {$50$};
				\node [style=new style 0] (9) at (-10, 0) {$17$};
				\node [style=new style 0] (10) at (-7, 0) {$28$};
				\node [style=new style 0] (11) at (-13, 0) {$0$};
			\end{pgfonlayer}
			\begin{pgfonlayer}{edgelayer}
				\draw [style=leftRight] (0) to (3);
				\draw [style=leftRight] (0) to (1);
				\draw [style=leftRight] (0) to (2);
				\draw [style=leftRight] (4) to (7);
				\draw [style=leftRight] (4) to (5);
				\draw [style=leftRight] (4) to (6);
				\draw [style=leftRight] (8) to (11);
				\draw [style=leftRight] (8) to (9);
				\draw [style=leftRight] (8) to (10);
			\end{pgfonlayer}
		\end{tikzpicture}
		\caption{Rational Supersingular Isogeny Graph $X(\F_{83} , 2)$}
	\end{figure}
\end{example}

\begin{example}
	If we repeat the procedure for $\l = 3$, the full graph looks like this.

	\begin{figure}[!h]
		%\vspace{-20pt}
		\centering
		\begin{tikzpicture}[scale=0.4]
			\begin{pgfonlayer}{nodelayer}
				\node [style=new style 0] (0) at (-3, 0) {$28$};
				\node [style=new style 0] (1) at (3, 0) {$17$};
				\node [style=new style 0] (2) at (-7, 0) {$67$};
				\node [style=new style 0] (3) at (-11.25, 0) {$0$};
				\node [style=new style 0] (4) at (7, 0) {$68$};
				\node [style=new style 0] (5) at (11, 0) {$50$};
				\node [style=new style 0] (6) at (0, 5) {$\alpha$};
				\node [style=new style 0] (7) at (0, -5) {$\overline{\alpha}$};
				\node [scale=0.7] at (-9.25,0.75) {$3$};
				\node [scale=0.7] at (5,-0.75) {$2$};
				\node [scale=0.7] at (9,0.60) {$2$};
			\end{pgfonlayer}
			\begin{pgfonlayer}{edgelayer}
				\draw [style=Classic, in=-135, out=135, loop] (3) to ();
				\draw [style=Classic, in=45, out=-45, loop] (5) to ();
				\draw [style=Classic, bend left=15] (3) to (2);
				\draw [style=Classic, bend left=15] (2) to (0);
				\draw [style=Classic, bend left=15] (0) to (1);
				\draw [style=Classic, bend left=15] (1) to (4);
				\draw [style=Classic, bend left=15, looseness=0.50] (4) to (5);
				\draw [style=Classic, bend right=345, looseness=0.50] (5) to (4);
				\draw [style=Classic, bend left=15] (4) to (1);
				\draw [style=Classic, bend left=15] (1) to (0);
				\draw [style=Classic, bend left=15] (0) to (2);
				\draw [style=Classic, bend left=15] (2) to (3);
				\draw [style=Classic, in=135, out=45, loop] (1) to ();
				\draw [style=Classic, in=-45, out=-135, loop] (1) to ();
				\draw [style=Classic, bend left=15] (6) to (7);
				\draw [style=Classic, bend left=15] (7) to (6);
				\draw [style=Classic] (7) to (0);
				\draw [style=Classic] (0) to (6);
				\draw [style=Classic] (6) to (0);
				\draw [style=Classic] (0) to (7);
				\draw [style=Classic] (5) to (7);
				\draw [style=Classic, bend right=15, looseness=0.75] (7) to (5);
				\draw [style=Classic, bend left=15, looseness=0.75] (6) to (5);
				\draw [style=Classic] (5) to (6);
				\draw [style=Classic] (6) to (2);
				\draw [style=Classic, bend left=15, looseness=0.75] (7) to (2);
				\draw [style=Classic] (2) to (7);
				\draw [style=Classic, bend left=15, looseness=0.75] (2) to (6);
			\end{pgfonlayer}
		\end{tikzpicture}
		\caption{Supersingular Isogeny Graph $X( \overline{F}_{83} , 3)$}
	\end{figure}

	And in the graph over $\F_p$ we get two isogeny circles, one on the floor and one on the surface.

	\begin{figure}[!h]
		\centering
		\begin{tikzpicture}[scale=0.4]
			\begin{pgfonlayer}{nodelayer}
				\node [style=new style 0] (0) at (0, 2) {$28$};
				\node [style=new style 0] (1) at (3, 2) {$17$};
				\node [style=new style 0] (2) at (6, 2) {$68$};
				\node [style=new style 0] (3) at (9, 2) {$17$};
				\node [style=new style 0] (4) at (12, 2) {$28$};
				\node [style=new style 0] (5) at (0, -1) {$67$};
				\node [style=new style 0] (6) at (4, -1) {$0$};
				\node [style=new style 0] (7) at (8, -1) {$0$};
				\node [style=new style 0] (8) at (12, -1) {$67$};
				\node [style=new style 0] (9) at (-8, 2) {$68$};
				\node [style=new style 0] (10) at (-10, -1) {$50$};
				\node [style=new style 0] (11) at (-6, -1) {$50$};
			\end{pgfonlayer}
			\begin{pgfonlayer}{edgelayer}
				\draw [style=leftRight] (10) to (9);
				\draw [style=leftRight] (9) to (11);
				\draw [style=leftRight] (10) to (11);
				\draw [style=leftRight] (0) to (5);
				\draw [style=leftRight] (8) to (4);
				\draw [style=leftRight] (5) to (6);
				\draw [style=leftRight] (6) to (7);
				\draw [style=leftRight] (7) to (8);
				\draw [style=leftRight] (0) to (1);
				\draw [style=leftRight] (1) to (2);
				\draw [style=leftRight] (2) to (3);
				\draw [style=leftRight] (3) to (4);
			\end{pgfonlayer}
		\end{tikzpicture}
		\caption{Rational Supersingular Isogeny Graph $X(\F_{83} , 3)$}
	\end{figure}
\end{example}

\begin{example}
	Our example here is $p = 103$ where $p \equiv 3 \pmod{4}$ and $p \equiv 7 \pmod{8}$. We have $h(-p) = 5$ supersingular elliptic
	curves on the surface and also $h(-4p) = 5$ ones on the floor. In this case we have four nodes in $\F_{p^2} \setminus \F_p$.

	\begin{figure}[!h]
		\centering
		%\vspace{-1cm}
		\begin{tikzpicture}[scale=0.35]
			\begin{pgfonlayer}{nodelayer}
				\node [style=new style 0] (0) at (-3, 0) {$69$};
				\node [style=new style 0] (1) at (3, 0) {$34$};
				\node [style=new style 0] (2) at (-8, 0) {$23$};
				\node [style=new style 0] (3) at (6, 3) {$\alpha$};
				\node [style=new style 0] (4) at (6, -3) {$\overline{\alpha}$};
				\node [style=new style 0] (5) at (11, -3) {$\overline{\beta}$};
				\node [style=new style 0] (6) at (11, 3) {$\beta$};
				\node [style=new style 0] (7) at (-11, 3) {$24$};
				\node [style=new style 0] (8) at (-11, -3) {$80$};
				\node [scale=0.7] at (-10,-1) {$3$};
			\end{pgfonlayer}
			\begin{pgfonlayer}{edgelayer}
				\draw [style=Classic, bend right=15, looseness=0.75] (7) to (2);
				\draw [style=Classic, bend right=15, looseness=0.75] (2) to (7);
				\draw [style=Classic, bend right=15, looseness=0.75] (8) to (2);
				\draw [style=Classic, bend right=15, looseness=0.75] (2) to (8);
				\draw [style=Classic, bend left=15, looseness=0.75] (2) to (0);
				\draw [style=Classic, bend right=345, looseness=0.75] (0) to (2);
				\draw [style=Classic, bend left=15, looseness=0.75] (0) to (1);
				\draw [style=Classic, bend left=15, looseness=0.75] (1) to (0);
				\draw [style=Classic, bend left=15, looseness=0.75] (1) to (3);
				\draw [style=Classic, bend left=15, looseness=0.75] (3) to (4);
				\draw [style=Classic, bend left=15, looseness=0.75] (4) to (1);
				\draw [style=Classic, bend left=15, looseness=0.75] (1) to (4);
				\draw [style=Classic, bend left=15, looseness=0.75] (4) to (5);
				\draw [style=Classic, bend left=15] (5) to (6);
				\draw [style=Classic, bend left=15, looseness=0.75] (6) to (3);
				\draw [style=Classic, bend left=15, looseness=0.75] (3) to (6);
				\draw [style=Classic, bend left=15] (6) to (5);
				\draw [style=Classic, bend left=15, looseness=0.75] (4) to (3);
				\draw [style=Classic, bend left=15, looseness=0.75] (3) to (1);
				\draw [style=Classic, in=135, out=45, loop] (0) to ();
				\draw [style=Classic, bend left=15, looseness=0.75] (5) to (4);
				\draw [style=Classic, in=60, out=-15, loop] (7) to ();
				\draw [style=Classic, in=180, out=-105, loop] (7) to ();
				\draw [style=Classic, in=-75, out=-165, loop] (8) to ();
				\draw [style=Classic, bend right] (6) to (5);
				\draw [style=Classic, bend right] (5) to (6);
			\end{pgfonlayer}
		\end{tikzpicture}
		\vspace{-20pt}
		\caption{Supersingular Isogeny Graph $X(\overline{\F}_{103} , 2)$}
	\end{figure}

	The $2$-isogeny graph over $\F_p$ in this case is already connected. Again a volcano structure can be observed where every supersingular elliptic curve on the floor has exactly one isogeny up starting at it.
	\begin{figure}[!h]
		\centering
		\begin{tikzpicture}[scale=0.4]
			\begin{pgfonlayer}{nodelayer}
				\node [style=new style 0] (0) at (0, 2) {$80$};
				\node [style=new style 0] (1) at (-2.25, 0.25) {$23$};
				\node [style=new style 0] (2) at (2.25, 0.25) {$23$};
				\node [style=new style 0] (3) at (-1.25, -2) {$69$};
				\node [style=new style 0] (4) at (1.25, -2) {$69$};
				\node [style=new style 0] (5) at (0, 5) {$80$};
				\node [style=new style 0] (6) at (-5.25, 0.25) {$24$};
				\node [style=new style 0] (7) at (5.25, 0.25) {$24$};
				\node [style=new style 0] (8) at (-3.25, -4.25) {$34$};
				\node [style=new style 0] (9) at (3.25, -4.25) {$34$};
			\end{pgfonlayer}
			\begin{pgfonlayer}{edgelayer}
				\draw [style=leftRight] (0) to (5);
				\draw [style=leftRight] (0) to (1);
				\draw [style=leftRight] (1) to (3);
				\draw [style=leftRight] (3) to (4);
				\draw [style=leftRight] (0) to (2);
				\draw [style=leftRight] (2) to (4);
				\draw [style=leftRight] (4) to (9);
				\draw [style=leftRight] (7) to (2);
				\draw [style=leftRight] (1) to (6);
				\draw [style=leftRight] (3) to (8);
			\end{pgfonlayer}
		\end{tikzpicture}
		\caption{Rational Supersingular Isogeny Graph $X(\F_{103} , 2)$}
	\end{figure}
\end{example}

\begin{example}
	The smallest prime $\l > 2$ with $-103 = 1$ is $\l = 7$. In the full graph every vertex $\l$ has eight outgoing isogenies so it is not nice to draw. The subgraph of $X(\overline{F}_{103} , 7$)
	only consisting of $j$-invariants in $\F_{103}$ is presented in the next figure, so it can be
	compared to $X(\F_{103} , 7)$ below.
	\begin{figure}[!h]
		\centering
		\begin{tikzpicture}[scale=0.5]
			\begin{pgfonlayer}{nodelayer}
				\node [style=new style 0] (0) at (0, 0) {$80$};
				\node [style=new style 0] (1) at (-4, 0) {$69$};
				\node [style=new style 0] (2) at (-8, 0) {$23$};
				\node [style=new style 0] (3) at (4, 0) {$34$};
				\node [style=new style 0] (4) at (8, 0) {$24$};
				\node [scale=0.7] at (-2,-0.05) {$2$};
				\node [scale=0.7] at (2,0.05) {$2$};
			\end{pgfonlayer}
			\begin{pgfonlayer}{edgelayer}
				\draw [style=Classic, bend left=15, looseness=0.75] (2) to (1);
				\draw [style=Classic, bend left=15, looseness=0.75] (1) to (0);
				\draw [style=Classic, bend left=15, looseness=0.75] (0) to (3);
				\draw [style=Classic, bend left=15, looseness=0.75] (3) to (4);
				\draw [style=Classic, in=45, out=-45, loop] (4) to ();
				\draw [style=Classic, bend left=15, looseness=0.75] (4) to (3);
				\draw [style=Classic, bend left=15, looseness=0.75] (3) to (0);
				\draw [style=Classic, bend left=15, looseness=0.75] (0) to (1);
				\draw [style=Classic, bend left=15, looseness=0.75] (1) to (2);
				\draw [style=Classic, in=-135, out=135, loop] (2) to ();
				\draw [style=Classic, in=120, out=60, loop] (3) to ();
				\draw [style=Classic, in=-120, out=-60, loop] (3) to ();
				\draw [style=Classic, bend right] (3) to (1);
				\draw [style=Classic, bend left=15] (1) to (3);
				\draw [style=Classic, bend right=345] (3) to (1);
				\draw [style=Classic, bend right] (1) to (3);
			\end{pgfonlayer}
		\end{tikzpicture}
		%\vspace{-20pt}
		\caption{Subgraph of Supersingular Isogeny Graph $X( \overline{\F}_{103} , 7)$}
	\end{figure}

	Again we get two isogeny cycles such that floor and surface each are fully connected when we draw the graph $X(\F_{103} , 7)$. This is because the ideal class group is cyclic and generated by a prime ideal of norm $7$.

	\begin{figure}[!h]
		\centering
		\begin{tikzpicture}[scale=0.4]
			\begin{pgfonlayer}{nodelayer}
				\node [style=new style 0] (0) at (-4.25, 2) {$80$};
				\node [style=new style 0] (1) at (-6.5, 0.25) {$69$};
				\node [style=new style 0] (2) at (-2, 0.25) {$69$};
				\node [style=new style 0] (3) at (-5.5, -2) {$23$};
				\node [style=new style 0] (4) at (-3, -2) {$23$};
				\node [style=new style 0] (5) at (4, 2) {$80$};
				\node [style=new style 0] (6) at (1.75, 0.25) {$34$};
				\node [style=new style 0] (7) at (6.25, 0.25) {$34$};
				\node [style=new style 0] (8) at (2.75, -2) {$24$};
				\node [style=new style 0] (9) at (5.25, -2) {$24$};
			\end{pgfonlayer}
			\begin{pgfonlayer}{edgelayer}
				\draw [style=leftRight] (0) to (1);
				\draw [style=leftRight] (1) to (3);
				\draw [style=leftRight] (3) to (4);
				\draw [style=leftRight] (0) to (2);
				\draw [style=leftRight] (2) to (4);
				\draw [style=leftRight] (5) to (6);
				\draw [style=leftRight] (6) to (8);
				\draw [style=leftRight] (8) to (9);
				\draw [style=leftRight] (5) to (7);
				\draw [style=leftRight] (7) to (9);
			\end{pgfonlayer}
		\end{tikzpicture}
		\caption{Rational Supersingular Isogeny Graph $X(\F_{103} , 7)$}
	\end{figure}
\end{example}

\

%Riassumendo: le curve ordinarie definiscono naturalmente una struttura di grafo che prende il nome di \emph{isogeny volcanoes}, ma spesso, per le applicazioni, ci si limita a considerare un sottografo isomorfo a un \emph{Cayley graphs}. Le curve supersingolari definiscono naturalmente i cosiddetti \emph{supersingular graphs}; anche in questo caso è possibile identificare un sottografo isomorfo ad un \emph{Cayley graphs}.

\chapter{Isogeny-Based Cryptography}
\section{The CRS Key exchange}
\section{CSIDH}
\subsection{Impementative Choice}

\appendix

\chapter{Montgomery Elliptic Curves}



\cleardoublepage
%\phantomsection
\addcontentsline{toc}{chapter}{\bibname}

\begin{thebibliography}{9}
	\bibitem{Nist} Chen, Lily, et al. Report on post-quantum cryptography. Vol. 12. US Department of Commerce, National Institute of Standards and Technology, 2016.
	\bibitem{NTRU} Hoffstein, Jeffrey, Jill Pipher, and Joseph H. Silverman. "NTRU: A ring-based public key cryptosystem." International Algorithmic Number Theory Symposium. Springer, Berlin, Heidelberg, 1998.
	\bibitem{PrePostQuantum} Smith, Benjamin. "Pre-and post-quantum Diffie–Hellman from groups, actions, and isogenies." International Workshop on the Arithmetic of Finite Fields. Springer, Cham, 2018.
	\bibitem{Shor} Shor, Peter W. "Polynomial-time algorithms for prime factorization and discrete logarithms on a quantum computer." SIAM review 41.2 (1999): 303-332.
	\bibitem{Grover} Grover, Lov K. "A fast quantum mechanical algorithm for database search." Proceedings of the twenty-eighth annual ACM symposium on Theory of computing. 1996.
	\bibitem{NistSP} Barker, Elaine, et al. Recommendation for key management: Part 1: General. National Institute of Standards and Technology, Technology Administration, 2006.
	\bibitem{Bernstein} Bernstein, Daniel J. "Introduction to post-quantum cryptography." Post-quantum cryptography. Springer, Berlin, Heidelberg, 2009. 1-14.
	\bibitem{PKEKEM} Nagao, Waka, Yoshifumi Manabe, and Tatsuaki Okamoto. "On the Equivalence of Several Security Notions of Key Encapsulation Mechanism." IACR Cryptol. ePrint Arch. 2006 (2006): 268.
	\bibitem{Galbraith} Galbraith, Steven D. Mathematics of public key cryptography. Cambridge University Press, 2012.
	\bibitem{Washington} Washington, Lawrence C. Elliptic curves: number theory and cryptography. CRC press, 2008.
	\bibitem{Silverman} Silverman, Joseph H. The arithmetic of elliptic curves. Vol. 106. Springer Science \& Business Media, 2009.
	\bibitem{conicOne} Shirali, Shailesh A. "Groups associated with conics." The Mathematical Gazette 93.526 (2009): 27-41.
	\bibitem{conicTwo} E. Bellini, N. Murru and A.J. Di Scala et al., Group law on affine conics and applications to cryptography, Applied Mathematics and Computation, https://doi.org/10.1016/j.amc.2020.125537
	\bibitem{DeFeo1} De Feo, Luca. "Mathematics of isogeny based cryptography." arXiv preprint arXiv:1711.04062 (2017).
	\bibitem{Kohel} David Kohel. Endomorphism rings of elliptic curves over finite fields. PhD thesis, University of California at Berkley, 1996.
	\bibitem{Wat} William C. Waterhouse. Abelian varieties over finite fields. Ann. Sci. Ecole Norm. Sup, 2(4):521-560, 1969.
	\bibitem{Velu} Jacques Vélu. Isogénies entre courbes elliptiques. Comptes Rendus de l’Académie des Sciences de Paris, 273:238–241, 1971.
\end{thebibliography}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}
